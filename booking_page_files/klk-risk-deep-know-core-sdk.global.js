var KlkRiskDeepKnowSDK=(()=>{var V=Object.create;var g=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty;var w=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),q=(e,n)=>{for(var t in n)g(e,t,{get:n[t],enumerable:!0})},C=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of x(n))!U.call(e,i)&&i!==t&&g(e,i,{get:()=>n[i],enumerable:!(o=A(n,i))||o.enumerable});return e};var B=(e,n,t)=>(t=e!=null?V(K(e)):{},C(n||!e||!e.__esModule?g(t,"default",{value:e,enumerable:!0}):t,e)),G=e=>C(g({},"__esModule",{value:!0}),e);var $=w(f=>{"use strict";var v=function(e,n){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])},v(e,n)};function X(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");v(e,n);function t(){this.constructor=e}e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}f.__assign=function(){return f.__assign=Object.assign||function(n){for(var t,o=1,i=arguments.length;o<i;o++){t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},f.__assign.apply(this,arguments)};function J(e,n,t,o){function i(r){return r instanceof t?r:new t(function(a){a(r)})}return new(t||(t=Promise))(function(r,a){function c(l){try{s(o.next(l))}catch(S){a(S)}}function u(l){try{s(o.throw(l))}catch(S){a(S)}}function s(l){l.done?r(l.value):i(l.value).then(c,u)}s((o=o.apply(e,n||[])).next())})}function Y(e,n){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},o,i,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(l){return u([s,l])}}function u(s){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(t=0)),t;)try{if(o=1,i&&(r=s[0]&2?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[s[0]&2,r.value]),s[0]){case 0:case 1:r=s;break;case 4:return t.label++,{value:s[1],done:!1};case 5:t.label++,i=s[1],s=[0];continue;case 7:s=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(s[0]===6||s[0]===2)){t=0;continue}if(s[0]===3&&(!r||s[1]>r[0]&&s[1]<r[3])){t.label=s[1];break}if(s[0]===6&&t.label<r[1]){t.label=r[1],r=s;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(s);break}r[2]&&t.ops.pop(),t.trys.pop();continue}s=n.call(e,t)}catch(l){s=[6,l],i=0}finally{o=r=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}function Q(e,n,t){if(t||arguments.length===2)for(var o=0,i=n.length,r;o<i;o++)(r||!(o in n))&&(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))}f.__awaiter=J;f.__extends=X;f.__generator=Y;f.__spreadArray=Q});var L=w((yt,P)=>{"use strict";var p=Symbol("localStorageSupport"),z=function(){function e(){}return Object.defineProperty(e.prototype,"isLocalStorageSupport",{get:function(){if(this[p]==null)try{return window.localStorage.setItem("test","4"),window.localStorage.removeItem("test"),this[p]=!0,!0}catch{return this[p]=!1,!1}else return this[p]},enumerable:!1,configurable:!0}),e}();P.exports=z});var N=w((vt,R)=>{"use strict";var W=$(),Z=L();function tt(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var et=tt(Z),nt=function(e){W.__extends(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.setItem=function(t,o,i){if(!!this.isLocalStorageSupport){if(!i){window.localStorage.setItem(t,o);return}var r={localData:o,expires:new Date().getTime()+i};window.localStorage.setItem(t,JSON.stringify(r))}},n.prototype.removeItem=function(t){this.isLocalStorageSupport&&window.localStorage.removeItem(t)},n.prototype.getItem=function(t){if(!this.isLocalStorageSupport)return null;var o=window.localStorage.getItem(t);if(!o)return null;try{var i=JSON.parse(o);if(!(i!=null&&i.localData))return o;var r=i.localData,a=i.expires,c=new Date().getTime();return a&&c>a?(window.localStorage.removeItem(t),null):r}catch{}return o},n}(et.default),ot=new nt;R.exports=ot});var ct={};q(ct,{getRiskDeepKnowIds:()=>at,initRiskDeepKnow:()=>st});var d={FORTER_EU:"22g4zl{5jf5fjtlv1forxgiurqw1qhw2vwdwxv",FORTER_SITE_ID_TEST:"a237e10ed4bb",FORTER_SITE_ID_PRD:"4263724d8cad",FORTER_SRI_TEST:"sha256-aCY6agqGAy/gKSR2BMdxxRsOhleavoon6w0nrA0ghNw=",FORTER_SRI_PRD:"sha256-CA0gboJChhEOQwIR8nqKsmd6n8WGYAsftvV3WjdK7bc=",KOUNT_HOST_TEST:"tst.kaptcha.com",KOUNT_HOST_PRD:"ssl.kaptcha.com",KOUNT_CLIENT_ID:"601090",KOUNT_GET_SESSION_ID_API:"/v1/usrcsrv/session/getkey",ENABLE_SERVICES:["forter","kount"]};var D="";function M(e){let n=document.createElement("script"),t=e?d.FORTER_SITE_ID_PRD:d.FORTER_SITE_ID_TEST,o=e?d.FORTER_SRI_PRD:d.FORTER_SRI_TEST;n.type="text/javascript",n.id=t,n.text=`
    (function () {
        var merchantConfig = {
            csp: false
        };
        var sri = '${o}';
        var siteId = '${t}';
        function t(t,n){for(var e=t.split(""),r=0;r<e.length;++r)e[r]=String.fromCharCode(e[r].charCodeAt(0)+n);return e.join("")}function n(n){return t(n,-x).replace(/%SN%/g,siteId)}function e(){var t="no"+"op"+"fn",n="g"+"a",e="n"+"ame";return window[n]&&window[n][e]===t}function r(){return!(!navigator.brave||"function"!=typeof navigator.brave.isBrave)}function o(){return document.currentScript&&document.currentScript.src}function i(t){try{if("number"==typeof t&&window.location&&window.location.pathname){for(var n=window.location.pathname.split("/"),e=[],r=0;r<=Math.min(n.length-1,Math.abs(t));r++)e.push(n[r]);return e.join("/")||"/"}}catch(t){}return"/"}function c(t){try{B.ex=t,e()&&-1===B.ex.indexOf(O.uB)&&(B.ex+=O.uB),r()&&-1===B.ex.indexOf(O.uBr)&&(B.ex+=O.uBr),o()&&-1===B.ex.indexOf(O.nIL)&&(B.ex+=O.nIL),window.ftr__snp_cwc||(B.ex+=O.s),V(B)}catch(t){}}function a(t,n){function e(o){try{o.blockedURI===t&&(n(),document.removeEventListener(r,e))}catch(t){document.removeEventListener(r,e)}}var r="securitypolicyviolation";document.addEventListener(r,e),setTimeout(function(){document.removeEventListener(r,e)},2*60*1e3)}function u(t,n,e,r){var o=!1;n&&(t=t.replace("%I%",encodeURIComponent(n))),t="https://"+t,a(t,function(){r(!0),o=!0});var i=document.createElement("script");i.onerror=function(){if(!o)try{r(!1),o=!0}catch(t){}},i.onload=e,i.type="text/javascript",i.id="ftr__script",i.async=!0,i.src=t,n&&(i.integrity=n,i.crossOrigin=!0);var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(i,c)}function d(t,n,e,r){var o=!1,i=new XMLHttpRequest;if(a("https:"+t,function(){e(new Error("CSP Violation"),!0),o=!0}),"//"===t.slice(0,2)&&(t="https:"+t),"withCredentials"in i)i.open("GET",t,!0);else{if("undefined"==typeof XDomainRequest)return;i=new XDomainRequest,i.open("GET",t)}Object.keys(r).forEach(function(t){i.setRequestHeader(t,r[t])}),i.onload=function(){"function"==typeof n&&n(i)},i.onerror=function(t){if("function"==typeof e&&!o)try{e(t,!1),o=!0}catch(t){}},i.onprogress=function(){},i.ontimeout=function(){"function"==typeof e&&e("tim"+"eo"+"ut",!1)},setTimeout(function(){i.send()},0)}function f(t,siteId,n){function e(t){var n=t.toString(16);return n.length%2?"0"+n:n}function r(t){if(t<=0)return"";for(var n="0123456789abcdef",e="",r=0;r<t;r++)e+=n[Math.floor(Math.random()*n.length)];return e}function o(t){for(var n="",r=0;r<t.length;r++)n+=e(t.charCodeAt(r));return n}function i(t){for(var n=t.split(""),e=0;e<n.length;++e)n[e]=String.fromCharCode(255^n[e].charCodeAt(0));return n.join("")}n=n?"1":"0";var c=[];return c.push(t),c.push(siteId),c.push(n),function(t){var n=40,e="";return t.length<n/2&&(e=","+r(n/2-t.length-1)),o(i(t+e))}(c.join(","))}function s(){function t(){D&&(z(O.dUAL),setTimeout(w,F,O.dUAL))}function n(t,n){c(n?O.uAS+O.uF+O.cP:O.uAS+O.uF)}window.ftr__fdad(t,n)}function w(t){try{var n=t===O.uDF?b:D;if(!n)return;var e=function(){try{$(),c(t+O.uS)}catch(t){}},r=function(n){try{$(),B.td=1*new Date-B.ts,c(n?t+O.uF+O.cP:t+O.uF),t===O.uDF&&s()}catch(t){c(O.eUoe)}};u(n,sri,e,r)}catch(n){c(t+O.eTlu)}}var h="22g5o{trgtes|:f51forxgiurqw1qhw2vwdwxv",m="fort",v="erTo",l="ken";window.ftr__config={m:merchantConfig,s:"21",si:siteId};var p=!1,g=m+v+l,_=400*24*60,y=10,T={write:function(t,n,e,r){void 0===r&&(r=!0);var o=0;window.ftr__config&&window.ftr__config.m&&window.ftr__config.m.ckDepth&&(o=window.ftr__config.m.ckDepth);var c,a,u=i(o);if(e?(c=new Date,c.setTime(c.getTime()+60*e*1e3),a="; expires="+c.toGMTString()):a="",!r)return void(document.cookie=escape(t)+"="+escape(n)+a+"; path="+u);for(var d=1,f=document.domain.split("."),s=y,w=!0;w&&f.length>=d&&s>0;){var h=f.slice(-d).join(".");document.cookie=escape(t)+"="+escape(n)+a+"; path="+u+"; domain="+h;var m=T.read(t);null!=m&&m==n||(h="."+h,document.cookie=escape(t)+"="+escape(n)+a+"; path="+u+"; domain="+h),w=-1===document.cookie.indexOf(t+"="+n),d++,s--}},read:function(t){var n=null;try{for(var e=escape(t)+"=",r=document.cookie.split(";"),o=32,i=0;i<r.length;i++){for(var c=r[i];c.charCodeAt(0)===o;)c=c.substring(1,c.length);0===c.indexOf(e)&&(n=unescape(c.substring(e.length,c.length)))}}finally{return n}}},L=window.ftr__config.s;L+="ck";var S=function(t){var n=!1,e=null,r=function(){try{if(!e||!n)return;e.remove&&"function"==typeof e.remove?e.remove():document.head.removeChild(e),n=!1}catch(t){}};document.head&&(!function(){e=document.createElement("link"),e.setAttribute("rel","pre"+"con"+"nect"),e.setAttribute("cros"+"sori"+"gin","anonymous"),e.onload=r,e.onerror=r,e.setAttribute("href",t),document.head.appendChild(e),n=!0}(),setTimeout(r,3e3))},x=3,k=n(h||"22g5o{trgtes|:f51forxgiurqw1qhw2vwdwxv"),A=t("[0Uhtxhvw0LG",-x),U=t("[0Fruuhodwlrq0LG",-x),C=t("Li0Qrqh0Pdwfk",-x),D,I="fgq71iruwhu1frp",b=n("(VQ(1"+I+"2vq2(VQ(2(L(2vfulsw1mv"),E=n("(VQ(1"+I+"2vqV2(VQ(2(L(2vfulsw1mv"),F=10;window.ftr__startScriptLoad=1*new Date;var R=function(t){var n="ft"+"r:tok"+"enR"+"eady";window.ftr__tt&&clearTimeout(window.ftr__tt),window.ftr__tt=setTimeout(function(){try{delete window.ftr__tt,t+="_tt";var e=document.createEvent("Event");e.initEvent(n,!1,!1),e.detail=t,document.dispatchEvent(e)}catch(t){}},1e3)},V=function(t){var n=function(t){return t||""},e=n(t.id)+"_"+n(t.ts)+"_"+n(t.td)+"_"+n(t.ex)+"_"+n(L),r=_;!isNaN(window.ftr__config.m.ckTTL)&&window.ftr__config.m.ckTTL&&(r=window.ftr__config.m.ckTTL),T.write(g,e,r,!0),R(e),window.ftr__gt=e},q=function(){var t=T.read(g)||"",n=t.split("_"),e=function(t){return n[t]||void 0};return{id:e(0),ts:e(1),td:e(2),ex:e(3),vr:e(4)}},M=function(){for(var t={},n="fgu",e=[],r=0;r<256;r++)e[r]=(r<16?"0":"")+r.toString(16);var o=function(t,n,r,o,i){var c=i?"-":"";return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+c+e[255&n]+e[n>>8&255]+c+e[n>>16&15|64]+e[n>>24&255]+c+e[63&r|128]+e[r>>8&255]+c+e[r>>16&255]+e[r>>24&255]+e[255&o]+e[o>>8&255]+e[o>>16&255]+e[o>>24&255]},i=function(){if(window.Uint32Array&&window.crypto&&window.crypto.getRandomValues){var t=new window.Uint32Array(4);return window.crypto.getRandomValues(t),{d0:t[0],d1:t[1],d2:t[2],d3:t[3]}}return{d0:4294967296*Math.random()>>>0,d1:4294967296*Math.random()>>>0,d2:4294967296*Math.random()>>>0,d3:4294967296*Math.random()>>>0}},c=function(){var t="",n=function(t,n){for(var e="",r=t;r>0;--r)e+=n.charAt(1e3*Math.random()%n.length);return e};return t+=n(2,"0123456789"),t+=n(1,"123456789"),t+=n(8,"0123456789")};return t.safeGenerateNoDash=function(){try{var t=i();return o(t.d0,t.d1,t.d2,t.d3,!1)}catch(t){try{return n+c()}catch(t){}}},t.isValidNumericalToken=function(t){return t&&t.toString().length<=11&&t.length>=9&&parseInt(t,10).toString().length<=11&&parseInt(t,10).toString().length>=9},t.isValidUUIDToken=function(t){return t&&32===t.toString().length&&/^[a-z0-9]+$/.test(t)},t.isValidFGUToken=function(t){return 0==t.indexOf(n)&&t.length>=12},t}(),O={uDF:"UDF",dUAL:"dUAL",uAS:"UAS",mLd:"1",eTlu:"2",eUoe:"3",uS:"4",uF:"9",tmos:["T5","T10","T15","T30","T60"],tmosSecs:[5,10,15,30,60],bIR:"43",uB:"u",uBr:"b",cP:"c",nIL:"i",s:"s"};try{var B=q();try{B.id&&(M.isValidNumericalToken(B.id)||M.isValidUUIDToken(B.id)||M.isValidFGUToken(B.id))?window.ftr__ncd=!1:(B.id=M.safeGenerateNoDash(),window.ftr__ncd=!0),B.ts=window.ftr__startScriptLoad,V(B),window.ftr__snp_cwc=!!T.read(g),window.ftr__snp_cwc||(b=E);for(var G="for"+"ter"+".co"+"m",N="ht"+"tps://c"+"dn9."+G,j="ht"+"tps://"+B.id+"-"+siteId+".cd"+"n."+G,H="http"+"s://cd"+"n3."+G,P=[N,j,H],Q=0;Q<P.length;Q++)S(P[Q]);var X=new Array(O.tmosSecs.length),z=function(t){for(var n=0;n<O.tmosSecs.length;n++)X[n]=setTimeout(c,1e3*O.tmosSecs[n],t+O.tmos[n])},$=function(){for(var t=0;t<O.tmosSecs.length;t++)clearTimeout(X[t])};window.ftr__fdad=function(n,e){if(!p){p=!0;var r={};r[C]=f(window.ftr__config.s,siteId,window.ftr__config.m.csp),d(k,function(e){try{var r=e.getAllResponseHeaders().toLowerCase();if(r.indexOf(U.toLowerCase())>=0){var o=e.getResponseHeader(U);window.ftr__altd2=t(atob(o),-x-1)}if(r.indexOf(A.toLowerCase())<0)return;var i=e.getResponseHeader(A),c=t(atob(i),-x-1);if(c){var a=c.split(":");if(a&&2===a.length){for(var u=a[0],d=a[1],f="",s=0,w=0;s<20;++s)f+=s%3>0&&w<12?siteId.charAt(w++):B.id.charAt(s);var h=d.split(",");if(h.length>1){var m=h[0],v=h[1];D=u+"/"+encodeURIComponent(sri)+"/"+m+"."+f+"."+v}}}n()}catch(t){}},function(t,n){e&&e(t,n)},r)}},z(O.uDF),setTimeout(w,F,O.uDF)}catch(t){c(O.mLd)}}catch(t){}})();
  `,document.body.appendChild(n)}function k(e=!1){return console.log("[forter] init"),new Promise(n=>{document.addEventListener("ftr:tokenReady",t=>{D=t.detail,n(!0)}),M(e)})}function E(){return D}var H="1.1.4",h=class{constructor(n,t){if(typeof n!="number")throw`ttlms is not number: ${typeof n}`;if(typeof t!="boolean")throw`collect is not boolean: ${typeof t}`;this.ttlms=n,this.collect=t}static createDefaultServerConfig(){return new h(9e5,!0)}};function _(config,sessionID){let sdk={KountSDKVersion:H,kountClientID:null,isSinglePageApp:!1,collectorURL:null,sessionID:null,FPCV_COOKIE_NAME:"clientside-cookie",FPCV_LOCAL_STORAGE_KEY:"clientside-local",FPCV_SESSION_STORAGE_KEY:"kountCookie",SESSION_STORAGE_KEY_SESSION_ID:"KountSessionID",collectBehaviorData:!1,collectionCompleteTimeout:5e3,callbacks:{},isCompleted:!1,error:[],isDebugEnabled:!1,LOG_PREFIX:"k:",serverConfig:null,orchestrateTimeoutId:null,updateSDKServerConfigTimeoutInMS:3e3,orchestrateSemaphoreLocked:!1,start(e,n){if(typeof e>"u")return window.console&&window.console.log&&console.log(`${this.LOG_PREFIX}SDK Disabled: config required.`),!1;this.isDebugEnabled=typeof e.isDebugEnabled<"u"&&typeof e.isDebugEnabled=="boolean"&&e.isDebugEnabled,this.log(`SDK isDebugEnabled=${this.isDebugEnabled}`),this.log("SDK starting...");let t=e.clientID;if(typeof t>"u"||t.length===0)return this.log("SDK Disabled: clientID required."),!1;this.kountClientID=t,typeof e.callbacks<"u"&&(this.callbacks=e.callbacks);let o=e.hostname;if(typeof o>"u"||!this.isHostnameValid(o))return this.log(`SDK Disabled: invalid hostname:${o}`),!1;this.collectorURL=`https://${o}`,this.log(`collectorURL=${this.collectorURL}`);let i=e.isSinglePageApp;return typeof i>"u"||i!==!0&&i!==!1?(this.log(`SDK Disabled: invalid isSinglePageApp:${i}`),!1):(this.isSinglePageApp=i,this.log(`isSinglePageApp=${this.isSinglePageApp}`),typeof n>"u"||n.length===0?(this.log("SDK Disabled: sessionID required."),!1):(this.sessionID=n,this._communicateLatestSessionData(),this._orchestrate(),this.log(`SDK Version=${this.KountSDKVersion}`),this.log("SDK started."),!0))},_orchestrate:async function(){let e="_orchestrate",n=!1;try{if(this.orchestrateSemaphoreLocked){this.log(`${e} gated by semaphore. Skipping...`);return}this.orchestrateSemaphoreLocked=!0,n=!0,this.log(`${e} start...`),await this._updateSDKServerConfig(),this.serverConfig.collect?(this.log(`${e} runCollector start...`),this.runCollector(),this.log(`${e} runCollector end...`)):(this.log(`${e} runCollector skipped...`),this.callback("collect-begin",{SessionID:this.sessionID,KountClientID:this.kountClientID}),this.callback("collect-end",{SessionID:this.sessionID,KountClientID:this.kountClientID}))}catch(t){let o=`${e} unexpected error: ${t}`;this.log(o),this.addError(o)}finally{if(!n)return;clearTimeout(this.orchestrateTimeoutId),this.log(`${e} config:${JSON.stringify(this.serverConfig)}`);let t=this.serverConfig.ttlms;this.orchestrateTimeoutId=setTimeout(this._orchestrate.bind(this),t),this.log(`${e} scheduled for ${t} ms`),this.log(`${e} end...`),this.orchestrateSemaphoreLocked=!1}},_wrapPromiseInTimeout(e,n){return new Promise((t,o)=>{let i=setTimeout(()=>{o(new Error(`Timeout after ${e}ms.`))},e);n.then(r=>{clearTimeout(i),t(r)}).catch(r=>{clearTimeout(i),o(r)})})},async _updateSDKServerConfig(){let e="_updateSDKServerConfig";try{this.log(`${e} start...`);let n=`${this.collectorURL}/cs/config?m=${this.kountClientID}&s=${this.sessionID}&sv=${this.KountSDKVersion}`,t=await this._wrapPromiseInTimeout(this.updateSDKServerConfigTimeoutInMS,fetch(n));if(!t.ok){let i=`${e} response not ok: ${t.status}`;throw this.addError(i),this.log(i),i}let o=await t.json();if(typeof o.ttlms>"u"||typeof o.collection>"u"||typeof o.collection.collect>"u"){let i=`${e} invalid response JSON:${JSON.stringify(o)}`;throw this.log(i),this.addError(i),i}this.serverConfig=new h(o.ttlms,o.collection.collect),this.log(`${e} config:${JSON.stringify(this.serverConfig)}`)}catch(n){this.serverConfig=h.createDefaultServerConfig();let t=`${e} error caught. Defaulted config: ${JSON.stringify(this.serverConfig)} e:${n}`;this.log(t),this.addError(t)}finally{this.log(`${e} end...`)}},isHostnameValid(e){return typeof e!="string"?(this.log(`Invalid hostname: not a string: ${typeof e}`),!1):e.length===0?(this.log("Invalid hostname: length 0."),!1):/^[a-zA-Z0-9.]*$/g.test(e)?!0:(this.log(`Invalid hostname:${e}`),!1)},_communicateLatestSessionData(){try{this.log("communicateLatestSessionData running...");let e=sessionStorage.getItem(this.SESSION_STORAGE_KEY_SESSION_ID);e===null?this.postNewSession(this.sessionID):e!==this.sessionID&&this.postChangeSession(this.sessionID,e),sessionStorage.setItem(this.SESSION_STORAGE_KEY_SESSION_ID,this.sessionID)}catch(e){this.addError(`communicateLatestSessionData error:${e}`)}finally{this.log("communicateLatestSessionData ending...")}},async postNewSession(e){try{this.log("postNewSession running...");let n=`${this.collectorURL}/session/${e}`;this._postToURL(n,"postNewSession")}catch(n){this.addError(`postNewSession error:${n}`)}finally{this.log("postNewSession ending...")}},async postChangeSession(e,n){try{this.log(`postChangeSession running: newSession: ${e} prevSession: ${n}`);let t=`${this.collectorURL}/session/${this.sessionID}?previousSessionID=${n}`;this._postToURL(t,"postChangeSession")}catch(t){this.addError(`postChangeSession error:${t}`)}finally{this.log("postChangeSession ending...")}},async _postToURL(e,n){try{this.log(`_postToURL:${n} running...`);let t=new XMLHttpRequest;t.onreadystatechange=()=>{t.readyState===XMLHttpRequest.DONE&&(t.status===200||t.status===201?this.log(`${n} success.`):(this.addError(`${n} unknown response: ${t.status}`),this.log(`${this.error}:unknown response - ${t.status}`)))},t.open("POST",e,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("client-id",this.kountClientID),t.send()}catch(t){throw t}finally{this.log(`_postToURL:${n} ending...`)}},getFPCVFromLocalStorage(){try{this.log("getFPCVFromLocalStorage running...");let e=localStorage.getItem(this.FPCV_LOCAL_STORAGE_KEY);return e==null?"":e}catch(e){return this.addError(`getFPCVFromLocalStorage: error${e}`),""}},getFPCVFromCookie(){try{this.log("getFPCVFromCookie running...");let n=decodeURIComponent(document.cookie).split(";"),t="";for(let o=0;o<n.length;o++){let r=n[o].trim().split("=");if(r.length===2&&r[0]===this.FPCV_COOKIE_NAME){[,t]=r,this.log(`getFPCVFromCookie: found new first party cookie: ${t}`);break}}if(t===""){let o=/(cdn[.][a-z]+[.][0-9]+[.]ka.ck)/g;for(let i=0;i<n.length;i++){let r=n[i].trim();if(o.test(r)===!0){let a=r.split("=");if(a.length===2){[,t]=a,this.log(`getFPCVFromCookie: found old first party cookie: ${t}`),this.storeFPCVInCookie(t);break}}}}return t}catch(e){return this.addError(`getFPCVFromCookie error:${e}`),""}},storeFPCVInLocalStore(e){try{this.log("storeFPCVInLocalStore running..."),localStorage.setItem(this.FPCV_LOCAL_STORAGE_KEY,e)}catch(n){this.addError(`storeFPCVInLocalStore error:${n}`)}finally{this.log("storeFPCVInLocalStore ending...")}},storeFPCVInCookie(e){try{this.log("storeFPCVInCookie running...");let n=365,t=new Date;t.setTime(t.getTime()+n*24*60*60*1e3);let o=`expires=${t.toUTCString()}`,i="; SameSite=None; Secure";window.location.protocol!=="https:"&&(i="; SameSite=Lax"),document.cookie=`${this.FPCV_COOKIE_NAME}=${e};${o};path=/${i}`}catch(n){this.addError(`storeFPCVInCookie error:${n}`)}finally{this.log("storeFPCVInCookie ending...")}},storeFPCVInSession(e){try{this.log("storeFPCVInSession running..."),sessionStorage.setItem(sdk.FPCV_SESSION_STORAGE_KEY,e)}catch(n){this.addError(`storeFPCVInSession error:${n}`)}},coordinateFirstPartyCookieValues(){this.log("coordinateFirstPartyCookieValues running...");let e="",n=this.getFPCVFromCookie(),t=this.getFPCVFromLocalStorage();this.storeFPCVInSession(""),n===""&&t===""?e="":n!==""&&t===""?(this.storeFPCVInLocalStore(n),e=n):t!==""&&n===""?(this.storeFPCVInCookie(t),e=t):t===n&&t!==""&&n!==""?e=t:t!==n&&t!==""&&n!==""&&(this.storeFPCVInCookie(t),e=t),e===""?this.establishNewFPCV():this.communicateExistingFPCV(e)},async establishNewFPCV(){try{this.log("establishNewFPCV running...");let e=`${this.collectorURL}/cs/generatecookie?m=${this.kountClientID}&s=${this.sessionID}&sv=${this.KountSDKVersion}`,t=await(await fetch(e)).json();if(t.value.length>0){let o=t.value;this.storeFPCVInCookie(o),this.storeFPCVInLocalStore(o),this.storeFPCVInSession(o)}}catch(e){this.addError(`establishNewFPCV error:${e}`)}finally{this.log("establishNewFPCV ending...")}},async communicateExistingFPCV(e){try{this.log("communicateExistingFPCV running...");let n=`${this.collectorURL}/cs/storecookie`,t=`m=${this.kountClientID}&s=${this.sessionID}&sv=${this.KountSDKVersion}&k=${e}`,o=new XMLHttpRequest;o.onreadystatechange=()=>{o.readyState===4&&o.status===500&&(this.log("communicateExistingFPCV: invalid cookie"),sdk.establishNewFPCV()),o.readyState===4&&o.status===200&&(this.log("communicateExistingFPCV: valid cookie"),sdk.storeFPCVInSession(e))},o.open("POST",n,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(t)}catch(n){this.addError(`communicateExistingFPCV error:${n}`)}},_createIframe(){let functionName="_createIframe";try{this.log(`${functionName} running...`);let iframeId="ibody",priorIframe=document.getElementById(iframeId);priorIframe!==null&&priorIframe.remove();let queryString=`m=${this.kountClientID}&s=${this.sessionID}&sv=${this.KountSDKVersion}`,iframe=document.createElement("iframe");iframe.id=iframeId,iframe.style.border="0px",iframe.style.height="1px",iframe.style.width="1px",iframe.style.position="absolute",iframe.src=`${this.collectorURL}/logo.htm?${queryString}`,document.getElementsByTagName("body")[0].appendChild(iframe),typeof this.callbacks<"u"&&this.callback("collect-begin",{SessionID:this.sessionID,KountClientID:this.kountClientID}),window.postMessage!=="undefined"&&window.onmessage!=="undefined"?(window.onmessage=event=>{let data=null;if(event.origin===this.collectorURL){JSON?data=JSON.parse(event.data):data=eval(event.data),this.isSinglePageApp||data.event==="collect-end"&&this.detach(window,"unload",this.unloadHandler);let params={};Object.keys(data.params).forEach(e=>{if(Object.prototype.hasOwnProperty.call(data.params,e))switch(e){case"s":params.SessionID=data.params[e];break;case"m":params.KountClientID=data.params[e];break;default:params[e]=data.params[e]}}),this.isCompleted=!0,this.callback(data.event,params)}},this.isSinglePageApp||this.attach(window,"unload",this.unloadHandler)):window.setTimeout(()=>{this.isCompleted=!0,this.callback("collect-end",{SessionID:this.sessionID,KountClientID:this.kountClientID})},3e3)}catch(e){this.addError(`${functionName} error:${e}`)}finally{this.log(`${functionName} ending...`)}},runCollector(){let e="runCollector";try{this.log(`${e} running...`),this.isCompleted=!1,setTimeout(()=>{this.isCompleted=!0},this.collectionCompleteTimeout),this.coordinateFirstPartyCookieValues();let n=(t,o)=>new Promise((i,r)=>{let a=()=>{sessionStorage.getItem(this.FPCV_SESSION_STORAGE_KEY)!==""?(this._createIframe(),i()):(t-=o)<0?r():setTimeout(a,o)};setTimeout(a,o)});(async()=>n(2e3,10).then(()=>this.log(`${e}: Collection Initiated`)).catch(()=>this.log(`${e}: Invalid/Missing First Party cookie`)))()}catch(n){this.addError(`${e} error:${n}`)}finally{this.log(`${e} ending...`)}},AttachToForm(e,n=new Map){this.log("AttachToForm running...");let t="kountDecisionPointUUID";this.collectBehaviorData,this.log("AttachToForm: Attaching to form...");let o=document.getElementById(e);if(n!=null&&n.has("CustomFieldName")&&n.get("CustomFieldName").length>0&&(this.log(`AttachToForm: Overriding decisionPointField name to: ${n.get("CustomFieldName")}`),t=n.get("CustomFieldName")),o!=null){if(typeof o[t]>"u"){let i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",t),i.setAttribute("value",this.sessionID),o.appendChild(i),this.log(`AttachToForm: Field ${t} NOT found.                     Created and attached to form with value: ${this.sessionID}`)}else this.log(`AttachToForm: Field ${t} found, setting value to: ${this.sessionID}`),o[t].setAttribute("value",this.sessionID);this.log(`AttachToForm: Attached to form successfully using ${this.sessionID}                 value in ${t} hidden field.`)}else this.addError(`AttachToForm: FormID: ${e} is not valid. Skipping attachment to form and collection.`)},NewSession(e){typeof e>"u"?this.addError("NewSession: Invalid sessionID.  You must set the 'sessionID' for collection. Disabling Kount SDK"):(this.log(`NewSession: SessionID set to: ${e}`),sessionStorage.clear(),this.sessionID=e,this._communicateLatestSessionData(),this._orchestrate())},IsCompleted(){return this.isCompleted},log(e){this.isDebugEnabled&&window.console&&window.console.debug&&console.debug(`${this.LOG_PREFIX}${e}`)},addError(e){this.error.push(e),this.log(e)},callback(e,n){if(typeof this.callbacks[e]<"u"){let t=this.callbacks[e];this.callbacks[e]=void 0,t(n)}},unloadHandler(e){let n="fin",t={n:"collect-end",com:"false",et:0,s:this.sessionID,m:this.kountClientID};try{this.getXMLHttpRequest(n,"POST").send(t)}catch{}},getXMLHttpRequest(e,n){let t=null,o=encodeURIComponent||escape,i=`${this.collectorURL}/${e}`;if(window.XMLHttpRequest){try{t=new window.XMLHttpRequest}catch{}"withCredentials"in t?t.open(n,i,!1):typeof window.XDomainRequest<"u"?(t=new window.XDomainRequest,t.open(n,i)):t=null}else t=null;return{send(r){if(!t)return;t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");let a="";Object.keys(r).forEach(c=>{Object.prototype.hasOwnProperty.call(r,c)&&(a+=`&${o(c)}=${o(r[c])}`)}),a=a.substring(1),t.send(a)}}},attach:function e(){return typeof document.addEventListener<"u"?function(t,o,i){t.addEventListener(o,i,!1)}:typeof document.attachEvent<"u"?function(t,o,i){t.attachEvent(`on${o}`,i)}:function(t,o,i){}}(),detach:function e(){return typeof document.removeEventListener<"u"?function(t,o,i){t.removeEventListener(o,i,!1)}:typeof document.detachEvent<"u"?function(t,o,i){t.detach(`on${o}`,i)}:function(t,o,i){}}()};try{if(sdk.start(config,sessionID))return sdk}catch(e){}return null}function y(e){if(document.cookie.length>0){let n=document.cookie.indexOf(e+"=");if(n!=-1){n=n+e.length+1;let t=document.cookie.indexOf(";",n);return t==-1&&(t=document.cookie.length),unescape(document.cookie.substring(n,t))}}}function T(e,n,t){let o="";if(t){var i=new Date;i.setTime(i.getTime()+t*24*60*60*1e3),o="; expires="+i.toUTCString()}document.cookie=e+"="+n+o+"; path=/"}function m(e,n={}){return new Promise((t,o)=>{let i=new XMLHttpRequest;n&&n.timeout&&(i.timeout=n.timeout),i.open("GET",e,!0),i.addEventListener("readystatechange",()=>{if(i.readyState!==4)return;let r=i.status||0;if(r!==200)return o({success:!1,error:{status:r,message:/50\d/.test(String(r))?"Internal Server Error":"Request failed"}});try{t(JSON.parse(i.response))}catch{t({success:!1,error:{message:"JSON parse error"}})}}),i.onerror=r=>o(r),i.ontimeout=()=>o("timeout"),i.send()})}var O="";function j(){return new Promise((e,n)=>{y("KOUNT_SESSION_ID")?e(y("KOUNT_SESSION_ID")):m(d.KOUNT_GET_SESSION_ID_API).then(t=>{if(t&&t.success&&t.result){let o=t.result.sid;T("KOUNT_SESSION_ID",o,30),e(o)}else n(t.error.message)}).catch(t=>n(t))})}function F(e=!1){return console.log("[kount] init"),new Promise(async(n,t)=>{let o="";try{o=await j()}catch(r){t(`KlkRiskDeepKnowSDK: request kount SessionId Failed(${r})`);return}let i={clientID:d.KOUNT_CLIENT_ID,hostname:e?d.KOUNT_HOST_PRD:d.KOUNT_HOST_TEST,isSinglePageApp:!1,callbacks:{"collect-begin":function(r){O=r.SessionID,n(!0)}}};_(i,o)})}function b(){return O}var I=B(N()),it=30*60*1e3;function rt(e){let n=e.map(t=>Promise.resolve(t).then(o=>({status:"fulfilled",value:o})).catch(o=>({state:"rejected",reason:o})));return Promise.all(n)}function st(e={isPrdEnv:!1,platform:"desktop"}){return new Promise((n,t)=>{let o=d.ENABLE_SERVICES,i=I.default.getItem("klk_risk");function r(a){let c=[];try{for(let u of a)u==="forter"&&c.push(k(e.isPrdEnv)),u==="kount"&&c.push(F(e.isPrdEnv));c.length?rt(c).then(u=>{if(u.every(s=>s.status==="rejected"))t("init KLK risk deep know SDK failed");else{let s="";for(let l of u)l.status==="rejected"&&(s+=l.reason+";");n(s.length?s:!0)}}):n(!0)}catch(u){t(u)}}i&&Array.isArray(i)?(o=i,r(o)):m("/v1/riskfraudserv/public/third/service/list",{timeout:6e3}).then(a=>{a&&a.success&&a.result&&Array.isArray(a.result)&&(o=a.result,I.default.setItem("klk_risk",a.result,it))}).catch(()=>{}).finally(()=>{r(o)})})}function at(){return{forterToken:E(),kountSessionId:b()}}return G(ct);})();
