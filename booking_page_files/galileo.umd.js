(function(ie,Q){typeof exports=="object"&&typeof module!="undefined"?Q(require("vue")):typeof define=="function"&&define.amd?define(["vue"],Q):(ie=typeof globalThis!="undefined"?globalThis:ie||self,Q(ie.J))})(this,function(ie){"use strict";var Fo=Object.defineProperty,Wo=Object.defineProperties;var Go=Object.getOwnPropertyDescriptors;var Qn=Object.getOwnPropertySymbols;var Ko=Object.prototype.hasOwnProperty,Qo=Object.prototype.propertyIsEnumerable;var Bt=(ie,Q,ee)=>Q in ie?Fo(ie,Q,{enumerable:!0,configurable:!0,writable:!0,value:ee}):ie[Q]=ee,L=(ie,Q)=>{for(var ee in Q||(Q={}))Ko.call(Q,ee)&&Bt(ie,ee,Q[ee]);if(Qn)for(var ee of Qn(Q))Qo.call(Q,ee)&&Bt(ie,ee,Q[ee]);return ie},he=(ie,Q)=>Wo(ie,Go(Q));var M=(ie,Q,ee)=>Bt(ie,typeof Q!="symbol"?Q+"":Q,ee);var K=(ie,Q,ee)=>new Promise((ht,Se)=>{var Ne=ce=>{try{z(ee.next(ce))}catch(Re){Se(Re)}},Ze=ce=>{try{z(ee.throw(ce))}catch(Re){Se(Re)}},z=ce=>ce.done?ht(ce.value):Promise.resolve(ce.value).then(Ne,Ze);z((ee=ee.apply(ie,Q)).next())});var Te;function Q(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in t)){const a=Object.getOwnPropertyDescriptor(i,s);a&&Object.defineProperty(t,s,a.get?a:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var ee=t=>t==null,ht=t=>Object.prototype.toString.call(t),Se=t=>e=>e!==null&&(Array.isArray(t)?t:[t]).some(n=>ht(e)===`[object ${n}]`),Ne=Se("String"),Ze=t=>Se("Boolean")(t),z=Se(["Function","AsyncFunction","GeneratorFunction"]),ce=Se("Object"),Re=Se("Undefined"),dt=t=>Number.isInteger(t);function Yn(t){if(!z(t))return!1;const e=Function.prototype.toString.call(t);if(/^class[\s{]/.test(e))return!0;const n=e.replace(/^[^{]*\{\s*/,"").replace(/\s*\}[^}]*$/,"");return/classCallCheck\(/.test(n)||/TypeError\("Cannot call a class as a function"\)/.test(n)}function Xn(t){return z(t==null?void 0:t.then)}var ft=["debug","info","warn","error"].reduce((t,e,n,i)=>he(L({},t),{[e]:i.slice(n)}),{});function Zn(){return new Date().toLocaleString()}var ei=class{constructor(t={}){M(this,"options",{debug:!1,prefix:"Galileo",name:"",colors:{info:"#09f",warn:"#f90",error:"#f66",debug:"#888"}});this.set(t)}set(t={}){const e=L(L({},this.options.colors),t.colors||{});this.options=he(L(L({},this.options),t),{colors:e});const{name:n,prefix:i}=this.options;n&&(this.options.prefix=`${i}[${n}]`)}log(t,...e){const{debug:n,prefix:i,colors:s}=this.options;if(Ze(n)&&n||Ne(n)&&ft[n]&&ft[n].includes(t)){const a=s?s[t]:"#888",r=[`%c ${i} %c ${t.toUpperCase()} %c ${e.length?"%o":""}`,`background: ${a}; border: 1px solid ${a}; padding: 1px; border-radius: 4px 0 0 4px; color: #fff;`,`border: 1px solid ${a}; padding: 1px; border-radius: 0 4px 4px 0; color: ${a};`,"background: transparent"];console.log(...r,Zn(),...e)}}info(...t){this.log("info",...t)}debug(...t){this.log("debug",...t)}warn(...t){this.log("warn",...t)}error(...t){this.log("error",...t)}},ti=(t,e)=>new ei(L({prefix:t},e)),ni=t=>Ze(t)?t:t?!!ft[t]:!1;function Je(t,e){if(!e)return t;const n=Object.keys(e);for(let i=0;i<n.length;i++){const s=n[i],a=e[s],r=t[s];Array.isArray(a)?Array.isArray(r)?t[s]=Je(r,a):t[s]=Je([],a):ce(a)?ce(r)?t[s]=Je(r,a):t[s]=Je({},a):(r===void 0||a!==void 0)&&(t[s]=a)}return t}function ii(t,...e){return e.reduce((n,i)=>Je(n,i),t)}function si(t){return new Promise(e=>setTimeout(e,t))}function ai(t,e){const{defaultValue:n=null,throw:i}={};try{return JSON.stringify(t)}catch(s){if(i)throw s;return n}}function oi(t,e){const n=Object.keys(t);for(let i=0;i<n.length;i++){const s=n[i],a=t[s];e(a,s,t)}}var Mt=typeof window!="undefined",gt=()=>{const t=window.safari;return!!(typeof t=="object"&&t.pushNotification)},_t=()=>{const t=navigator.userAgent;return/android/i.test(t)},De=t=>{const e=t||navigator.userAgent;return/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(e)},ye=()=>/klook/i.test(navigator.userAgent),ri=()=>{try{const t="g:__test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return console.log("Not support localStorage",t),!1}},li=t=>{const e={cacheVal:null,isCalled:!1};return()=>(e.isCalled||(e.cacheVal=t(),e.isCalled=!0),e.cacheVal)},ci=li(ri),jt=class{constructor(t){M(this,"_state",[]);M(this,"_options",{max:20});this._options=L(L({},this._options),t)}push(t){const{max:e}=this._options;this._state.length>=e&&this._state.shift(),this._state.push(t)}getLast(t){return this._state.slice(-t)}getState(){return this._state.slice()}},$={HIDDEN:"hidden",VISIBLE:"visible"};function qt(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){const s=t[i],a=e[i];if(!n(s,a))return!1}return!0}function ui(t){const e=[{all:[["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN]],partial:[["visibilitychange",$.HIDDEN],["visibilitychange",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN]]},{all:[["beforeunload",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN],["unload",$.HIDDEN]],partial:[["visibilitychange",$.HIDDEN],["visibilitychange",$.VISIBLE],["beforeunload",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN],["unload",$.HIDDEN]]},{all:[["beforeunload",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN]],partial:[["visibilitychange",$.HIDDEN],["visibilitychange",$.VISIBLE],["beforeunload",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN]]}],n=s=>s.map(a=>({event_name:a[0],visibility:a[1]}));let i=!1;for(let s=0;s<e.length;s++){const a=e[s],r=t.getState(),{all:l,partial:u}=a,v=n(l),p=(b,w)=>b.event_name===w.event_name&&b.visibility===w.visibility;if(qt(r,v,p)){i=!0;break}const g=n(u),m=t.getLast(g.length);if(qt(m,g,p)){i=!0;break}}return i}function He(t,e){t.push({event_name:e,visibility:document.visibilityState})}function hi(t){const e=[["beforeunload","pagehide","unload"],["beforeunload","unload"],["visibilitychange","pagehide","unload"],["visibilitychange","unload"]],n=t.getLast(4).map(i=>i.event_name);return e.some(i=>i.every(s=>n.includes(s)))}function di(t){const e={pagehide:$.VISIBLE,unload:$.HIDDEN};return t.getLast(1).every(i=>{const s=i.event_name;return e[s]===i.visibility})}function fi(t){return De()&&ye()?di(t):gt()?ui(t):hi(t)}function et(t,e){const n=fi(t);e(n)}function gi(t,e){const n=t.getLast(3),i=n.map(s=>s.event_name);if(_t()&&ye()){const s=[{k:"beforeunload",v:$.VISIBLE},{k:"visibilitychange",v:$.HIDDEN}],a=n.slice(-2);s.every((r,l)=>{const{k:u,v}=r,{event_name:p,visibility:g}=a[l]||{};return p===u&&g===v})&&setTimeout(()=>{const[r]=t.getLast(1);if((r==null?void 0:r.event_name)!=="unload")return e()},100);return}i.includes("beforeunload")||e()}var _i=class{constructor(){M(this,"_onBeforeUnload");M(this,"_onPageHide");M(this,"_onPageShow");M(this,"_onPageUnload");M(this,"_onVisibilityChange");M(this,"_subscribers",new Map);M(this,"addListener");M(this,"removeListener");M(this,"states");this.addListener=window.addEventListener.bind(window),this.removeListener=window.removeEventListener.bind(window),this.states=new jt,this.initCallback()}initCallback(){const{states:t}=this;this._onBeforeUnload=()=>{He(t,"beforeunload"),this.onBeforeUnload()},this._onPageHide=e=>{He(t,"pagehide"),this.onPageHide()},this._onPageShow=e=>{He(t,"pageshow"),this.onPageShow()},this._onVisibilityChange=()=>{He(t,"visibilitychange"),this.onVisibilityChange()},this._onPageUnload=()=>{He(t,"unload"),this.onPageUnload()}}onPageShow(){}onPageHide(){De()&&ye()&&et(this.states,t=>{t&&this.onPageLeave({leave_type:"close"})})}onBeforeUnload(){}onPageUnload(){const{states:t}=this;et(t,e=>{De()&&ye()&&t.getLast(4).some(i=>i.event_name==="pagehide")||e&&this.onPageLeave({leave_type:"close"})})}onVisibilityChange(){const{states:t}=this;if(document.visibilityState===$.VISIBLE)this.onPageView({view_type:"show"});else if(De()&&ye()){if(t.getLast(4).some(n=>n.event_name==="pagehide"))return;et(t,n=>{this.onPageLeave({leave_type:n?"close":"hide"})})}else gt()?et(t,e=>{this.onPageLeave({leave_type:e?"close":"hide"})}):gi(t,()=>{this.onPageLeave({leave_type:"hide"})})}onPageView(t){this._callSubs("onPageView",t)}onPageLeave(t){this._callSubs("onPageLeave",t)}_callSubs(t,e){const n=this._subscribers.get(t);n==null||n.forEach(i=>i.fn(e))}subscribe(t,e,n){const i=this._subscribers.get(t)||[];z(n)&&!i.map(s=>s.id).includes(e)&&i.push({id:e,fn:n}),this._subscribers.set(t,i)}unbindEvents(){this.removeListener("pageshow",this._onPageShow),this.removeListener("beforeunload",this._onBeforeUnload),this.removeListener("unload",this._onPageUnload),document.removeEventListener("pagehide",this._onPageHide),document.removeEventListener("visibilitychange",this._onVisibilityChange)}bindEvents(){this.addListener("pageshow",this._onPageShow),this.addListener("beforeunload",this._onBeforeUnload),this.addListener("unload",this._onPageUnload),document.addEventListener("pagehide",this._onPageHide),document.addEventListener("visibilitychange",this._onVisibilityChange)}destroy(){this.unbindEvents(),this._subscribers.clear()}};const se=[];for(let t=0;t<256;++t)se.push((t+256).toString(16).slice(1));function vi(t,e=0){return(se[t[e+0]]+se[t[e+1]]+se[t[e+2]]+se[t[e+3]]+"-"+se[t[e+4]]+se[t[e+5]]+"-"+se[t[e+6]]+se[t[e+7]]+"-"+se[t[e+8]]+se[t[e+9]]+"-"+se[t[e+10]]+se[t[e+11]]+se[t[e+12]]+se[t[e+13]]+se[t[e+14]]+se[t[e+15]]).toLowerCase()}let vt;const mi=new Uint8Array(16);function pi(){if(!vt){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");vt=crypto.getRandomValues.bind(crypto)}return vt(mi)}const Ut={randomUUID:typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function yi(t,e,n){if(Ut.randomUUID&&!t)return Ut.randomUUID();t=t||{};const i=t.random||(t.rng||pi)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,vi(i)}var bi=Object.defineProperty,wi=(t,e,n)=>e in t?bi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,j=(t,e,n)=>wi(t,typeof e!="symbol"?e+"":e,n),Si="galileo:core",Oi=class{constructor(t){j(this,"_isInit",!1),j(this,"_isReady",!1),j(this,"_seq",0),j(this,"pvid",-1),j(this,"fromPvid",-1),j(this,"log_id",0),j(this,"log_id_prefix",""),j(this,"_page_open_id",""),j(this,"start_time"),j(this,"_subs",[]),j(this,"instanceId",""),j(this,"logger"),this.logger=ti(Si,{debug:!!(t!=null&&t.is_debug_mode)}),this.start_time=Date.now()}isReady(){return this._isReady}getPageOpenId(){return this._page_open_id||(this._page_open_id=this.getUuid()),this._page_open_id}refreshPageOpenId(){this._page_open_id=this.getUuid()}getInstanceId(){return this.instanceId||(this.instanceId=this.getUuid()),this.instanceId}getUuid(){return yi()}getSeq(){return this._seq}setSeq(t){this._seq=t}resetSeq(){this._seq=0}getPvid(){return this.pvid}setPvid(t){this.pvid=t}getFromPvid(){return this.fromPvid}setFromPvid(t){this.fromPvid=t}getLogId(){return this.log_id}getLogIdPrefix(){return this.log_id_prefix}setLogIdPrefix(t){this.log_id_prefix=t}getLogIdUid(){return`${this.log_id_prefix}_${this.log_id}`}setLogId(t){ee(t)?this.log_id=this.log_id+1:this.log_id=t}getStartTime(){return this.start_time}},$e=(t=>(t.onCreateEventData="onCreateEventData",t.onHandleEventData="onHandleEventData",t.onDataEncoding="onDataEncoding",t.onUpdateNewHost="onUpdateNewHost",t.onUpdateNewContext="onUpdateNewContext",t.onLutChange="onLutChange",t.onSend="onSend",t))($e||{}),G=(t=>(t.Pageview="$WebPageView",t.Pageleave="$WebPageLeave",t.Click="$Click",t.PopupView="$PopupView",t.PageLoad="$PageLoad",t.Exposure="$Exposure",t.PopupLoad="$PopupLoad",t.BusinessEvent="$BusinessEvent",t))(G||{}),Jt=class{constructor(t){j(this,"_config",{}),j(this,"_subs",[]),this._config=L(L({},this._config),t)}get(t){return this._config[t]}set(t,e){const n=this._config[t];e!==void 0&&(ce(n)?this._config[t]=e:this._config[t]=e,this._subs.forEach(i=>i(this)))}serialize(){return L({},this._config)}toJson(){return JSON.parse(JSON.stringify(this._config))}getConfig(){return this.toJson()}setConfig(t){Object.assign(this._config,t),this._subs.forEach(e=>e(this))}subscribe(t){z(t)&&!this._subs.includes(t)&&this._subs.push(t)}};j(Jt,"name","configManager");var Ht=(...t)=>ii(t[0],...t.slice(1)),$t=class{constructor(t){j(this,"app"),j(this,"event",{}),j(this,"context",{}),j(this,"user",{}),j(this,"traffic",{}),j(this,"event_data",{}),j(this,"logger",{}),j(this,"event_name",""),j(this,"schema","com.klook.galileo.web.common:1.1.0"),this.event_data=t,this.event_name=t.event_name}isType(t){return this.event_name===t}getSchema(){return this.schema}setSchema(t){this.schema=t}getEventTime(){const{event_data:t}=this;return(t==null?void 0:t.timestamp)||(t==null?void 0:t.event_time)}setContext(t){this.context=L(L({},this.context),t)}setUser(t){this.user=L(L({},this.user),t)}setEvent(t){this.event=L(L({},this.event),t)}setTraffic(t){this.traffic=L({},t)}init(t){this.app=t}collect(){}compose(){}validate(){}encapsulate(){return this.serialize()}serialize(){const t=he(L({},this.logger),{msg:{schema:this.getSchema(),event:this.event,context:this.context,user:this.user,traffic:this.traffic}});return JSON.parse(JSON.stringify(t))}deserialize(){}},mt="__context_stop__",Ei=class{constructor(t,e){j(this,"_context",{}),j(this,"app"),j(this,"event"),j(this,"event_data",{}),j(this,"_error",[]),this.event_data=t,this.event=new $t(t),this.event.app=e,this.app=e}get(t){return this._context[t]}set(t,e){this._context[t]=e}stop(t){return this._context[mt]={reason:t,stop:!0},this}getStopReason(){var t;return(t=this._context[mt])==null?void 0:t.reason}isStop(){return!!this._context[mt]}getError(){return this._error}error(t,e){this._error.push({type:t,error:e})}},ki=class extends Oi{constructor(t){super({is_debug_mode:!!(t!=null&&t.is_debug_mode)}),j(this,"version"),j(this,"plugins",[]),j(this,"corePlugins",[]),j(this,"_hookCacheMap",new Map),j(this,"pluginList",[]),j(this,"_schemaMap",new Map),j(this,"_sharedStateMap",new Map),j(this,"configManager"),this.corePlugins=this.corePlugins.concat(t.corePlugins||[]),this.version=t.version,this.configManager=new Jt(L({},t)),this.subscribeConfigChange()}setPluginInstance(t){this.pluginList.includes(t)||this.pluginList.push(t)}subscribeConfigChange(){this.configManager.subscribe(()=>{this.logger.set({debug:this.isDebugMode()})})}setConfig(t){let e=this.configManager.getConfig();e=Ht(e,t),this.configManager.setConfig(e)}getConfig(t){return t?this.configManager.get(t):this.configManager.getConfig()}init(){return K(this,null,function*(){this._isInit||(this._isInit=!0,yield this.initPlugin(),this._isReady=!0,yield this.onReady())})}onReady(){this._subs.forEach(t=>{t(this)}),this._subs.length=0}initPlugin(){return K(this,null,function*(){var t,e;(this.configManager.get("plugins")||[]).forEach(l=>{z(l)&&this.plugins.push(l)});let i=this.corePlugins;i=[...i,...this.plugins];const s=[],a=i.map(l=>{var u;const v=Yn(l)?new l(this):l,p=(u=v.config)==null?void 0:u.bind(v);return z(p)&&s.push(p),this.setPluginInstance(v),v});let r=this.configManager.getConfig();s.forEach(l=>{const u=l(r);r=Ht(r,u)}),this.configManager.setConfig(r);for(const l of a){const u=l.name;yield(t=l.onInit)==null?void 0:t.call(l,u?this.configManager.get(u):{})}for(const l of a)yield(e=l.onReady)==null?void 0:e.call(l,this)})}runHookSync(t,e,n){const i=this.pluginList;let s=null;for(let a=0;a<i.length;a++){const r=i[a],l=r[t];if(z(l)&&(z(l)&&(s=l.call(r,{payload:e,result:s})||s),z(n)&&n(s)))break}return s}runHooks(t,e,n){let i=this.pluginList,s=!1;const a=`runhooks:${t}`;let r=this._hookCacheMap.get(a);t&&r?(i=r,s=!0):r=[];const l=i.length;if(l===0)return n==null?void 0:n(e);const u=v=>{if(v>=l)return!s&&t&&this._hookCacheMap.set(a,r),n==null?void 0:n(e);const g=i[v];g.context=e;const m=()=>u(v+1),b=g[t];if(z(b)){const x=b.call(g,e);return s||r==null||r.push(g),x&&z(x.then)?x.then(()=>m()).catch(O=>(e.error("hooks",O),m())):m()}else return m()};return u(0)}runPluginHookSync(t){const e=this.pluginList;let n=null;for(let i=0;i<e.length;i++){const s=e[i];if(z(t)&&(n=t(s)),n)break}return n}runPluginHook(t){return K(this,null,function*(){const e=this.pluginList;let n=null;for(let i=0;i<e.length;i++){const s=e[i];if(z(t)&&(n=yield t(s)),n)break}return n})}registerPlugin(t){this.plugins.push(t)}subscribe(t){if(this.isReady())return t(this);z(t)&&!this._subs.includes(t)&&this._subs.push(t)}isDebugMode(){return ni(this.getDebugMode())}getDebugMode(){return this.configManager.get("is_debug_mode")}createContext(t){return new Ei(t,this)}registerSchema(t,e,n={}){const{force:i}=n;return this._schemaMap.has(t)&&(this.logger.warn("Schema already registered",t),!i)?this:(this._schemaMap.set(t,e),this)}getSchema(t){return this._schemaMap.get(t)}setSharedState(t,e){return this._sharedStateMap.set(t,e),this}getSharedState(t){return this._sharedStateMap.get(t)}removeSharedState(t){this._sharedStateMap.delete(t)}},de=class{constructor(t){j(this,"app"),j(this,"context"),this.app=t}onInit(){}onReady(){}},Ii=class{constructor(t={}){M(this,"_storage");try{this.createStorage(t)}catch(e){console.error("init localforage error",e)}}createStorage(){return K(this,arguments,function*(t={}){return Promise.resolve().then(()=>Va).then(e=>{const n=e.default||e;this._storage=n.createInstance({name:t.name||"galileo",storeName:t.storeName||"klook:galileo"})})})}setAsync(t,e){return K(this,null,function*(){if(!this._storage)return!1;try{yield this._storage.setItem(t,e)}catch(n){return console.error("setAsync error",n),!1}return!0})}setJsonAsync(t,e){return K(this,null,function*(){var n;const i=JSON.stringify(e);yield(n=this._storage)==null?void 0:n.setItem(t,i)})}getAsync(t){return K(this,null,function*(){var e;return yield(e=this._storage)==null?void 0:e.getItem(t)})}getListAsync(){return K(this,arguments,function*(t={limit:10}){var e;const{limit:n}=t;try{const i=[];return yield(e=this._storage)==null?void 0:e.iterate((s,a,r)=>{if(r<=n)i.push({key:a,value:s});else return!0}),i}catch(i){console.error("Get Async list error: ",i)}return[]})}keys(){return K(this,null,function*(){var t;try{return yield(t=this._storage)==null?void 0:t.keys()}catch(e){return console.error("keys error",e),[]}})}key(t){return K(this,null,function*(){var e;return(e=this._storage)==null?void 0:e.key(t)})}getJsonAsync(t){return K(this,null,function*(){var e;try{return yield(e=this._storage)==null?void 0:e.getItem(t)}catch(n){return console.error("getJsonAsync error",n),null}})}length(){var t;return(t=this._storage)==null?void 0:t.length()}delete(t){return K(this,null,function*(){var e;yield(e=this._storage)==null?void 0:e.removeItem(t)})}};["debug","info","warn","error"].reduce((t,e,n,i)=>he(L({},t),{[e]:i.slice(n)}),{});var Pi=()=>{try{const t="g:__test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return console.log("Not support localStorage",t),!1}},xi=t=>{const e={cacheVal:null,isCalled:!1};return()=>(e.isCalled||(e.cacheVal=t(),e.isCalled=!0),e.cacheVal)},Ci=xi(Pi),Ni=class{constructor(){M(this,"_storage");Ci()&&(this._storage=localStorage)}clear(){throw new Error("Method not implemented.")}set(t,e){var n;return this._storage?((n=this._storage)==null||n.setItem(t,e),!0):!1}setJson(t,e){var n;if(!this._storage)return!1;const i=JSON.stringify(e);return(n=this._storage)==null||n.setItem(t,i),!0}get(t){return this._storage?this._storage.getItem(t):null}getJson(t){if(!this._storage)return null;const e=this._storage.getItem(t);if(e)try{return JSON.parse(e)}catch(n){return console.log("storage err",n),null}return null}delete(t){return this._storage?(this._storage.removeItem(t),!0):!1}},Di=class{constructor(t){M(this,"syncStorage");M(this,"asyncStorage");var e,n;this.syncStorage=(e=t==null?void 0:t.syncStorage)!=null?e:new Ni,this.asyncStorage=(n=t==null?void 0:t.asyncStorage)!=null?n:new Ii(t.storageConfig)}},Li=class extends de{onInit(){this.app.storage=new Di({})}},ue=(Te=class extends Error{constructor(e,n,i,s,a){super(e);M(this,"config");M(this,"code");M(this,"request");M(this,"response");M(this,"status");M(this,"isAxiosError",!0);this.config=i,n&&(this.code=n),s&&(this.request=s),this.name="GalileoError",Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error("err").stack,a&&(this.response=a,this.status=a.status?a.status:null)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ui(()=>this.config),code:this.code,status:this.status}}},M(Te,"ERR_BAD_REQUEST","ERR_BAD_REQUEST"),M(Te,"ERR_BAD_RESPONSE","ERR_BAD_RESPONSE"),M(Te,"ECONNABORTED","ECONNABORTED"),M(Te,"ERR_NETWORK","ERR_NETWORK"),M(Te,"ETIMEDOUT","ETIMEDOUT"),Te),Ti=["http","https","file","data"];function Ai(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function Ri(t,e,n){const i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):e(new ue(`Request failed with status code ${n.status}`,[ue.ERR_BAD_REQUEST,ue.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Bi(t,e){Object.keys(t).forEach(n=>{e(t[n],n)})}var Mi=new Set(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ji=t=>{const e={};let n,i,s;return t&&t.split(`
`).forEach(a=>{if(s=a.indexOf(":"),n=a.substring(0,s).trim().toLowerCase(),i=a.substring(s+1).trim(),!(!n||e[n]&&Mi.has(n)))if(n==="set-cookie"){const r=e[n];Array.isArray(r)?r.push(i):e[n]=[i]}else e[n]=e[n]?`${e[n]}, ${i}`:i}),e};function qi(t){const{config:e,request:n}=this;try{return JSON.parse(t)}catch(i){const s=i;throw s.name==="SyntaxError"?new ue(s==null?void 0:s.message,ue.ERR_BAD_RESPONSE,e,n,this):s}}var Ui=t=>{try{return t()}catch(e){return console.error(e),null}},Vt=class zn{constructor(e){M(this,"headers");this.headers=e||{}}set(e,n){this.headers[e]=n}get(e){return this.headers[e]||this.headers[e.toLowerCase()]}delete(e){delete this.headers[e]}getAllHeaders(){return this.headers}clearHeaders(){this.headers={}}setContentType(e){this.headers["Content-Type"]=e}static from(e){const n=Ne(e)?ji(e):e||{};return new zn(n)}toJSON(){return this.headers}},Ji={method:"GET",timeout:30*1e3,responseType:"json",clarifyTimeoutError:!0,headers:{Accept:"application/json, text/plain, */*","Content-Type":void 0},validateStatus:function(e){return e>=200&&e<300}};function Ft(t){return new Promise((e,n)=>{const i=Object.assign(L({},Ji),t),s=i.data,a=Vt.from(i.headers),{responseType:r}=i;let l=new XMLHttpRequest;l.open(i.method.toUpperCase(),i.url,!0),l.timeout=i.timeout;function u(){if(!l)return;const p=Vt.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders()),g=!r||r==="text"||r==="json"?l.responseText:l.response;let m=null;const b={data:g,responseText:l.responseText,status:l.status,statusText:l.statusText,headers:p,config:t,request:l};r==="json"&&(m=qi.call(b,g),b.data=m),Ri(w=>{e(w)},w=>{n(w)},b),l=null}"onloadend"in l?l.onloadend=u:l.onreadystatechange=function(){!l||l.readyState!==4||l.status===0&&!(l.responseURL&&l.responseURL.indexOf("file:")===0)||setTimeout(u)},l.onabort=function(){l&&(n(new ue("Request aborted",ue.ECONNABORTED,t,l)),l=null)},l.onerror=function(){n(new ue("Network Error",ue.ERR_NETWORK,t,l)),l=null},l.ontimeout=function(){let g=i.timeout?`timeout of ${i.timeout}ms exceeded`:"timeout exceeded";const m=t.clarifyTimeoutError;i.timeoutErrorMessage&&(g=i.timeoutErrorMessage),n(new ue(g,m?ue.ETIMEDOUT:ue.ECONNABORTED,t,l)),l=null},s===void 0&&a.setContentType(null),"setRequestHeader"in l&&Bi(a.toJSON(),(p,g)=>{l.setRequestHeader(g,p)}),Re(i.withCredentials)||(l.withCredentials=!!i.withCredentials),r&&r!=="json"&&(l.responseType=i.responseType);const v=Ai(i.url);if(v&&!Ti.includes(v)){n(new ue(`Unsupported protocol ${v}:`,ue.ERR_BAD_REQUEST,t));return}l.send(s||null)})}var Hi=t=>Ft(he(L({},t),{method:"POST"})),$i=class{constructor(t){M(this,"_config",{headers:{"Content-Type":"application/json"}});M(this,"subscribers",[]);this._config=L(L({},this._config),t)}interceptor(t,e){this.subscribers.push([t,e])}success(t){return K(this,null,function*(){for(const[e]of this.subscribers)yield e(t)})}fail(t){return K(this,null,function*(){for(const[,e]of this.subscribers)yield e==null?void 0:e(t)})}onResponse(t){return K(this,null,function*(){if(t.success)yield this.success(t);else{try{yield this.fail(t)}catch(e){console.error("Reuqest Error",e)}return Promise.reject(t)}return t})}encoding(t){return JSON.stringify(t)}buildUrl(t,e){let n=t;const i=e||{};if(typeof URL!="undefined"){const s=new URL(n);Object.keys(i).forEach(a=>{s.searchParams.set(a,i[a])}),n=s.toString()}else{const[s,a]=n.split("?"),r=Object.keys(i).map(u=>`${u}=${i[u]}`),l=[a||"",...r].filter(Boolean).join("&");n=`${s}?${l}`}return n}post(i,s){return K(this,arguments,function*(t,e,n={usingBeacon:!1}){var a,r;const{usingBeacon:l,query:u,headers:v}=n||{},p=this.buildUrl(t,u);try{let g=!1;const m=this.encoding(e),{headers:b}=this._config,w=L(L({},b),v),x=m;if(l&&typeof Blob!="undefined"){const C=new Blob([m],{type:(w==null?void 0:w["Content-Type"])||"application/json"});g=this.sendBeacon(p,C)}let O={success:!!g};if(!g){const C=yield this.fetch(p,x,{headers:w});if(C.status>=200&&C.status<300){const N=(yield C==null?void 0:C.json())||{};O=N.success?{success:!0,result:N.result}:{success:!1,errmsg:(a=N==null?void 0:N.error)==null?void 0:a.message,errcode:(r=N==null?void 0:N.error)==null?void 0:r.code}}if(!O.success){const N=yield this.withFallback({url:p,data:this.encoding(e),headers:L(L({},this._config.headers),n.headers)});O=L({},N)}}return this.onResponse(O)}catch(g){const m=yield this.withFallback({url:p,data:this.encoding(e),headers:L(L({},this._config.headers),n.headers)});return m&&!m.success&&(m.errmsg+=`;Fetch Error: ${g.message}`),this.onResponse(m)}})}withFallback(t){const{url:e,data:n,headers:i}=t;return this.postWithXhr({url:e,data:n,headers:i}).then(s=>{var a,r;const l=s.data||{},u=l.success?{}:{errmsg:`Server Error: ${(a=l.error)==null?void 0:a.message}`,errcode:(r=l.error)==null?void 0:r.code};return L({success:l.success},u)}).catch(s=>{var a;const r=s;if(r.isAxiosError){const l=((a=r.toJSON)==null?void 0:a.call(r))||{};return{success:!1,errmsg:`${l.name}- ${l.message}- ${l.stack}- ${l.status}- ${l.code}`,errcode:r.code}}else return{success:!1,errmsg:`Client Error: ${r.message}`,errcode:r.name}})}fetch(t,e,n){const{headers:i}=this._config;return fetch(t,he(L({method:"POST",keepalive:!0,credentials:"omit",body:e},n),{headers:L(L({},i),n==null?void 0:n.headers)}))}postWithXhr(t){return Hi(t)}sendXhr(t){return Ft(t)}sendBeacon(t,e){let n=!1;try{n=navigator.sendBeacon(t,e)}catch(i){console.error("sendBeacon error",i),n=!1}return n}},Vi=t=>btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+`0x${n}`))),Fi=class extends de{constructor(){super(...arguments);M(this,"name","galileoRequest")}onInit(){this.app.request=new $i,this.app.sendDebugData=this.sendDebugData.bind(this)}getDeviceId(){var e;const n=this.app.configManager.get("device_id");if(!n){const s=document.cookie.split(";").find(a=>a.includes("kepler_id"));return((e=s||"")==null?void 0:e.split("=")[1])||s||"device-id-not-in-cookie"}return n}getPlatform(){const e=navigator.userAgent,n=this.app.configManager.get("platform");return n&&["mobile","desktop"].includes(n)?n:e.includes("Android")||e.includes("iPhone")?"mobile":"desktop"}sendDebugData(e){try{this._sendDebugData(e)}catch(n){this.app.logger.error("sendDebugData",n)}}_sendDebugData(e){return K(this,null,function*(){if(!e)return;const{level:n="E"}=e,i=this.getDeviceId(),s=JSON.stringify({system:"optimus",subtype:"galileo-tracker-data",message:L({current_url:window.location.href,url_path:window.location.pathname,kepler_id:i},e)}),a=this.getPlatform(),r={type:5,level:n,time:Date.now(),msg:Vi(s),log_ver:1,uid:"",is_masked:!0,platform:a,device_id:i},l=JSON.stringify({logs:[r]}),v=`https://log.klook.${/\.cn$/.test(window.location.host||"")?"cn":"com"}/v3/frontlogsrv/log/web`,p=()=>{var g;(g=this.app.request.fetch(v,l,{headers:{"X-Platform":a}}))==null||g.catch(m=>{console.error("sendDebugData error",m)})};try{yield this.app.request.sendXhr({url:v,method:"POST",data:l,headers:{"Content-Type":"application/json","X-Platform":a}})}catch(g){console.error("senddebug xhr error",g),p()}})}};class Oe{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.lib_version!=null&&(e.lib_version=this.lib_version),this.platform!=null&&(e.platform=this.platform),this.user_agent!=null&&(e.user_agent=this.user_agent),this.currency!=null&&(e.currency=this.currency),this.language!=null&&(e.language=this.language),this.site_name!=null&&(e.site_name=this.site_name),this.app_id!=null&&(e.app_id=this.app_id),this.app_version_string!=null&&(e.app_version_string=this.app_version_string),this.app_builder_number!=null&&(e.app_builder_number=this.app_builder_number),this.app_open_id!=null&&(e.app_open_id=this.app_open_id),this.device_id!=null&&(e.device_id=this.device_id),this.carrier!=null&&(e.carrier=this.carrier),this.wifi!=null&&(e.wifi=this.wifi),this.device_region_code!=null&&(e.device_region_code=this.device_region_code),this.manufacture!=null&&(e.manufacture=this.manufacture),this.model!=null&&(e.model=this.model),this.os!=null&&(e.os=this.os),this.os_version!=null&&(e.os_version=this.os_version),this.screen_height!=null&&(e.screen_height=this.screen_height),this.screen_width!=null&&(e.screen_width=this.screen_width),this.device_language!=null&&(e.device_language=this.device_language),this.ios_ifa!=null&&(e.ios_ifa=this.ios_ifa),this.radio!=null&&(e.radio=this.radio),this.android_id!=null&&(e.android_id=this.android_id),this.domain!=null&&(e.domain=this.domain),this.lut!=null&&(e.lut=this.lut),this.ck!=null&&(e.ck=this.ck),this.browser!=null&&(e.browser=this.browser),this.browser_version!=null&&(e.browser_version=this.browser_version),this.current_url!=null&&(e.current_url=this.current_url),this.url_path!=null&&(e.url_path=this.url_path),this.srv_client_time_diff!=null&&(e.srv_client_time_diff=this.srv_client_time_diff),e}static fromObject(e){const n=new this,i=e.lib_version;i!=null&&(n.lib_version=i);const s=e.platform;s!=null&&(n.platform=s);const a=e.user_agent;a!=null&&(n.user_agent=a);const r=e.currency;r!=null&&(n.currency=r);const l=e.language;l!=null&&(n.language=l);const u=e.site_name;u!=null&&(n.site_name=u);const v=e.app_id;v!=null&&(n.app_id=v);const p=e.app_version_string;p!=null&&(n.app_version_string=p);const g=e.app_builder_number;g!=null&&(n.app_builder_number=g);const m=e.app_open_id;m!=null&&(n.app_open_id=m);const b=e.device_id;b!=null&&(n.device_id=b);const w=e.carrier;w!=null&&(n.carrier=w);const x=e.wifi;x!=null&&(n.wifi=x);const O=e.device_region_code;O!=null&&(n.device_region_code=O);const C=e.manufacture;C!=null&&(n.manufacture=C);const N=e.model;N!=null&&(n.model=N);const te=e.os;te!=null&&(n.os=te);const B=e.os_version;B!=null&&(n.os_version=B);const E=e.screen_height;E!=null&&(n.screen_height=E);const A=e.screen_width;A!=null&&(n.screen_width=A);const T=e.device_language;T!=null&&(n.device_language=T);const J=e.ios_ifa;J!=null&&(n.ios_ifa=J);const F=e.radio;F!=null&&(n.radio=F);const X=e.android_id;X!=null&&(n.android_id=X);const re=e.domain;re!=null&&(n.domain=re);const le=e.lut;le!=null&&(n.lut=le);const _e=e.ck;_e!=null&&(n.ck=_e);const Pe=e.browser;Pe!=null&&(n.browser=Pe);const Ae=e.browser_version;Ae!=null&&(n.browser_version=Ae);const qe=e.current_url;qe!=null&&(n.current_url=qe);const be=e.url_path;be!=null&&(n.url_path=be);const ze=e.srv_client_time_diff;return ze!=null&&(n.srv_client_time_diff=ze),n}static toObject(e){return this.fromObject(e).toJSON()}}class Ee{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.global_id!=null&&(e.global_id=this.global_id),this.assumed_residence!=null&&(e.assumed_residence=this.assumed_residence),this.user_residence!=null&&(e.user_residence=this.user_residence),e}static fromObject(e){const n=new this,i=e.global_id;i!=null&&(n.global_id=i);const s=e.assumed_residence;s!=null&&(n.assumed_residence=s);const a=e.user_residence;return a!=null&&(n.user_residence=a),n}static toObject(e){return this.fromObject(e).toJSON()}}class ke{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.install_channel!=null&&(e.install_channel=this.install_channel),this.referrer!=null&&(e.referrer=this.referrer),this.referrer_host!=null&&(e.referrer_host=this.referrer_host),e}static fromObject(e){const n=new this,i=e.install_channel;i!=null&&(n.install_channel=i);const s=e.referrer;s!=null&&(n.referrer=s);const a=e.referrer_host;return a!=null&&(n.referrer_host=a),n}static toObject(e){return this.fromObject(e).toJSON()}}var Wt;(function(t){t.deeplink="deeplink",t.direct="direct"})(Wt||(Wt={}));var Gt;(function(t){t.cold_start_to_inactive="cold_start_to_inactive",t.inactive_to_active="inactive_to_active",t.active_to_inactive="active_to_inactive"})(Gt||(Gt={}));class Wi{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.event_data!=null&&(e.event_data=this.event_data),this.event_data_schema!=null&&(e.event_data_schema=this.event_data_schema),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const g=e.seq;g!=null&&(n.seq=g);const m=e.app_open;m!=null&&(n.app_open=m);const b=e.navigation_type;b!=null&&(n.navigation_type=b);const w=e.event_data;w!=null&&(n.event_data=w);const x=e.event_data_schema;x!=null&&(n.event_data_schema=x);const O=e.page_data;O!=null&&(n.page_data=O);const C=e.page_data_schema;return C!=null&&(n.page_data_schema=C),n}static toObject(e){return this.fromObject(e).toJSON()}}class Gi{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.BizEventUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=Ki;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class Ki{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.BizEventMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Oe;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Ee;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=Wi;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}class Qi{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.event_data!=null&&(e.event_data=this.event_data),this.event_data_schema!=null&&(e.event_data_schema=this.event_data_schema),this.component_name!=null&&(e.component_name=this.component_name),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const g=e.seq;g!=null&&(n.seq=g);const m=e.app_open;m!=null&&(n.app_open=m);const b=e.navigation_type;b!=null&&(n.navigation_type=b);const w=e.event_data;w!=null&&(n.event_data=w);const x=e.event_data_schema;x!=null&&(n.event_data_schema=x);const O=e.component_name;O!=null&&(n.component_name=O);const C=e.page_data;C!=null&&(n.page_data=C);const N=e.page_data_schema;return N!=null&&(n.page_data_schema=N),n}static toObject(e){return this.fromObject(e).toJSON()}}class zi{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.ClickUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=Yi;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class Yi{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.ClickMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Oe;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Ee;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=Qi;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}class Xi{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.event_data!=null&&(e.event_data=this.event_data),this.event_data_schema!=null&&(e.event_data_schema=this.event_data_schema),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const g=e.seq;g!=null&&(n.seq=g);const m=e.app_open;m!=null&&(n.app_open=m);const b=e.navigation_type;b!=null&&(n.navigation_type=b);const w=e.event_data;w!=null&&(n.event_data=w);const x=e.event_data_schema;x!=null&&(n.event_data_schema=x);const O=e.page_data;O!=null&&(n.page_data=O);const C=e.page_data_schema;return C!=null&&(n.page_data_schema=C),n}static toObject(e){return this.fromObject(e).toJSON()}}class Zi{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.ExposureUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=es;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class es{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.ExposureMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Oe;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Ee;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=Xi;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var Kt;(function(t){t.close="close",t.hide="hide"})(Kt||(Kt={}));var Qt;(function(t){t.ios="ios",t.android="android",t.desktop="desktop",t.mobile="mobile"})(Qt||(Qt={}));var zt;(function(t){t.navigate="navigate",t.reload="reload",t.back_forward="back_forward",t.redirect="redirect",t.other="other",t.prerender="prerender"})(zt||(zt={}));class ts{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const g=e.seq;g!=null&&(n.seq=g);const m=e.app_open;m!=null&&(n.app_open=m);const b=e.navigation_type;b!=null&&(n.navigation_type=b);const w=e.page_data;w!=null&&(n.page_data=w);const x=e.page_data_schema;return x!=null&&(n.page_data_schema=x),n}static toObject(e){return this.fromObject(e).toJSON()}}class ns{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.PageLoadUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=is;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class is{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.PageLoadMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Oe;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Ee;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=ts;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var Yt;(function(t){t.ios="ios",t.android="android",t.desktop="desktop",t.mobile="mobile",t.openharmony_shell="openharmony_shell"})(Yt||(Yt={}));class ss{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.event_data!=null&&(e.event_data=this.event_data),this.event_data_schema!=null&&(e.event_data_schema=this.event_data_schema),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),this.popup_open_id!=null&&(e.popup_open_id=this.popup_open_id),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const g=e.seq;g!=null&&(n.seq=g);const m=e.app_open;m!=null&&(n.app_open=m);const b=e.navigation_type;b!=null&&(n.navigation_type=b);const w=e.event_data;w!=null&&(n.event_data=w);const x=e.event_data_schema;x!=null&&(n.event_data_schema=x);const O=e.page_data;O!=null&&(n.page_data=O);const C=e.page_data_schema;C!=null&&(n.page_data_schema=C);const N=e.popup_open_id;return N!=null&&(n.popup_open_id=N),n}static toObject(e){return this.fromObject(e).toJSON()}}class as{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.PopupLoadUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=os;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class os{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.PopupLoadMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Oe;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Ee;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=ss;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var Xt;(function(t){t.modal="modal",t.bottom_sheet="bottom_sheet",t.popover="popover",t.tooltip="tooltip",t.message_box="message_box",t.notification="notification",t.alert="alert",t.toast="toast",t.drawer="drawer"})(Xt||(Xt={}));var Zt;(function(t){t.webview="webview",t.app="app",t.web="web"})(Zt||(Zt={}));class rs{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.popup_type!=null&&(e.popup_type=this.popup_type),this.popup_style!=null&&(e.popup_style=this.popup_style),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),this.popup_open_id!=null&&(e.popup_open_id=this.popup_open_id),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const g=e.seq;g!=null&&(n.seq=g);const m=e.app_open;m!=null&&(n.app_open=m);const b=e.navigation_type;b!=null&&(n.navigation_type=b);const w=e.popup_type;w!=null&&(n.popup_type=w);const x=e.popup_style;x!=null&&(n.popup_style=x);const O=e.page_data;O!=null&&(n.page_data=O);const C=e.page_data_schema;C!=null&&(n.page_data_schema=C);const N=e.popup_open_id;return N!=null&&(n.popup_open_id=N),n}static toObject(e){return this.fromObject(e).toJSON()}}class ls{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.PopupViewUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=cs;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class cs{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.PopupViewMessage:1.1.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Oe;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Ee;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=rs;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var en;(function(t){t.open="open",t.show="show"})(en||(en={}));class us{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.event_duration!=null&&(e.event_duration=this.event_duration),this.leave_type!=null&&(e.leave_type=this.leave_type),this.viewport_height!=null&&(e.viewport_height=this.viewport_height),this.viewport_position!=null&&(e.viewport_position=this.viewport_position),this.viewport_width!=null&&(e.viewport_width=this.viewport_width),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const g=e.seq;g!=null&&(n.seq=g);const m=e.event_duration;m!=null&&(n.event_duration=m);const b=e.leave_type;b!=null&&(n.leave_type=b);const w=e.viewport_height;w!=null&&(n.viewport_height=w);const x=e.viewport_position;x!=null&&(n.viewport_position=x);const O=e.viewport_width;O!=null&&(n.viewport_width=O);const C=e.navigation_type;C!=null&&(n.navigation_type=C);const N=e.page_data;N!=null&&(n.page_data=N);const te=e.page_data_schema;return te!=null&&(n.page_data_schema=te),n}static toObject(e){return this.fromObject(e).toJSON()}}class hs{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.WebPageLeaveUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=ds;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class ds{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.WebPageLeaveMessage:1.1.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Oe;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Ee;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=us;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}class fs{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.view_type!=null&&(e.view_type=this.view_type),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const g=e.seq;g!=null&&(n.seq=g);const m=e.view_type;m!=null&&(n.view_type=m);const b=e.navigation_type;b!=null&&(n.navigation_type=b);const w=e.page_data;w!=null&&(n.page_data=w);const x=e.page_data_schema;return x!=null&&(n.page_data_schema=x),n}static toObject(e){return this.fromObject(e).toJSON()}}class gs{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.WebPageViewUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=_s;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class _s{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.WebPageViewMessage:1.1.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Oe;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Ee;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=fs;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var tn;(function(t){t.input="input",t.slide="slide"})(tn||(tn={}));var nn;(function(t){t.refunded="refunded",t.processing="processing",t.refund_failed="refund_failed"})(nn||(nn={})),window.callbackIds=new Map,window.registerIds=new Map,window.idsTimeOut={};var Ie={default:void 0,call:function(t,e,n,i){const s=String(new Date().valueOf());let a={method:t,callbackId:s,args:e,callTimeOut:i||-1},r={};if(Object.prototype.toString.call(n)==="[object Object]"&&Object.keys(n).length>0)for(let u in n)typeof n[u]=="function"&&(r[u]=n[u]);const l=JSON.stringify(a);return new Promise((u,v)=>{if(window.callbackIds.set(s,{finish:{resolve:u,reject:v},cbs:r}),window&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers._klookJSBridge)window.webkit.messageHandlers._klookJSBridge.postMessage({method:"call",args:l}),this.setJSbridgeTimeOut(s,i);else if(window&&window._klookJSBridge)typeof window._klookJSBridge.call=="function"?window._klookJSBridge.call(l):typeof window._klookJSBridge.postMessage=="function"?window._klookJSBridge.postMessage(JSON.stringify({method:"call",args:l})):console.error("[Klook jsBridge]: not support call"),this.setJSbridgeTimeOut(s,i);else{const g=JSON.stringify({callbackId:s,data:{success:!1,type:"finish",error:{msg:"NotImplemented",code:"5001"}}});window.handleNativeResult(g)}})},setResultToNative:function(t){window&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers._klookJSBridge?window.webkit.messageHandlers._klookJSBridge.postMessage({method:"setResultToNative",args:JSON.stringify(t)}):window&&window._klookJSBridge&&window._klookJSBridge.setResultToNative(JSON.stringify(t))},setJSbridgeTimeOut:function(t,e){if(typeof e!="number"||e===-1)return;const n={callbackId:t,data:{type:"finish",success:!1,error:{code:5002,msg:"TimeOut"}}};window.idsTimeOut[t]=setTimeout(()=>{const i=JSON.stringify(n);window.handleNativeResult(i)},e)},clearJSbridgeTimeOut:function(t){window.idsTimeOut[t]&&(clearTimeout(window.idsTimeOut[t]),delete window.idsTimeOut[t])},register:function(t,e){window._klookJSBridgeInit||(window._klookJSBridgeInit=!0,setTimeout(function(){Ie.call("klookJSBridge.bridgeReady",{},{},5e3).catch(n=>{})},0)),typeof e=="function"&&window.registerIds.set(t,e)}};(function(){if(!window._klookJSBridgeInit){var t={KlookJSBridge:Ie,handleNativeResult:function(e){const n=JSON.parse(e),i=n.callbackId,s=n.data,a=s.type;if(i&&window.callbackIds.has(i)){Ie.clearJSbridgeTimeOut(i);const r=window.callbackIds.get(i);if(a==="finish")return window.callbackIds.delete(i),s.success?r.finish.resolve(s.result||{}):r.finish.reject(s.error||{});r.cbs[a]&&r.cbs[a](s.result)}},nativeCallJS:function(e){const n=JSON.parse(e);let i={callbackId:n.callbackId};window.registerIds.has(n.method)?window.registerIds.get(n.method)(n.args||{}).then(a=>{i.data={result:a,success:!0},Ie.setResultToNative(i)}).catch(a=>{i.data={success:!1,error:a},Ie.setResultToNative(i)}):(i.data={success:!1,error:{code:5001,msg:"NotImplemented"}},Ie.setResultToNative(i))}};for(let e in t)window[e]=t[e];window._klookJSBridgeInit=!0,setTimeout(function(){Ie.call("klookJSBridge.bridgeReady",{},{},5e3).catch(e=>{})},0)}})();var vs=Object.defineProperty,ms=(t,e,n)=>e in t?vs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,R=(t,e,n)=>ms(t,typeof e!="symbol"?e+"":e,n),ps="_galileo_set",sn="send_data",ys="onHandle",bs="onCreate",ws="onBeforeHandle",Ss="onRequest",Os="onBeforeRequest",Es="onComplete",tt="galileo_l_d",ks=class extends de{constructor(){super(...arguments),R(this,"_seq_id",1),R(this,"name","senderQueue"),R(this,"urlEventNameMapping",new Map),R(this,"processingQueue",new Map),R(this,"successSet",new Set),R(this,"delayQueue",[]),R(this,"_timer",null),R(this,"url",""),R(this,"_pageStatus",[]),R(this,"penddingIdSet",new Set)}onInit(){this.app.senderQueue=this,this.initTimer();const t=this.app.configManager.get("url"),e=Ne(t)?{default:t}:t;if(!e)throw new Error("url config is required");this.urlEventNameMapping=new Map(Object.entries(e)),this.url=this.urlEventNameMapping.get("default"),this.initRequestInterceptor()}onReady(){this.loadSyncData()}onNetworkOnline(){this.flush()}onRequest(t){const e=t.get(sn);if(!e)return;const{data:n,config:i}=e;this.send(n,i)}send(t,e){return this.enqueue(t,he(L({},e),{uid:this.getSeqId(),type:"new",retry:0}))}loadSyncData(){try{const t=this.app.storage.syncStorage.getJson(tt);t!=null&&t.length&&(this.enDelayQueue(t),this.app.storage.syncStorage.delete(tt))}catch(t){console.error("get local data error",t)}}getSeqId(){return`${this.app.getUuid().slice(-12)||Date.now()}_${this._seq_id++}`}getDeviceId(){return this.app.runHookSync("onGetDeviceId",null,e=>!!e)}getPlatform(){const t="mobile",e="desktop",n=_t()||De()?t:e,i=this.app.configManager.get("platform")||n;return[t,e].includes(i)?i:n}getOnlineStatus(){return this.app.galileoHost.getOnlineStatus()}pageMayLeave(){const t=document.hidden,e=document.visibilityState==="hidden",n=t===!0||e;return this.app.logger.debug("pageWillUnload",t,e,n),this.app.nativeEvent.isPageLeave()||n}pageWillUnload(t){this.app.logger.debug("pageWillUnload",t),(this.pageMayLeave()||(t==null?void 0:t.event_name)==="unload")&&(this.flush({beacon:!0}),this.cacheToLocal())}deduplicateArraysByKey(t,e){const n={};return t.concat(e).filter(s=>{var l;if(!s)return!1;const a=(l=s.opt)==null?void 0:l.uid,r=this.getPayloadUniqueKey(s);return r&&this.successSet.has(r)?!1:a?n[a]?!1:(n[a]=!0,!0):!0})}cacheToLocal(){const{app:t}=this;let e=this.getUnhandleQueue(),n=[];try{n=t.storage.syncStorage.getJson(tt)||[],n=Array.isArray(n)?n:[],e=this.deduplicateArraysByKey(e,n)}catch(i){t.logger.error("get local data error",i)}t.logger.debug("Save data to local: ",e),e=e.filter(i=>!!i),e.length&&t.storage.syncStorage.set(tt,JSON.stringify(e))}checkLastPageStatus(){this.pageMayLeave()&&(this.flush({beacon:!0}),this.cacheToLocal())}getQueueConfig(){return L({duration:1e3,max:5,concurrent:4,maxLength:50},this.app.configManager.get("queue"))}initTimer(){this._timer&&clearInterval(this._timer);const{duration:t=1e3}=this.getQueueConfig();this._timer=setInterval(()=>{this.flush()},t)}loadCacheData(t){return K(this,null,function*(){const{max:e}=this.getQueueConfig();(t==null?void 0:t.type)==="empty"&&this.loadSyncData(),this.delayQueue.length<e*2&&(yield this.loadAsyncData())})}loadAsyncData(){return K(this,null,function*(){const{app:t}=this,{max:e}=this.getQueueConfig(),n=yield t.storage.asyncStorage.getListAsync({limit:(e||5)*2}).catch(i=>(console.error("getListAsync err",i),[]));if(n!=null&&n.length){const i=n.reduce((s,a)=>s.concat(a.value||[]),[]);this.enDelayQueue(i);for(const s of n)yield t.storage.asyncStorage.delete(s.key)}})}initRequestInterceptor(){const{max:t}=this.getQueueConfig();this.app.request.interceptor(e=>K(this,null,function*(){this.delayQueue.length<t*3&&(yield this.loadCacheData())}))}enDelayQueue(t){this.delayQueue=this.delayQueue.concat(t)}enqueue(t,e){const n={payload:t,opt:e},i=this.getQueueConfig();if(!this.getOnlineStatus()||this.delayQueue.length>i.maxLength){const s=this.getSeqId();this.app.storage.asyncStorage.setAsync(s,n).then(a=>{a||this.delayQueue.push(n)});return}this.delayQueue.push(n),this.delayQueue.length>=i.max&&setTimeout(()=>this.flush()),e.eventType==="$Click"&&this.flush({beacon:!0}),this.checkLastPageStatus()}getUnhandleQueue(){const t=Array.from(this.processingQueue).map(([,n])=>n).reduce((n,i)=>(Array.isArray(n)?n:[n]).concat(i),[]);return this.delayQueue.concat(t)}getPayloadUniqueKey(t){var i,s,a;const e=((i=t.opt)==null?void 0:i.uid)||"",n=((a=(s=t.opt)==null?void 0:s.query)==null?void 0:a.log_id)||"";return`${e}${n}`}flush(t={}){const{beacon:e=!1}=t,{concurrent:n}=this.getQueueConfig(),i=this.app.galileoHost.getOnlineStatus();if(this.processingQueue.size>=n||!i)return;const{sendList:s,url:a}=this.prepareSendData(),r=s.filter(O=>{const C=this.getPayloadUniqueKey(O);return C&&(this.penddingIdSet.has(C)||this.successSet.has(C))?!1:!!O.payload});if(r.length&&r.forEach(O=>{const C=this.getPayloadUniqueKey(O);C&&this.penddingIdSet.add(C)}),!r.length){this.loadCacheData({type:"empty"});return}const l=this.getSeqId();this.processingQueue.set(l,r);const u=this.getPlatform(),v=this.getDeviceId(),p=a||this.url,g=String(r.length),m=[];r.forEach(O=>{var N,te;const C=(te=(N=O.opt)==null?void 0:N.query)==null?void 0:te.log_id;C&&m.push(C)});const b=m.join("-"),w={size:g,log_ids:b,device_id:v,platform:u};this.app.logger.debug("Flush url: ",p,e),this.app.logger.debug("Flush data: ",r);const x=Date.now();this.app.request.post(p,{logs:r.map(O=>O.payload)},{query:w,usingBeacon:e}).then(O=>{this.app.logger.debug("Flush success: ",p,O),this.processingQueue.delete(l),r.forEach(C=>{const N=this.getPayloadUniqueKey(C);N&&(this.successSet.add(N),this.penddingIdSet.delete(N))})}).catch(O=>{r.forEach(B=>{const E=this.getPayloadUniqueKey(B);E&&this.penddingIdSet.delete(E)});const C=O==null?void 0:O.errcode;if(this.app.logger.error("Flush error: ",p,O),this.sendDebugData({type:"galileo_flush_error",duration:Date.now()-x,error:`${O.name}: ${O.message}: ${O.code}: ${O.stack}`,log_id_str:b,errcode:C}),C&&C!=="-1000")return;let N=r;const te=navigator.userAgent||"";/(SamsungBrowser)/i.test(te)&&(N=N.filter(B=>{var A;return(((A=B.opt)==null?void 0:A.retry)||0)<10}),N=N.map(B=>{var E;if(B.opt){const A=((E=B.opt)==null?void 0:E.retry)||0;B.opt.retry=A+1}return B})),this.enDelayQueue(N),this.processingQueue.delete(l)})}prepareSendData(){var p,g;const{max:t}=this.getQueueConfig(),e=this.delayQueue,n=[],i=e.shift(),s=(p=i==null?void 0:i.opt)==null?void 0:p.eventType,a=this.urlEventNameMapping.has(s),r=this.urlEventNameMapping.get("default"),l=this.urlEventNameMapping.get(s)||r;if(!i)return{sendList:[],url:""};n.push(i);let u=-1;const v=t*3;for(;t>n.length&&u<v&&e.length;){u++;const m=e[u];if(!m)continue;const b=(g=m.opt)==null?void 0:g.eventType;a?s===b&&(n.push(...Array.isArray(m)?m:[m]),e.splice(u--,1)):(!b||!this.urlEventNameMapping.get(b))&&(n.push(...Array.isArray(m)?m:[m]),e.splice(u--,1))}return{sendList:n,url:l}}sendDebugData(t){var e,n;(n=(e=this.app).sendDebugData)==null||n.call(e,t)}},Is="device_id",Ps="kepler_id",fe="unknown",xs=class{constructor(t=""){this._userAgent=t,R(this,"getAppOs",()=>ye()?_t()?"android":this.isiOS()?"ios":this.isHosShell()?"openharmony-shell":this.isHos()?"openharmony":"":"")}isHos(){return/OpenHarmony/i.test(this._userAgent)}isHosShell(){return this.isHos()&&/ohos-shell/i.test(this._userAgent)}isiOS(){return De(this._userAgent)}getOS(t){const e=t||this._userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":this.isHos()?"OpenHarmony":/Android/i.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"Mac OS X":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"Chrome OS":""}getOsVersion(t){var s;const e=t||this._userAgent,n=this.getOS(),i=[{reg:"Android",version:/android\s([0-9.]*)/i},{reg:"iOS",version:/OS\s(\d[_0-9]*)/i},{reg:"Mac OS X",version:/Mac OS X\s(\d[_0-9]*)/i},{reg:"Windows",version:/NT\s(\d[.\d]*)/i},{reg:"Chrome OS",version:/CrOS\sx86_64\s(\d[.\d]*)/i},{reg:"OpenHarmony",version:/OpenHarmony\s(\d[.\d]*)/i}];for(const a of i)if(a.reg===n){const l=(s=a.version)==null?void 0:s.exec(e);if(l!=null&&l[1])return l[1]}return""}getBrowser(t){const{userAgent:e,vendor:n,opera:i}=t||{},s=e||this._userAgent,a=n||"";return i||s.includes(" OPR/")?s.includes("Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(s)?"BlackBerry":s.includes("IEMobile")||s.includes("WPDesktop")?"Internet Explorer Mobile":s.includes("SamsungBrowser/")?"Samsung Internet":s.includes("Edge")||s.includes("Edg/")?"Microsoft Edge":/HuaweiBrowser/i.test(s)?"HuaweiBrowser":s.includes("FBIOS")?"Facebook Mobile":s.includes("Chrome")?"Chrome":s.includes("CriOS")?"Chrome iOS":s.includes("UCWEB")||s.includes("UCBrowser")?"UC Browser":s.includes("FxiOS")?"Firefox iOS":a.includes("Apple")?s.includes("Mobile")?"Mobile Safari":"Safari":s.includes("Android")?"Android Mobile":s.includes("Konqueror")?"Konqueror":s.includes("Firefox")?"Firefox":s.includes("MSIE")||s.includes("Trident/")?"Internet Explorer":s.includes("Gecko")?"Mozilla":""}getBrowserVersion(t){const{userAgent:e,vendor:n,opera:i}=t||{},s=e||this._userAgent,a=n||"",r=this.getBrowser({userAgent:s,vendor:a,opera:i}),u={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,"Opera Mini":/Opera Mini\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/,HuaweiBrowser:/HuaweiBrowser\/(\d[.\d]*)/}[r];if(u===void 0)return null;const v=s.match(u);return v?v[v.length-2]:null}},Cs=class extends de{constructor(){super(...arguments),R(this,"name","contextManager"),R(this,"currentContext",{}),R(this,"historyContext",[]),R(this,"lut",-1)}onInit(){this.app.contextManager=this,this.getNewContext()}getLut(){return this.lut}onLutChange({payload:t}){return this.lut=t,this.lut}setHistoryContext(t){this.historyContext.length>=10&&this.historyContext.shift(),this.historyContext.push(t)}getNewContext(){return this.currentContext=L(L({},this.getStaticContext(!0)),this.getDynamic()),this.setHistoryContext(this.currentContext),this.getCurrentContext()}getCurrentContext(){return L({},this.currentContext)}onGetDeviceId(){return this.getDeviceId()}getDeviceId(){const{configManager:t}=this.app;return t.get(Is)||this.app.cookie.get(Ps)||""}getStaticContext(t){const{galileoHost:e,configManager:n}=this.app,i=t?e.getNewHost():e==null?void 0:e.getHost(),s=i.userAgent||"",a=i.cookie||"",r=new xs(s);return{lib_version:this.app.version||fe,device_id:this.getDeviceId(),platform:r.getAppOs()||n.get("platform")||fe,user_agent:s||fe,os:i.os||r.getOS()||fe,os_version:i.os_version||r.getOsVersion()||fe,screen_height:i.screen.height,screen_width:i.screen.width,device_language:i.language||fe,lut:Number(this.lut)||-1,ck:`ce:${i.cookieEnable};cl:${a.length};lss:${i.supportLocalStorage}`,browser:r.getBrowser({vendor:i.vendor})||fe,browser_version:r.getBrowserVersion({vendor:i.vendor})||fe,url_path:i.pathname,current_url:i.url,domain:i.domain,site_name:n.get("site_name")||fe}}getDynamic(){const{configManager:t}=this.app;return{currency:t.get("currency")||fe,language:t.get("language")||fe,site_name:t.get("site_name")||fe}}onUpdateNewContext(){this.refreshContext()}refreshContext(){this.getNewContext()}},Ns=class{constructor(){R(this,"state",{userAgent:"",cookie:"",screen:{width:0,height:0},viewport:{width:0,height:0},viewport_position:{top:0,left:0},language:"",referrer:"",url:"",vendor:"",domain:"",navigationType:"",cookieEnable:!1,os:"",os_version:"",pathname:"",supportLocalStorage:!0}),this.init()}ready(){}getHost(){return L({},this.state)}getNewHost(){return L({},this.getState())}getState(){return this.state}getOnlineStatus(){const t=navigator==null?void 0:navigator.onLine;return typeof t=="boolean"?t:!0}},Ds=class extends Ns{ready(){return K(this,null,function*(){})}init(){this.getState()}getState(){try{const t={userAgent:navigator.userAgent,cookie:document.cookie,screen:{width:window.screen.width,height:window.screen.height},viewport:{width:window.innerWidth,height:window.innerHeight},viewport_position:{top:window.scrollY||window.pageYOffset,left:window.scrollX||window.pageXOffset},language:navigator.language,referrer:document.referrer,url:window.location.href,pathname:window.location.pathname,vendor:navigator.vendor,domain:location.host,cookieEnable:navigator.cookieEnabled,navigationType:this.getNavigationType(),supportLocalStorage:ci()};Object.assign(this.state,t),this.detectOS()}catch(t){console.error("Get Host error",t)}return this.state}getNavigationType(){var i,s;let t="unknown";const e=["unknown","navigate","reload","redirect","back_forward","prerender","other"];let n=!1;if(performance&&performance.getEntriesByType&&(t=(((s=(i=performance.getEntriesByType)==null?void 0:i.call(performance,"navigation"))==null?void 0:s[0])||{}).type,ee(t)||(n=!0)),!n&&performance&&performance.navigation&&typeof performance.navigation.type!="undefined"){const{type:a,redirectCount:r}=performance.navigation;t={0:"navigate",1:"reload",2:"back_forward"}[a]||t,a===0&&r>0&&(t="redirect"),t==="unknown"&&(t=String(a))}return e.includes(t)?t:"other"}detectOS(){var e;const t=navigator.userAgentData;t&&(this.state.os=t.platform||"",(e=t.getHighEntropyValues)==null||e.call(t,["platformVersion"]).then(n=>{n.platformVersion&&(this.state.os_version=n.platformVersion)}))}},Ls=class extends de{constructor(){super(...arguments),R(this,"name","galileoHost"),R(this,"host")}onInit(){this.host=new Ds,this.app.galileoHost=this}getHost(){return this.host.getHost()}onUpdateNewHost(){return this.getNewHost()}getNewHost(){return this.host.getNewHost()}getOnlineStatus(){return this.host.getOnlineStatus()}},Y="unknown",Ts=1e9,an="gl_a_d_a",pt="shared_page_data",yt=t=>/^\d+$/.test(t);function As(t,e){const n=e.split(".");if(n.length===0)return null;let i=t;for(let s=0;s<n.length;s++){const a=n[s];if(i=i[a],!i)return null}return i}var Rs=()=>class extends $t{constructor(){super(...arguments),R(this,"event_version","1.0.0"),R(this,"event_version_prefix","com.klook.galileo.web.")}collectLogger(){this.logger=he(L({},this.logger),{log_id:this.app.getLogIdUid(),log_timestamp:Date.now(),is_debug_mode:!!this.app.isDebugMode(),log_platform:this.app.configManager.get("platform")||Y})}collectTraffic(){const{galileoHost:t}=this.app,n=t.getHost().referrer;this.setTraffic({referrer:n||Y,referrer_host:n?new URL(n).host:Y})}collectContext(){const{contextManager:t}=this.app,e=t.getCurrentContext();this.setContext(he(L({},e),{srv_client_time_diff:this.app.timeDiff||0,device_id:e.device_id||Y}))}collectUser(){const{configManager:t}=this.app,e=t.get("user");this.setUser({assumed_residence:(e==null?void 0:e.assumed_residence)||Y,user_residence:(e==null?void 0:e.user_residence)||Y,global_id:(e==null?void 0:e.global_id)||Y})}get(t){return As(this,t)}collectCommonEvent(){const{event_data:t,event_name:e,event_version:n,event_version_prefix:i}=this,s=this.app.galileoHost.getHost(),r=`${e.replace(/^[$@_]/,"")}`,l=t.timestamp||Date.now(),u={seq:this.app.getSeq(),pvid:this.app.getPvid(),from_pvid:this.app.getFromPvid(),event_name:this.event_name,event_time:l,device_time:l,unique_event_id:this.app.getUuid(),spm:t.spm||Y,page_open_id:this.app.getPageOpenId(),navigation_type:s.navigationType||Y,event_schema:`${i}${r}:${n}`};this.setEvent(u)}beforeCollect(){}afterCollect(){}collect(){this.beforeCollect(),this.collectLogger(),this.collectTraffic(),this.collectContext(),this.collectUser(),this.collectCommonEvent(),this.afterCollect()}serialize(){const t=super.serialize(),e=this.app.getSchema(this.event_name);if(!e)throw new Error(`Schema ${this.event_name} is not found!`);const n=e==null?void 0:e.fromObject(t);if(n!=null&&n.is_schema_type)return n.toJSON();throw new Error(`Schema ${this.event_name} is not valid`)}},Be=Rs(),Bs=class extends Be{constructor(t){super(t),R(this,"event_name",G.Pageview),R(this,"event",{})}beforeCollect(){const{event_data:t}=this,e={view_type:t.view_type||Y};this.setEvent(e)}},Ms=class extends Be{constructor(t){super(t),R(this,"event_name",G.Pageleave),R(this,"event",{})}beforeCollect(){const t=this.app.galileoHost.getNewHost(),e=t.viewport_position.top,n=Re(e)?Y:e,i=this.app.pageview_start||this.app.getStartTime(),s={leave_type:this.event_data.leave_type,viewport_height:t.viewport.height,viewport_width:t.viewport.width,viewport_position:`${n}`,event_duration:Date.now()-i};this.setEvent(s)}},on=class extends Be{constructor(t){super(t),R(this,"event_name",G.Click),R(this,"event",{})}afterCollect(){var s;const{event_data:t}=this,e=Ne(t.event_data)?t.event_data:ai(t.event_data||{});let n=t.spm||Y;t.forward||(n=`${((s=this.app.dataStream.sharedConfig.latestPageview)==null?void 0:s.get("event.spm"))||Y}.${n}`);const i={spm:n,component_name:t.component_name||Y,event_data_schema:t.event_data_schema||Y,event_data:e};this.setEvent(i)}};R(on,"event_name",G.Click);var rn=class extends Be{constructor(t){super(t),R(this,"event_name",G.PopupView),R(this,"event",{})}afterCollect(){var s;const{event_data:t}=this;let e=t.spm||Y;e=`${((s=this.app.dataStream.sharedConfig.latestPageview)==null?void 0:s.get("event.spm"))||Y}.${e}`;const i={spm:e,popup_type:t.popup_type||Y,popup_style:t.popup_style||Y,popup_open_id:t.popup_open_id||Y};this.setEvent(i)}};R(rn,"event_name",G.PopupView);var js=class extends Be{constructor(t){super(t),R(this,"event",{})}afterCollect(){var a;const{event_data:t={}}=this;let{spm:e}=t;const n=t.event_data||{},i=((a=this.app.dataStream.sharedConfig.latestPageview)==null?void 0:a.get("event.spm"))||Y;e!=null&&(e=e||Y,e=`${i}.${e}`);const s={spm:e};ce(n)&&oi(n,(r,l)=>{let u=r;u.is_schema_type?u=u.toJSON():ce(u)&&(u=JSON.stringify(u)),s[l]=u}),this.setEvent(s)}},qs=class extends Be{constructor(t){super(t),R(this,"event",{})}beforeCollect(){const{event_data:t}=this,e=t.event_data||{},n={};if(ce(e)){let i=e.page_data_schema;const s=e.page_data;let a="";const r=Ne(s);if(r)Object.assign(n,e);else if(s&&!r){let l=s;s.is_schema_type&&(l=s.toJSON(),l.getSchema&&(i=l.getSchema())),a=JSON.stringify(l),n.page_data=a,n.page_data_schema=i}}this.setEvent(L({},n))}afterCollect(){var e;const t=((e=this.app.dataStream.sharedConfig.latestPageview)==null?void 0:e.get("event.spm"))||Y;this.setEvent({spm:t})}},Us=class extends de{constructor(){super(...arguments),R(this,"name","dataStream"),R(this,"sharedConfig",{})}onInit(){this.app.dataStream=this,this.registerSchema()}registerSchema(){this.app.registerSchema(G.Pageview,gs),this.app.registerSchema(G.Pageleave,hs),this.app.registerSchema(G.Click,zi),this.app.registerSchema(G.PopupView,ls),this.app.registerSchema(G.PageLoad,ns),this.app.registerSchema(G.Exposure,Zi),this.app.registerSchema(G.PopupLoad,as),this.app.registerSchema(G.BusinessEvent,Gi)}createEventData(t){const{event_name:e}=t;switch(e){case G.Pageview:return new Bs(t);case G.Pageleave:return new Ms(t);case G.Click:return new on(t);case G.PopupView:return new rn(t);case G.PageLoad:return new qs(t)}return e?new js(t):(console.error("event_name is required"),null)}handleEventData(t){return t.init(this.app),t.collect(),t.compose(),this.app.runHookSync($e.onDataEncoding,t)}onDataEncoding({payload:t}){return this._handleEncoding(t)}_handleEncoding(t){var n;const e=t.serialize();return this.app.logger.info("Raw Data",t.event_name,e),{type:3,level:"I",time:Date.now(),msg:JSON.stringify(e),log_ver:2,uid:(n=this.app.configManager.get("user"))==null?void 0:n.global_id,is_masked:!0,platform:this.app.configManager.get("platform")||"desktop"}}_onPageView(t){var n;const{app:e}=this;e.resetSeq(),e.pageview_start=Date.now(),((n=t.event_data)==null?void 0:n.view_type)==="open"&&this._onPageViewOpen(),e.runHookSync($e.onUpdateNewHost,null),e.runHookSync($e.onUpdateNewContext,null)}_onPageViewOpen(){this.app.refreshPageOpenId()}_initPvid(t){const{app:e}=this,n=t==null?void 0:t.pvid,i=-1,s={pvid:i},a=yt(n)?Number(n):i,r=a+1;e.setFromPvid(a),e.setPvid(r);const l=r>=Ts?i:r;return s.pvid=l,s}_initData(t){const e=t.event,{app:n}=this,i=n.storage.syncStorage.getJson(an),s=t.get("webview.pvid"),a=i==null?void 0:i.log_id,r=i==null?void 0:i.log_id_prefix,l=s||(i==null?void 0:i.pvid),u=i==null?void 0:i.lut,v={lut:u,pvid:l},g=(yt(a)?Number(a):-1)+1;n.setLogId(g),v.log_id=g;const m=r||n.getUuid().slice(-12);if(n.setLogIdPrefix(m),v.log_id_prefix=m,e.event_name===G.Pageview){const b=yt(u)?Number(u):-1,w=e.getEventTime()||Date.now(),x=b===-1?b:w-b;n.runHookSync($e.onLutChange,x);const O=this._initPvid({pvid:l,lut:x});v.pvid=O.pvid}if(e.event_name===G.Pageleave){const b=e.getEventTime()||Date.now();v.lut=b}t.set("event.state",L({},v)),n.storage.syncStorage.setJson(an,v)}_beforeHandleEventData(t){const{event:e}=t,{app:n}=this;this._initData(t),e.event_name===G.Pageview&&(this.sharedConfig.latestPageview=e,this._onPageView(e)),n.setSeq(n.getSeq()+1)}setSharedPageData(t){const{app:e}=this,{event:n}=t,i=n.get("event.page_data"),s=n.get("event.page_data_schema");i&&e.setSharedState(pt,{page_data:i,page_data_schema:s})}resetSharedPageData(t){const{app:e}=this;e.removeSharedState(pt)}onCreate(t){const e=this.createEventData(t.event_data);t.event=e}onBeforeHandle(t){var i;const{app:e}=this,{event:n}=t;if(!(n.isType(G.Pageview)&&((i=n.event_data)==null?void 0:i.view_type)==="open")){const s=e.getSharedState(pt);s&&n.setEvent(s)}}onHandle(t){var s;const{app:e}=this,{event:n}=t;this._beforeHandleEventData(t),n.isType(G.Pageview)&&(e.runHooks("onPvidUpdate",t),((s=n.event_data)==null?void 0:s.view_type)==="open"&&this.resetSharedPageData(t));const i=this.handleEventData(n);n.isType(G.PageLoad)&&this.setSharedPageData(t),this.app.logger.debug("onHandle",t),t.set(sn,{data:i,config:{eventType:n.event_name,query:{log_id:e.getLogIdUid()}}})}},ln="galileo_debug",cn=`__${ln}`,Js=class extends de{constructor(){super(...arguments),R(this,"name","galileoDebug")}onInit(){const{app:t}=this;if(!t.isDebugMode()){let e=t.storage.syncStorage.get(cn);const n=t.cookie.get(ln);e=e||n;const i=e==="true"?!0:e,s=typeof location!="undefined"?location.href:"";t.configManager.set("is_debug_mode",i||new RegExp(`${cn}`).test(s))}}};function un(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){const s=t[i],a=e[i];for(let r=0;r<n.length;r++){const l=n[r];if((s==null?void 0:s[l])!==(a==null?void 0:a[l]))return!1}}return!0}var hn=(t=>(t.beforeunload="beforeunload",t.unload="unload",t.pagehide="pagehide",t.pageshow="pageshow",t.visibilitychange="visibilitychange",t))(hn||{}),Hs={HIDDEN:"hidden",VISIBLE:"visible"},$s=class extends de{constructor(){super(...arguments),R(this,"name","galileoNativeEvent"),R(this,"_pageState")}onInit(){this.app.pageState=new jt,this._pageState=this.app.pageState,this.app.nativeEvent=this}onReady(){document.addEventListener("pagehide",()=>{this._pageWillUnload({event_name:"pagehide"})}),document.addEventListener("visibilitychange",()=>{this._pageWillUnload({event_name:"visibilitychange"})}),window.addEventListener("beforeunload",()=>{this._pageWillUnload({event_name:"beforeunload"})}),window.addEventListener("unload",()=>{this._pageWillUnload({event_name:"unload"})}),window.addEventListener("online",()=>{this._networkOnline()})}_networkOnline(){this.app.runPluginHookSync(t=>{if(z(t==null?void 0:t.onNetworkOnline))return t==null?void 0:t.onNetworkOnline()})}_pageWillUnload(t){const e=()=>({visibility:document.visibilityState});if(this._pageState.push(L(L({},t),e())),this.app.runPluginHookSync(n=>{if(z(n==null?void 0:n.pageWillUnload))return n==null?void 0:n.pageWillUnload(t)}),this.app.getDebugMode()==="warn"){const n=JSON.stringify(this._pageState.getState());console.info("pageState",n),this.app.storage.syncStorage.set("pageStatus",n)}}isPageLeave(){return De()&&ye()?this.app.pageState.getLast(3).some(e=>["pagehide","unload"].includes(e.event_name)):gt()?this.safariPageLeave():this.pageLeaveStatus()}pageLeaveStatus(){return!!this.app.pageState.getState().some(e=>["unload","beforeunload"].includes(e==null?void 0:e.event_name))}safariPageLeave(){const{beforeunload:t,pagehide:e,visibilitychange:n,unload:i}=hn,{HIDDEN:s,VISIBLE:a}=Hs,r=[{all:[[e,a],[n,s]],partial:[[n,s],[n,a],[e,a],[n,s]]},{all:[[t,a],[e,a],[n,s],[i,s]],partial:[[n,s],[n,a],[t,a],[e,a],[n,s],[i,s]]},{all:[[t,a],[e,a],[n,s]],partial:[[n,s],[n,a],[t,a],[e,a],[n,s]]}],l=v=>v.map(p=>({event_name:p[0],visibility:p[1]}));let u=!1;for(let v=0;v<r.length;v++){const p=r[v],g=this.app.pageState.getState(),{all:m,partial:b}=p,w=l(m),x=["event_name","visibility"];if(un(g,w,x)){u=!0;break}const O=l(b),C=this.app.pageState.getLast(O.length);if(un(C,O,x)){u=!0;break}}return u}};function dn(t,...e){const n=e;for(let i=1;i<n.length;i++){const s=n[i];for(const a in s)t[a]=s[a]}return t}var Vs={read(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Fs(t,e){function n(s,a,r){if(typeof document=="undefined")return;r=dn({path:"/"},e,r),typeof r.expires=="number"&&(r.expires=new Date(Date.now()+r.expires*864e5)),r.expires&&(r.expires=r.expires.toUTCString()),s=encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);let l="";for(const u in r)r[u]&&(l+=`; ${u}`,r[u]!==!0&&(l+=`=${r[u].split(";")[0]}`));return document.cookie=`${s}=${t.write(a,s)}${l}`}function i(s){if(typeof document=="undefined"||arguments.length&&!s)return;const a=document.cookie?document.cookie.split("; "):[],r={};for(let l=0;l<a.length;l++){const u=a[l].split("="),v=u.slice(1).join("=");try{const p=decodeURIComponent(u[0]);if(r[p]=t.read(v,p),s===p)break}catch(p){console.error("parse cookie error",p)}}return s?r[s]:r}return Object.create({set:n,get:i,remove(s,a={}){n(s,"",dn({},a,{expires:-1}))}},{})}var Ws=Fs(Vs,{path:"/"}),Gs=class extends de{constructor(){super(...arguments),R(this,"name","webCookie")}onInit(){this.app.cookie=Ws}},Ks=200,Qs="galileo:",zs=typeof AbortController=="function",Ys=class{constructor(){R(this,"_prefix",Qs),R(this,"_runningState","async")}setRunningState(t){this._runningState=t}request(t,e,n){var a;const i=this._prefix+t;if(((n==null?void 0:n.runningState)||this._runningState)==="sync"||!z((a=navigator.locks)==null?void 0:a.request)||!zs)return e();{const r=(n==null?void 0:n.timeout)||Ks;try{const l=new AbortController,u=l.signal;return setTimeout(()=>{l.abort()},r),navigator.locks.request(i,{signal:u},v=>K(this,null,function*(){return e()})).catch(v=>e({type:"lock-catch",error:v}))}catch(l){return e({type:"lock-req",error:l})}}}},Xs=class extends de{constructor(){super(...arguments),R(this,"name","webLocks")}onInit(){this.app.webLocks=new Ys}pageWillUnload(){const{app:t}=this,e=t.pageState.getLast(4).map(n=>n.event_name).join("|");/(beforeunload|unload)/.test(e)&&t.webLocks.setRunningState("sync")}},Zs="infra.galileo.get",ea="infra.galileo.set",ta=300,na=class extends de{constructor(){super(...arguments),R(this,"name","Webview"),R(this,"isInApp",!1)}onInit(){this.app.webview=this,this.isInApp=ye()}onBeforeHandle(t){if(!this.isInApp)return;const e=this.getGalileoData(["pvid"]);return e==null?void 0:e.then(n=>{const i=n==null?void 0:n.pvid;this.app.logger.info("webview pvid",i),/\d+/.test(i)&&i>=0&&t.set("webview.pvid",Number(i))})}onPvidUpdate(t){if(!this.isInApp)return;const e=t.get("event.state"),n=this.app.getPvid(),i=(e==null?void 0:e.pvid)||n;dt(i)&&i>=0&&(this.app.logger.info("webview pvid update",i),this.setGalileoData({pvid:String(i)}))}getGalileoData(t){if(!this.isInApp)return;const e=this.sendMessage(Zs,t);return e?Promise.race([si(ta),e]):null}setGalileoData(t){return this.sendMessage(ea,t)}sendMessage(t,...e){if(!this.isInApp)return;const n=Ie.call(t,...e);if(n&&z(n.then))return n.catch(i=>(console.error(`JsBridge call ${t} error`,i),null))}},ia="time_diff",fn="k_g__ti_diff",gn=1e3*60*60*24,sa="/v3/frontlogsrv/log/servertime",aa="https://log.klook.com",oa="https://log.klook.cn",ra=class extends de{constructor(){super(...arguments),R(this,"name","syncTime"),R(this,"url","")}onInit(){if(Mt){const t=/\.cn/.test(location.host)?oa:aa;this.url=`${t}${sa}`}this.app.syncTime=this}onReady(){var e,n;const{app:t}=this;if(ye())(e=t.webview.getGalileoData([ia]))==null||e.then(i=>{const s=i==null?void 0:i.time_diff;this.setTimeDiff(s||0)}).catch(i=>{console.error("get time diff error",i)});else{const i=t.storage.syncStorage.getJson(fn)||{},{time_diff:s,timestamp:a}=i;dt(s)&&a&&Date.now()-a<gn?this.setTimeDiff(s):(n=this.requestServerTime())==null||n.then(r=>{const l=(r==null?void 0:r.timeDiff)||0;this.setTimeDiff(l);const u=Date.now();t.storage.syncStorage.setJson(fn,{time_diff:l,timestamp:l?u:u-gn/4})})}}setTimeDiff(t){this.app.timeDiff=t}getUrl(){return this.app.configManager.get("syncTimeUrl")||this.url}requestServerTime(){const t=this.getUrl();if(t)return this.app.request.sendXhr({url:t,method:"GET"}).then(e=>K(this,null,function*(){const n=Date.now(),i=e==null?void 0:e.data;let s=i==null?void 0:i.server_time;if(s)return s=dt(s)?s:0,{timeDiff:s?n-s:0}})).catch(e=>{this.app.logger.error("Request server time error: "),this.app.logger.error(e)})}},la=class{constructor(){R(this,"app"),R(this,"corePlugins",[Xs,Li,Js,$s,Ls,Cs,ks,Us,na,ra]),this.app=new ki({corePlugins:this.corePlugins,version:"1.4.0"}),this.initInner()}initInner(){const e=[Gs,Fi].map(n=>{const i=new n(this.app);return this.app.setPluginInstance(i),i});e.forEach(n=>{var i;(i=n.onInit)==null||i.call(n)}),e.forEach(n=>{var i;(i=n.onReady)==null||i.call(n)})}},ca=class extends la{constructor(){super(),this.cmdPushCheck(),this.cmdCheck()}cmdPushCheck(){const t=window.k_galileo_queue||[];window.k_galileo_queue=t;const e=t.push;t.push=(...n)=>(setTimeout(()=>{this.cmdCheck()},10),e.apply(t,n)),Mt&&window.addEventListener("load",()=>{this.cmdCheck()})}cmdCheck(){const t=window.k_galileo_queue||[];if(Array.isArray(t)&&t.length>0){const e=t.slice();window.k_galileo_queue.length=0,e.sort((n,i)=>(n==null?void 0:n.type)==="init"&&(i==null?void 0:i.type)==="init"?1:(n==null?void 0:n.type)==="init"?-1:1),this.runSeq(e)}}runSeq(t,e){const n=i=>{if(i>=t.length){e==null||e();return}const s=t[i],a=s==null?void 0:s.fn,r=l=>{const v=l(this);Xn(v)?v.then(()=>{n(i+1)}).catch(()=>{n(i+1)}):n(i+1)};z(a)?r(a):n(i+1)};n(0)}},ua=class extends ca{constructor(){super()}init(t){return K(this,null,function*(){var e,n;try{this.app.setConfig(t),yield this.app.init()}catch(i){const s=i;console.error("Galileo Init Error",s),(n=(e=this.app).sendDebugData)==null||n.call(e,{tag:"galileo-init-error",errmsg:s.message,errcode:s.name,errstack:s.stack})}return this})}set(t,e){this.app.configManager.set(t,e)}login(t){return this.app.configManager.set("user",L({},t))}logout(){return this.app.configManager.set("user",{})}onReady(t){this.app.subscribe(t)}track(t,e){var v,p;if(!this.app.isReady()){this.onReady(()=>this.track(t,e)),console.error("Galileo is not ready or Init failed, Please init first before track"),(p=(v=this.app).sendDebugData)==null||p.call(v,{tag:"galileo-not-ready-track-error",track_message:`eventName: ${t}`});return}const n=he(L({},e),{event_name:t});this.app.logger.info("Raw event Data",t,n);const{app:i}=this,s=i.createContext(n),a=(g,m)=>{var w,x;const b={tag:"galileo-track-cb-error",eventName:t,errtype:g,errmsg:m==null?void 0:m.message,errcode:m==null?void 0:m.name,errstack:m==null?void 0:m.stack};i.logger.error(b),(x=(w=this.app).sendDebugData)==null||x.call(w,b)},r=[g=>i.runHooks(bs,s,g),g=>i.runHooks(ws,s,g),g=>{var w;const m=x=>{const O=x==null?void 0:x.error;return O&&a(x.type||"lock-error",O),i.runHooks(ys,s,g)};let b=G.Click===t?"sync":"async";return((w=s.event_data)==null?void 0:w.leave_type)==="close"&&(b="sync"),i.webLocks.request(ps,m,{runningState:b})},g=>i.runHooks(Os,s,g),g=>i.runHooks(Ss,s,g),g=>i.runHooks(Es,s,g)],l=()=>{var b;const g=s.getStopReason();g&&i.logger.debug("Complete Error",t,g),i.logger.debug("Complete Event",t,s);const m=s.getError();if(m.length){const w="Collect event error";i.logger.error(w,m),(b=i.sendDebugData)==null||b.call(i,{tag:w,eventName:t,errors:m.map(x=>{const O=x||{};return{errname:O.name,errMsg:O.message,errStack:O.stack}})})}},u=(g=0)=>s.isStop()?l==null?void 0:l():g<r.length?r[g](()=>u(g+1)):l==null?void 0:l();try{const g=u(0);return z(g==null?void 0:g.then)?g.catch(m=>{a("hook-error",m)}):g}catch(g){a("hook-error",g)}}},ha=Object.defineProperty,da=Object.defineProperties,fa=Object.getOwnPropertyDescriptors,_n=Object.getOwnPropertySymbols,ga=Object.prototype.hasOwnProperty,_a=Object.prototype.propertyIsEnumerable,bt=(t,e,n)=>e in t?ha(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,q=(t,e)=>{for(var n in e||(e={}))ga.call(e,n)&&bt(t,n,e[n]);if(_n)for(var n of _n(e))_a.call(e,n)&&bt(t,n,e[n]);return t},ge=(t,e)=>da(t,fa(e)),oe=(t,e,n)=>bt(t,typeof e!="symbol"?e+"":e,n),vn=(t,e,n)=>new Promise((i,s)=>{var a=u=>{try{l(n.next(u))}catch(v){s(v)}},r=u=>{try{l(n.throw(u))}catch(v){s(v)}},l=u=>u.done?i(u.value):Promise.resolve(u.value).then(a,r);l((n=n.apply(t,e)).next())}),va=t=>Object.prototype.toString.call(t),wt=t=>e=>e!==null&&(Array.isArray(t)?t:[t]).some(n=>va(e)===`[object ${n}]`),nt=wt("String"),pe=wt(["Function","AsyncFunction","GeneratorFunction"]),it=wt("Object");["debug","info","warn","error"].reduce((t,e,n,i)=>ge(q({},t),{[e]:i.slice(n)}),{});function st(t,e){const n=Object.keys(t);for(let i=0;i<n.length;i++){const s=n[i],a=t[s];e(a,s,t)}}var ae=typeof window!="undefined",mn=()=>{const t=window.safari;return!!(typeof t=="object"&&t.pushNotification)},ma=()=>{const t=navigator.userAgent;return/android/i.test(t)},at=t=>{const e=navigator.userAgent;return/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(e)},Ve=()=>/klook/i.test(navigator.userAgent),pa=class{constructor(t){oe(this,"_state",[]),oe(this,"_options",{max:20}),this._options=q(q({},this._options),t)}push(t){const{max:e}=this._options;this._state.length>=e&&this._state.shift(),this._state.push(t)}getLast(t){return this._state.slice(-t)}getState(){return this._state.slice()}},V={HIDDEN:"hidden",VISIBLE:"visible"};function pn(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){const s=t[i],a=e[i];if(!n(s,a))return!1}return!0}function ya(t){const e=[{all:[["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN]],partial:[["visibilitychange",V.HIDDEN],["visibilitychange",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN]]},{all:[["beforeunload",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN],["unload",V.HIDDEN]],partial:[["visibilitychange",V.HIDDEN],["visibilitychange",V.VISIBLE],["beforeunload",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN],["unload",V.HIDDEN]]},{all:[["beforeunload",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN]],partial:[["visibilitychange",V.HIDDEN],["visibilitychange",V.VISIBLE],["beforeunload",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN]]}],n=s=>s.map(a=>({event_name:a[0],visibility:a[1]}));let i=!1;for(let s=0;s<e.length;s++){const a=e[s],r=t.getState(),{all:l,partial:u}=a,v=n(l),p=(b,w)=>b.event_name===w.event_name&&b.visibility===w.visibility;if(pn(r,v,p)){i=!0;break}const g=n(u),m=t.getLast(g.length);if(pn(m,g,p)){i=!0;break}}return i}function Fe(t,e){t.push({event_name:e,visibility:document.visibilityState})}function ba(t){const e=[["beforeunload","pagehide","unload"],["beforeunload","unload"],["visibilitychange","pagehide","unload"],["visibilitychange","unload"]],n=t.getLast(4).map(i=>i.event_name);return e.some(i=>i.every(s=>n.includes(s)))}function wa(t){const e={pagehide:V.VISIBLE,unload:V.HIDDEN};return t.getLast(1).every(n=>{const i=n.event_name;return e[i]===n.visibility})}function Sa(t){return at()&&Ve()?wa(t):mn()?ya(t):ba(t)}function ot(t,e){const n=Sa(t);e(n)}function Oa(t,e){const n=t.getLast(3),i=n.map(s=>s.event_name);if(ma()&&Ve()){const s=[{k:"beforeunload",v:V.VISIBLE},{k:"visibilitychange",v:V.HIDDEN}],a=n.slice(-2);s.every((r,l)=>{const{k:u,v}=r,{event_name:p,visibility:g}=a[l]||{};return p===u&&g===v})&&setTimeout(()=>{const[r]=t.getLast(1);if((r==null?void 0:r.event_name)!=="unload")return e()},100);return}i.includes("beforeunload")||e()}var Ea=class{constructor(){oe(this,"_onBeforeUnload"),oe(this,"_onPageHide"),oe(this,"_onPageShow"),oe(this,"_onPageUnload"),oe(this,"_onVisibilityChange"),oe(this,"_subscribers",new Map),oe(this,"addListener"),oe(this,"removeListener"),oe(this,"states"),this.addListener=window.addEventListener.bind(window),this.removeListener=window.removeEventListener.bind(window),this.states=new pa,this.initCallback()}initCallback(){const{states:t}=this;this._onBeforeUnload=()=>{Fe(t,"beforeunload"),this.onBeforeUnload()},this._onPageHide=e=>{Fe(t,"pagehide"),this.onPageHide()},this._onPageShow=e=>{Fe(t,"pageshow"),this.onPageShow()},this._onVisibilityChange=()=>{Fe(t,"visibilitychange"),this.onVisibilityChange()},this._onPageUnload=()=>{Fe(t,"unload"),this.onPageUnload()}}onPageShow(){}onPageHide(){at()&&Ve()&&ot(this.states,t=>{t&&this.onPageLeave({leave_type:"close"})})}onBeforeUnload(){}onPageUnload(){const{states:t}=this;ot(t,e=>{at()&&Ve()&&t.getLast(4).some(n=>n.event_name==="pagehide")||e&&this.onPageLeave({leave_type:"close"})})}onVisibilityChange(){const{states:t}=this;if(document.visibilityState===V.VISIBLE)this.onPageView({view_type:"show"});else if(at()&&Ve()){if(t.getLast(4).some(e=>e.event_name==="pagehide"))return;ot(t,e=>{this.onPageLeave({leave_type:e?"close":"hide"})})}else mn()?ot(t,e=>{this.onPageLeave({leave_type:e?"close":"hide"})}):Oa(t,()=>{this.onPageLeave({leave_type:"hide"})})}onPageView(t){this._callSubs("onPageView",t)}onPageLeave(t){this._callSubs("onPageLeave",t)}_callSubs(t,e){const n=this._subscribers.get(t);n==null||n.forEach(i=>i.fn(e))}subscribe(t,e,n){const i=this._subscribers.get(t)||[];pe(n)&&!i.map(s=>s.id).includes(e)&&i.push({id:e,fn:n}),this._subscribers.set(t,i)}unbindEvents(){this.removeListener("pageshow",this._onPageShow),this.removeListener("beforeunload",this._onBeforeUnload),this.removeListener("unload",this._onPageUnload),document.removeEventListener("pagehide",this._onPageHide),document.removeEventListener("visibilitychange",this._onVisibilityChange)}bindEvents(){this.addListener("pageshow",this._onPageShow),this.addListener("beforeunload",this._onBeforeUnload),this.addListener("unload",this._onPageUnload),document.addEventListener("pagehide",this._onPageHide),document.addEventListener("visibilitychange",this._onVisibilityChange)}destroy(){this.unbindEvents(),this._subscribers.clear()}},ka=()=>{if(ae){const t=window.scheduler;return t&&typeof t.postTask=="function"}return!1},Ia=class{static postTask(t,e){return vn(this,null,function*(){let{delay:n=0,priority:i="user-visible"}=e||{};return new Promise((s,a)=>{if(!pe(t))return console.warn("Scheduler postTask: task is not a function"),s();n=typeof n!="number"||n<0?0:n,ka()?window.scheduler.postTask(t,{delay:n,priority:i}):setTimeout(()=>vn(this,null,function*(){try{yield t(),s()}catch(r){a(r)}}),n)})})}};const yn=()=>ae?window._galileo||window.Galileo:void 0,Pa=()=>{const t=window.k_galileo_queue||[],e=Array.isArray(t)?t:[];return window.k_galileo_queue=e,e},We=(t,e)=>{if(!ae)return;const n=yn();if(n)return pe(n.callSafe)?n.callSafe(()=>t(n)):t(n);Pa().push({type:e,fn:t})},Ge=(t,e)=>{try{return t()}catch(n){return console.error("galileo click error",n),e==null||e(n),null}},Me=(t={})=>{ae&&We(e=>{var n,i;(i=(n=e==null?void 0:e.app)==null?void 0:n.sendDebugData)==null||i.call(n,t)})},xa=(t="",e="popup")=>{const n=Math.random().toString(36).substring(2,15);return[e,t,n].filter(Boolean).join("-")},St="data-spm-",Ot={module:`${St}module`,item:`${St}item`,virtualItem:`${St}virtual-item`},Ca=t=>t!=null&&t.getAttribute&&(t.getAttribute(Ot.item)||t.getAttribute(Ot.virtualItem))||"",bn=/^WebClick_\d+$/i;function wn(t){var e;let n=t;const i={item:"",module:""};for(;n;){if(!i.item){const r=Ca(n);if(r){const l=r.split("?")[0];i.item=/(__default|__virtual)/.test(l)?"":l}}const a=(n==null?void 0:n.getAttribute(Ot.module))||"";if(a){i.module=a.split("?")[0];break}if(((e=n.tagName)==null?void 0:e.toLowerCase())==="body")break;n=n.parentElement}const s=[i.module,i.item?i.item:""].filter(a=>!!a);return s.length?s.join("."):""}const Na="galileo_event_data";var Ke=(t=>(t.PAGE_OPEN="open",t.PAGE_SHOW="show",t.PAGE_CLOSE="close",t.PAGE_HIDE="hide",t))(Ke||{}),Qe=(t=>(t.Pageview="$WebPageView",t.Pageleave="$WebPageLeave",t.Click="$Click",t.Popup="$PopupView",t.PopupLoad="$PopupLoad",t.PageLoad="$PageLoad",t.Exposure="$Exposure",t.Business="$BusinessEvent",t))(Qe||{});const Da=t=>{try{const{spm:e,data:n,schema:i,timestamp:s=Date.now(),component_name:a}=t,{version:r}=i,l=nt(n)?n:JSON.stringify(n);We(u=>{u==null||u.track(Qe.Click,{spm:e,timestamp:s,component_name:a,event_data_schema:r,event_data:l})})}catch(e){console.log("track error",e)}};var Le=(t=>(t.ENTERING="entering",t.INTERSECTING="intersecting",t.LEAVING="leaving",t.OUT="out",t))(Le||{});const La=(t="")=>xa(t,"exposure"),Et=t=>(t==null?void 0:t.tagName)!=null;class Ta{constructor(e={}){oe(this,"exposureMap",new Map),oe(this,"intersectionObserver",null),oe(this,"intervalTimer",null),oe(this,"options");var n,i,s;this.options={threshold:(n=e.threshold)!=null?n:.8,minDuration:(i=e.minDuration)!=null?i:300,intervalTime:(s=e.intervalTime)!=null?s:300,onExposure:e.onExposure},this.init()}init(){if(typeof IntersectionObserver=="undefined"){console.warn("IntersectionObserver is not supported in this browser.");return}this.intersectionObserver=new IntersectionObserver(this.handleIntersectionChange.bind(this),{threshold:[0,this.options.threshold,1],rootMargin:"0px"}),this.startIntervalCheck()}startIntervalCheck(){this.intervalTimer=setInterval(()=>{this.exposureMap.forEach((e,n)=>{e.eStatus===Le.INTERSECTING&&e.sTime&&Date.now()-e.sTime>=this.options.minDuration&&!e.removed&&(this.triggerExposure(n,e),this.exposureMap.set(n,ge(q({},e),{sTime:Date.now(),removed:!0})))})},this.options.intervalTime)}handleIntersectionChange(e){e.forEach(n=>{var i,s,a;if(n.intersectionRatio<0)return;const r=n.target,l=this.exposureMap.get(r);if(this.exposureMap.has(r)&&l!=null&&l.removed){(i=this.intersectionObserver)==null||i.unobserve(r),this.exposureMap.delete(r);return}if(n.intersectionRatio>=this.options.threshold){if(n.isIntersecting&&(!this.exposureMap.has(r)||!((s=this.exposureMap.get(r))!=null&&s.sTime))){const u=this.exposureMap.get(r),v=(u==null?void 0:u.id)||this.generateExposureId(r);this.exposureMap.set(r,{id:v,sTime:Date.now(),ratio:n.intersectionRatio,removed:!1,onExposure:u==null?void 0:u.onExposure,eStatus:Le.INTERSECTING})}}else if(this.exposureMap.has(r)&&!n.isIntersecting){const u=l;if(this.exposureMap.set(r,ge(q({},u),{eStatus:Le.LEAVING})),Date.now()-u.sTime>=this.options.minDuration){const v=ge(q({},u),{ratio:u.ratio,eStatus:Le.OUT});this.triggerExposure(r,v),this.exposureMap.delete(r),(a=this.intersectionObserver)==null||a.unobserve(r)}else this.exposureMap.set(r,ge(q({},u),{eStatus:Le.OUT,removed:!1}))}})}generateExposureId(e){const n=Date.now(),i=Math.random().toString(36).substr(2,9),s=e.id||"",a=e.className||"";return`exp_${e.tagName.toLowerCase()}_${s}_${a}_${n}_${i}`.replace(/\W/g,"_")}triggerExposure(e,n){try{const i=Date.now()-n.sTime;n.onExposure?n.onExposure(e,q({duration:i},n)):this.options.onExposure&&this.options.onExposure(e,q({duration:i},n))}catch(i){console.warn("Failed to trigger exposure callback:",i)}}getExposureDataById(e){for(const[n,i]of this.exposureMap.entries())if(i.id===e)return{element:n,data:i};return null}updateExposureDataById(e){return!!this.getExposureDataById(e)}manualTriggerExposureById(e){const n=this.getExposureDataById(e);return n?(this.triggerExposure(n.element,n.data),this.exposureMap.set(n.element,ge(q({},n.data),{removed:!0})),!0):!1}manualTriggerExposure(e){const n=this.exposureMap.get(e);return n?(this.triggerExposure(e,n),this.exposureMap.set(e,ge(q({},n),{removed:!0})),!0):!1}observe(e,n){if(this.intersectionObserver){const i=(n==null?void 0:n.customId)||La(),{onExposure:s,force:a}=n||{};if(this.exposureMap.has(e)&&!a){const r=this.exposureMap.get(e);this.exposureMap.set(e,ge(q({},r),{id:i||r.id,onExposure:s||r.onExposure}))}else{if(a&&this.unobserve(e),i||s){const r={eStatus:Le.ENTERING};i&&(r.id=i),s&&(r.onExposure=s),this.exposureMap.set(e,r)}this.intersectionObserver.observe(e)}i&&this.setElementData(e,i)}}setElementData(e,n){n&&e.setAttribute("data-exposure-id",n)}unobserve(e){this.intersectionObserver&&(this.intersectionObserver.unobserve(e),this.exposureMap.delete(e))}observeElements(e,n){const{idPrefix:i,onExposure:s}=n||{};document.querySelectorAll(e).forEach((a,r)=>{const l=i?`${i}_${r}`:void 0;this.observe(a,{customId:l,onExposure:s})})}destroy(){this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null),this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null),this.exposureMap.clear()}updateOptions(e){this.options=q(q({},this.options),e)}isObserving(e){return this.exposureMap.has(e)}getObservedElementsCount(){return this.exposureMap.size}cleanupRemovedElements(){const e=[];return this.exposureMap.forEach((n,i)=>{document.contains(i)||e.push(i)}),e.forEach(n=>{var i;this.exposureMap.delete(n),(i=this.intersectionObserver)==null||i.unobserve(n)}),e.length}getElementStatus(e){const n=this.exposureMap.get(e);return(n==null?void 0:n.eStatus)||null}}let kt=null;const It=t=>(kt||(kt=new Ta(t)),kt),Aa="galileo_event_data",Ra=t=>{try{const{spm:e,data:n,schema:i,timestamp:s=Date.now()}=t,{version:a}=i,r=nt(n)?n:JSON.stringify(n),l=()=>We(u=>{var v;if(((v=u.app)==null?void 0:v.getConfig("enableExposure"))!==!1)return u==null?void 0:u.track(Qe.Exposure,{spm:e,timestamp:s,event_data:{event_data_schema:a,event_data:r}})});return Ia.postTask(l,{delay:300})}catch(e){console.log("track error",e)}};function Ba(t,e){const{spm:n="",mapData:i=[],schema:s,eventData:a,component_name:r,payload:l={}}=e,u={},v=Date.now();try{Array.isArray(i)?i.forEach(w=>{nt(w)?u[w]=t[w]:it(w)?st(w,(x,O)=>{const C=t[O];x&&(u[x]=C)}):pe(w)&&w({inst:t,eventData:u,payload:l})}):it(i)?st(i,(w,x)=>{const O=t[x];w&&(u[w]=O)}):pe(i)&&i({inst:t,eventData:u,payload:l})}catch(w){console.error("mapData error",i,w)}const p=q({},u),g=n||p.spm||"";p.spm&&delete p.spm;const m={};if(a){const w=pe(a)?a(q({payload:l,spm:g},p),t):a;w&&w.is_schema_type&&(m.event_data=w.toJSON(),m.event_data_schema=w.getSchema())}const b={spm:g,data:m.event_data||p,schema:m.event_data_schema?{version:m.event_data_schema}:ge(q({},s),{version:(s==null?void 0:s.version)||"com.klook.galileo.UniversalExposure:1.0.0"}),timestamp:v,component_name:r};Ra(b)}function Ma(t){const{value:e,vnode:n,element:i,exposureData:s}=t,{inner:a=!1}=e,r=n.componentInstance,l=n.context,u=a&&r||l,v=(r==null?void 0:r[Aa])||{},p=q(q({},v),e);if(i&&(!p.spm||bn.test(p.spm))){const g=wn(i);g&&(p.spm=g)}Ba(u,q({},p)),ae&&window.__Galileo_Exposure&&CustomEvent&&window.dispatchEvent(new CustomEvent("galileo-exposure",{detail:{element:i,value:e,exposureData:s}}))}function Sn(t){ae&&Ge(()=>{Ma(t)},e=>{Me({tag:"galileo-exposure-error",errmsg:e==null?void 0:e.message,errcode:e==null?void 0:e.name,errstack:e==null?void 0:e.stack})})}function On(t){var e;const n=It();if(!n)return;const{el:i,binding:s,type:a,vnode:r}=t,l=(v,p)=>{Sn({exposureData:p,element:v,value:s.value,vnode:r})};let u=!1;if(a==="update"){const{value:v,oldValue:p}=s;u=p.spm!==v.spm||p.key!==v.key}n.observe(i,{onExposure:l,customId:(e=s.value)==null?void 0:e.customId,force:u})}function En(t){const e=It();if(!e)return;const{el:n,binding:i,type:s,vnode:a}=t,{value:r,oldValue:l,modifiers:u}=i;if(!(u!=null&&u.exposure))return;if((r==null?void 0:r.exposure)===!1){s==="update"&&e.unobserve(n);return}const v=q(q({},r),r.exposure),p=(m,b)=>{Sn({exposureData:b,element:m,value:v,vnode:a})};let g=!1;if(s==="update"){const m=q({spm:l.spm},l.exposure),b=q({spm:r.spm},r.exposure);g=m.spm!==b.spm||m.key!==b.key}e.observe(n,{onExposure:p,customId:r==null?void 0:r.customId,force:g})}function kn(t,e){const{spm:n="",propKey:i=Na,mapMethods:s,mapData:a=[],schema:r,eventData:l,component_name:u,nativeEvent:v,autoTrackSpm:p,payload:g={}}=e,m=t[i],b={},w=Date.now(),x=(m==null?void 0:m.eventData)||l;try{Array.isArray(a)?a.forEach(B=>{nt(B)?b[B]=t[B]:it(B)?st(B,(E,A)=>{const T=t[A];E&&(b[E]=T)}):pe(B)&&B({inst:t,eventData:b,payload:g})}):it(a)?st(a,(B,E)=>{const A=t[E];B&&(b[B]=A)}):pe(a)&&a({inst:t,eventData:b,payload:g})}catch(B){console.error("mapData error",a,B)}const O=q(q({},b),m);let C=n||O.spm||"";if(O.spm&&delete O.spm,(p||bn.test(C))&&v){const B=v.target,E=wn(B);E&&(C=E)}const N={};if(x){const B=pe(x)?x(q({payload:g,spm:C},O),t):x;B&&B.is_schema_type&&(N.event_data=B.toJSON(),N.event_data_schema=B.getSchema())}const te={spm:C,data:N.event_data||O,schema:N.event_data_schema?{version:N.event_data_schema}:ge(q({},r),{version:(r==null?void 0:r.version)||"com.klook.galileo.UniversalClick:1.0.0"}),timestamp:w,component_name:u};Da(te)}function In(t,e){const{binding:n,vnode:i,bindType:s}=e,{value:a,arg:r,modifiers:l}=n,{mapMethods:u,binding:v=r==null,enforce:p="post",inner:g=!1,enable:m=!0,componentName:b}=a,w=l!=null&&l.capture?!0:p==="pre",x=!!(l!=null&&l.stop),O=!!m,C=i.componentInstance,N=i.context,te=g&&C||N,B=te.$options._componentTag,E=b||B||t.tagName||N.name||"Unknown",A=C||N;if(v){const T=J=>{x&&(J==null||J.stopPropagation()),Ge(()=>{kn(te,q({bindType:s,nativeEvent:J,component_name:E},a))},F=>{Me({tag:"galileo-click-directive-trigger",detail:`name: ${E}`,bindtype:s,errmsg:F==null?void 0:F.message,errcode:F==null?void 0:F.name,errstack:F==null?void 0:F.stack})})};if(t.__galileo_bind_event&&!O&&t.removeEventListener("click",t.__galileo_bind_event,w),!O){t.__galileo_bind_event=null;return}if(t.__galileo_bind_event)return;t.addEventListener("click",T,w),t.__galileo_bind_event=T}else if(A&&r){const T=`__inst_vue_event_${r}`;if(A[T]&&A.$off(r,A[T]),!O){A[T]=null;return}const J=F=>{Ge(()=>{kn(te,q({payload:F,bindType:s,component_name:E},a))},X=>{Me({tag:"galileo-click-directive-trigger",detail:`name: ${E}`,bindtype:s,errmsg:X==null?void 0:X.message,errcode:X==null?void 0:X.name,errstack:X==null?void 0:X.stack})})};A.$on(r,J),A[T]=J}else{const T={tag:"galileo-click-directive",errmsg:"No component instance or vueEventName provided for binding",errcode:"NO_COMPONENT_INSTANCE",errstack:new Error("error").stack};Me(T),console.error("Galileo Click Tracker Error:",T)}}q({name:"galileoClickTracker"},{bind(t,e,n){const{value:i}=e;!i||!ae||!t||(Ge(()=>{In(t,{binding:e,vnode:n,bindType:"bind"})},s=>{Me({tag:"galileo-click-directive",bindtype:"bind",errmsg:s==null?void 0:s.message,errcode:s==null?void 0:s.name,errstack:s==null?void 0:s.stack})}),En({el:t,binding:e,vnode:n,type:"bind"}))},update(t,e,n){const{value:i}=e;!i||!ae||!t||(En({el:t,binding:e,vnode:n,type:"update"}),Ge(()=>{In(t,{binding:e,vnode:n,bindType:"update"})},s=>{Me({tag:"galileo-click-directive",errmsg:s==null?void 0:s.message,errcode:s==null?void 0:s.name,errstack:s==null?void 0:s.stack})}))},unbind(t,e,n){t!=null&&t.__galileo_bind_event&&t.removeEventListener("click",t.__galileo_bind_event)}}),q({name:"galileoExposureTracker"},{bind(t,e,n){ae&&Et(t)&&On({el:t,binding:e,vnode:n,type:"bind"})},update(t,e,n){!ae||!Et(t)||On({el:t,binding:e,vnode:n,type:"update"})},unbind(t){if(!ae||!t||!Et(t))return;const e=It();e==null||e.unobserve(t)}});const ja="__galileo_hoc_",qa=()=>yn(),je=t=>`${ja}${t}`,me=(t,e,...n)=>{const i=je(e),s=t[i];return pe(s)||console.error("[galileo-vue] no such method: ",i),s==null?void 0:s.apply(t,n)};function Ua(t,e,n){if(!ae)return t;const i=(n==null?void 0:n.Vue)||ie;if(!i)return t;const s=i.extend(t),{spm:a}=e,r=new Ea,l={info(...u){var v;const p=qa();(v=p==null?void 0:p.logger)==null||v.info(...u)}};return s.mixin({created(){if(!ae)return;const u="onPageView";r.subscribe(u,u,p=>{me(this,"onPageView",q({},p))});const v="onPageLeave";r.subscribe(v,v,p=>{me(this,"onPageLeave",q({},p))})},computed:{_g_isKeepAlive(){var u,v;return(v=(u=this.$vnode)==null?void 0:u.data)==null?void 0:v.keepAlive}},beforeMount(){l.info("beforeMount",e),this._g_isKeepAlive||me(this,"onPageView"),me(this,"bindEvent")},beforeDestroy(){ae&&(this._g_isKeepAlive||me(this,"onPageLeave"))},destroyed(){ae&&(l.info("destroyed",e),me(this,"unbindEvent"),me(this,"unsubInterceptor"))},activated(){ae&&(l.info("activated",e),me(this,"onPageView",{view_type:Ke.PAGE_OPEN}),me(this,"bindEvent"))},deactivated(){ae&&(l.info("deactivated",e),me(this,"onPageLeave",{leave_type:Ke.PAGE_CLOSE}),me(this,"unbindEvent"))},methods:{[je("onPageView")](u={}){We(v=>{v.track(Qe.Pageview,q(ge(q({},e),{view_type:Ke.PAGE_OPEN,spm:a,timestamp:Date.now()}),u))})},[je("onPageLeave")](u={}){We(v=>{v.track(Qe.Pageleave,q(ge(q({},e),{leave_type:Ke.PAGE_CLOSE,spm:a,timestamp:Date.now()}),u))})},[je("unsubInterceptor")](){},[je("unbindEvent")](){r.unbindEvents()},[je("bindEvent")](){r.bindEvents()}}}),s}var Ja=class{constructor(){M(this,"_onBeforeUnload");M(this,"_onPageHide");M(this,"_onPageShow");M(this,"_onVisibilityChange");M(this,"_onPageUnload");M(this,"_pageEvent");M(this,"_isInit",!1);M(this,"_options",{autoTrack:!0})}init(t){Object.assign(this._options,t),this.initCallback(),this._isInit||(this._isInit=!0,this.initTrackEvent())}getGalileo(){return window._galileo}setOption(t){Object.assign(this._options,t)}initTrackEvent(){const{_options:t}=this;t.autoTrack&&this.onDomReady(()=>{this.onPageView({view_type:"open"})})}onDomReady(t){document.readyState!=="loading"?t():window.addEventListener("DOMContentLoaded",t,!1)}initCallback(){var t;(t=this._pageEvent)==null||t.destroy(),this._pageEvent=new _i;const e="onPageView";this._pageEvent.subscribe(e,e,i=>{this.onPageView(L({},i))});const n="onPageLeave";this._pageEvent.subscribe(n,n,i=>{this.onPageLeave(L({},i))}),this._pageEvent.bindEvents()}onPageView(t={}){const e=this._options,n=e.spm,i=this.getGalileo();i==null||i.track("$WebPageView",L(he(L({},e),{view_type:"open",spm:n,timestamp:Date.now()}),t))}onPageLeave(t={}){const e=this._options,n=e.spm,i=this.getGalileo();i==null||i.track("$WebPageLeave",L(he(L({},e),{leave_type:"close",spm:n,timestamp:Date.now()}),t))}destroy(){var t;(t=this._pageEvent)==null||t.destroy()}};function Ha(t){const e=new Ja;return e.init(t),e}if(!window.Galileo){const t=new ua;t.PageTracker=Ua,t.createPageTracker=Ha,window.Galileo=t,window._galileo=t}var rt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function $a(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function lt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Pn={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(i,s,a){function r(v,p){if(!s[v]){if(!i[v]){var g=typeof lt=="function"&&lt;if(!p&&g)return g(v,!0);if(l)return l(v,!0);var m=new Error("Cannot find module '"+v+"'");throw m.code="MODULE_NOT_FOUND",m}var b=s[v]={exports:{}};i[v][0].call(b.exports,function(w){var x=i[v][1][w];return r(x||w)},b,b.exports,n,i,s,a)}return s[v].exports}for(var l=typeof lt=="function"&&lt,u=0;u<a.length;u++)r(a[u]);return r}({1:[function(n,i,s){(function(a){var r=a.MutationObserver||a.WebKitMutationObserver,l;if(r){var u=0,v=new r(w),p=a.document.createTextNode("");v.observe(p,{characterData:!0}),l=function(){p.data=u=++u%2}}else if(!a.setImmediate&&typeof a.MessageChannel!="undefined"){var g=new a.MessageChannel;g.port1.onmessage=w,l=function(){g.port2.postMessage(0)}}else"document"in a&&"onreadystatechange"in a.document.createElement("script")?l=function(){var O=a.document.createElement("script");O.onreadystatechange=function(){w(),O.onreadystatechange=null,O.parentNode.removeChild(O),O=null},a.document.documentElement.appendChild(O)}:l=function(){setTimeout(w,0)};var m,b=[];function w(){m=!0;for(var O,C,N=b.length;N;){for(C=b,b=[],O=-1;++O<N;)C[O]();N=b.length}m=!1}i.exports=x;function x(O){b.push(O)===1&&!m&&l()}}).call(this,typeof rt!="undefined"?rt:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],2:[function(n,i,s){var a=n(1);function r(){}var l={},u=["REJECTED"],v=["FULFILLED"],p=["PENDING"];i.exports=g;function g(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,E!==r&&x(this,E)}g.prototype.catch=function(E){return this.then(null,E)},g.prototype.then=function(E,A){if(typeof E!="function"&&this.state===v||typeof A!="function"&&this.state===u)return this;var T=new this.constructor(r);if(this.state!==p){var J=this.state===v?E:A;b(T,J,this.outcome)}else this.queue.push(new m(T,E,A));return T};function m(E,A,T){this.promise=E,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}m.prototype.callFulfilled=function(E){l.resolve(this.promise,E)},m.prototype.otherCallFulfilled=function(E){b(this.promise,this.onFulfilled,E)},m.prototype.callRejected=function(E){l.reject(this.promise,E)},m.prototype.otherCallRejected=function(E){b(this.promise,this.onRejected,E)};function b(E,A,T){a(function(){var J;try{J=A(T)}catch(F){return l.reject(E,F)}J===E?l.reject(E,new TypeError("Cannot resolve promise with itself")):l.resolve(E,J)})}l.resolve=function(E,A){var T=O(w,A);if(T.status==="error")return l.reject(E,T.value);var J=T.value;if(J)x(E,J);else{E.state=v,E.outcome=A;for(var F=-1,X=E.queue.length;++F<X;)E.queue[F].callFulfilled(A)}return E},l.reject=function(E,A){E.state=u,E.outcome=A;for(var T=-1,J=E.queue.length;++T<J;)E.queue[T].callRejected(A);return E};function w(E){var A=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof A=="function")return function(){A.apply(E,arguments)}}function x(E,A){var T=!1;function J(le){T||(T=!0,l.reject(E,le))}function F(le){T||(T=!0,l.resolve(E,le))}function X(){A(F,J)}var re=O(X);re.status==="error"&&J(re.value)}function O(E,A){var T={};try{T.value=E(A),T.status="success"}catch(J){T.status="error",T.value=J}return T}g.resolve=C;function C(E){return E instanceof this?E:l.resolve(new this(r),E)}g.reject=N;function N(E){var A=new this(r);return l.reject(A,E)}g.all=te;function te(E){var A=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=E.length,J=!1;if(!T)return this.resolve([]);for(var F=new Array(T),X=0,re=-1,le=new this(r);++re<T;)_e(E[re],re);return le;function _e(Pe,Ae){A.resolve(Pe).then(qe,function(be){J||(J=!0,l.reject(le,be))});function qe(be){F[Ae]=be,++X===T&&!J&&(J=!0,l.resolve(le,F))}}}g.race=B;function B(E){var A=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=E.length,J=!1;if(!T)return this.resolve([]);for(var F=-1,X=new this(r);++F<T;)re(E[F]);return X;function re(le){A.resolve(le).then(function(_e){J||(J=!0,l.resolve(X,_e))},function(_e){J||(J=!0,l.reject(X,_e))})}}},{1:1}],3:[function(n,i,s){(function(a){typeof a.Promise!="function"&&(a.Promise=n(2))}).call(this,typeof rt!="undefined"?rt:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{2:2}],4:[function(n,i,s){var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};function r(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")}function l(){try{if(typeof indexedDB!="undefined")return indexedDB;if(typeof webkitIndexedDB!="undefined")return webkitIndexedDB;if(typeof mozIndexedDB!="undefined")return mozIndexedDB;if(typeof OIndexedDB!="undefined")return OIndexedDB;if(typeof msIndexedDB!="undefined")return msIndexedDB}catch(o){return}}var u=l();function v(){try{if(!u||!u.open)return!1;var o=typeof openDatabase!="undefined"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),h=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!o||h)&&typeof indexedDB!="undefined"&&typeof IDBKeyRange!="undefined"}catch(c){return!1}}function p(o,h){o=o||[],h=h||{};try{return new Blob(o,h)}catch(d){if(d.name!=="TypeError")throw d;for(var c=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,f=new c,_=0;_<o.length;_+=1)f.append(o[_]);return f.getBlob(h.type)}}typeof Promise=="undefined"&&n(3);var g=Promise;function m(o,h){h&&o.then(function(c){h(null,c)},function(c){h(c)})}function b(o,h,c){typeof h=="function"&&o.then(h),typeof c=="function"&&o.catch(c)}function w(o){return typeof o!="string"&&(console.warn(o+" used as a key, but it is not a string."),o=String(o)),o}function x(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var O="local-forage-detect-blob-support",C=void 0,N={},te=Object.prototype.toString,B="readonly",E="readwrite";function A(o){for(var h=o.length,c=new ArrayBuffer(h),f=new Uint8Array(c),_=0;_<h;_++)f[_]=o.charCodeAt(_);return c}function T(o){return new g(function(h){var c=o.transaction(O,E),f=p([""]);c.objectStore(O).put(f,"key"),c.onabort=function(_){_.preventDefault(),_.stopPropagation(),h(!1)},c.oncomplete=function(){var _=navigator.userAgent.match(/Chrome\/(\d+)/),d=navigator.userAgent.match(/Edge\//);h(d||!_||parseInt(_[1],10)>=43)}}).catch(function(){return!1})}function J(o){return typeof C=="boolean"?g.resolve(C):T(o).then(function(h){return C=h,C})}function F(o){var h=N[o.name],c={};c.promise=new g(function(f,_){c.resolve=f,c.reject=_}),h.deferredOperations.push(c),h.dbReady?h.dbReady=h.dbReady.then(function(){return c.promise}):h.dbReady=c.promise}function X(o){var h=N[o.name],c=h.deferredOperations.pop();if(c)return c.resolve(),c.promise}function re(o,h){var c=N[o.name],f=c.deferredOperations.pop();if(f)return f.reject(h),f.promise}function le(o,h){return new g(function(c,f){if(N[o.name]=N[o.name]||Cn(),o.db)if(h)F(o),o.db.close();else return c(o.db);var _=[o.name];h&&_.push(o.version);var d=u.open.apply(u,_);h&&(d.onupgradeneeded=function(y){var S=d.result;try{S.createObjectStore(o.storeName),y.oldVersion<=1&&S.createObjectStore(O)}catch(k){if(k.name==="ConstraintError")console.warn('The database "'+o.name+'" has been upgraded from version '+y.oldVersion+" to version "+y.newVersion+', but the storage "'+o.storeName+'" already exists.');else throw k}}),d.onerror=function(y){y.preventDefault(),f(d.error)},d.onsuccess=function(){var y=d.result;y.onversionchange=function(S){S.target.close()},c(y),X(o)}})}function _e(o){return le(o,!1)}function Pe(o){return le(o,!0)}function Ae(o,h){if(!o.db)return!0;var c=!o.db.objectStoreNames.contains(o.storeName),f=o.version<o.db.version,_=o.version>o.db.version;if(f&&(o.version!==h&&console.warn('The database "'+o.name+`" can't be downgraded from version `+o.db.version+" to version "+o.version+"."),o.version=o.db.version),_||c){if(c){var d=o.db.version+1;d>o.version&&(o.version=d)}return!0}return!1}function qe(o){return new g(function(h,c){var f=new FileReader;f.onerror=c,f.onloadend=function(_){var d=btoa(_.target.result||"");h({__local_forage_encoded_blob:!0,data:d,type:o.type})},f.readAsBinaryString(o)})}function be(o){var h=A(atob(o.data));return p([h],{type:o.type})}function ze(o){return o&&o.__local_forage_encoded_blob}function Fa(o){var h=this,c=h._initReady().then(function(){var f=N[h._dbInfo.name];if(f&&f.dbReady)return f.dbReady});return b(c,o,o),c}function Wa(o){F(o);for(var h=N[o.name],c=h.forages,f=0;f<c.length;f++){var _=c[f];_._dbInfo.db&&(_._dbInfo.db.close(),_._dbInfo.db=null)}return o.db=null,_e(o).then(function(d){return o.db=d,Ae(o)?Pe(o):d}).then(function(d){o.db=h.db=d;for(var y=0;y<c.length;y++)c[y]._dbInfo.db=d}).catch(function(d){throw re(o,d),d})}function we(o,h,c,f){f===void 0&&(f=1);try{var _=o.db.transaction(o.storeName,h);c(null,_)}catch(d){if(f>0&&(!o.db||d.name==="InvalidStateError"||d.name==="NotFoundError"))return g.resolve().then(function(){if(!o.db||d.name==="NotFoundError"&&!o.db.objectStoreNames.contains(o.storeName)&&o.version<=o.db.version)return o.db&&(o.version=o.db.version+1),Pe(o)}).then(function(){return Wa(o).then(function(){we(o,h,c,f-1)})}).catch(c);c(d)}}function Cn(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Ga(o){var h=this,c={db:null};if(o)for(var f in o)c[f]=o[f];var _=N[c.name];_||(_=Cn(),N[c.name]=_),_.forages.push(h),h._initReady||(h._initReady=h.ready,h.ready=Fa);var d=[];function y(){return g.resolve()}for(var S=0;S<_.forages.length;S++){var k=_.forages[S];k!==h&&d.push(k._initReady().catch(y))}var I=_.forages.slice(0);return g.all(d).then(function(){return c.db=_.db,_e(c)}).then(function(P){return c.db=P,Ae(c,h._defaultConfig.version)?Pe(c):P}).then(function(P){c.db=_.db=P,h._dbInfo=c;for(var D=0;D<I.length;D++){var U=I[D];U!==h&&(U._dbInfo.db=c.db,U._dbInfo.version=c.version)}})}function Ka(o,h){var c=this;o=w(o);var f=new g(function(_,d){c.ready().then(function(){we(c._dbInfo,B,function(y,S){if(y)return d(y);try{var k=S.objectStore(c._dbInfo.storeName),I=k.get(o);I.onsuccess=function(){var P=I.result;P===void 0&&(P=null),ze(P)&&(P=be(P)),_(P)},I.onerror=function(){d(I.error)}}catch(P){d(P)}})}).catch(d)});return m(f,h),f}function Qa(o,h){var c=this,f=new g(function(_,d){c.ready().then(function(){we(c._dbInfo,B,function(y,S){if(y)return d(y);try{var k=S.objectStore(c._dbInfo.storeName),I=k.openCursor(),P=1;I.onsuccess=function(){var D=I.result;if(D){var U=D.value;ze(U)&&(U=be(U));var H=o(U,D.key,P++);H!==void 0?_(H):D.continue()}else _()},I.onerror=function(){d(I.error)}}catch(D){d(D)}})}).catch(d)});return m(f,h),f}function za(o,h,c){var f=this;o=w(o);var _=new g(function(d,y){var S;f.ready().then(function(){return S=f._dbInfo,te.call(h)==="[object Blob]"?J(S.db).then(function(k){return k?h:qe(h)}):h}).then(function(k){we(f._dbInfo,E,function(I,P){if(I)return y(I);try{var D=P.objectStore(f._dbInfo.storeName);k===null&&(k=void 0);var U=D.put(k,o);P.oncomplete=function(){k===void 0&&(k=null),d(k)},P.onabort=P.onerror=function(){var H=U.error?U.error:U.transaction.error;y(H)}}catch(H){y(H)}})}).catch(y)});return m(_,c),_}function Ya(o,h){var c=this;o=w(o);var f=new g(function(_,d){c.ready().then(function(){we(c._dbInfo,E,function(y,S){if(y)return d(y);try{var k=S.objectStore(c._dbInfo.storeName),I=k.delete(o);S.oncomplete=function(){_()},S.onerror=function(){d(I.error)},S.onabort=function(){var P=I.error?I.error:I.transaction.error;d(P)}}catch(P){d(P)}})}).catch(d)});return m(f,h),f}function Xa(o){var h=this,c=new g(function(f,_){h.ready().then(function(){we(h._dbInfo,E,function(d,y){if(d)return _(d);try{var S=y.objectStore(h._dbInfo.storeName),k=S.clear();y.oncomplete=function(){f()},y.onabort=y.onerror=function(){var I=k.error?k.error:k.transaction.error;_(I)}}catch(I){_(I)}})}).catch(_)});return m(c,o),c}function Za(o){var h=this,c=new g(function(f,_){h.ready().then(function(){we(h._dbInfo,B,function(d,y){if(d)return _(d);try{var S=y.objectStore(h._dbInfo.storeName),k=S.count();k.onsuccess=function(){f(k.result)},k.onerror=function(){_(k.error)}}catch(I){_(I)}})}).catch(_)});return m(c,o),c}function eo(o,h){var c=this,f=new g(function(_,d){if(o<0){_(null);return}c.ready().then(function(){we(c._dbInfo,B,function(y,S){if(y)return d(y);try{var k=S.objectStore(c._dbInfo.storeName),I=!1,P=k.openKeyCursor();P.onsuccess=function(){var D=P.result;if(!D){_(null);return}o===0||I?_(D.key):(I=!0,D.advance(o))},P.onerror=function(){d(P.error)}}catch(D){d(D)}})}).catch(d)});return m(f,h),f}function to(o){var h=this,c=new g(function(f,_){h.ready().then(function(){we(h._dbInfo,B,function(d,y){if(d)return _(d);try{var S=y.objectStore(h._dbInfo.storeName),k=S.openKeyCursor(),I=[];k.onsuccess=function(){var P=k.result;if(!P){f(I);return}I.push(P.key),P.continue()},k.onerror=function(){_(k.error)}}catch(P){_(P)}})}).catch(_)});return m(c,o),c}function no(o,h){h=x.apply(this,arguments);var c=this.config();o=typeof o!="function"&&o||{},o.name||(o.name=o.name||c.name,o.storeName=o.storeName||c.storeName);var f=this,_;if(!o.name)_=g.reject("Invalid arguments");else{var d=o.name===c.name&&f._dbInfo.db,y=d?g.resolve(f._dbInfo.db):_e(o).then(function(S){var k=N[o.name],I=k.forages;k.db=S;for(var P=0;P<I.length;P++)I[P]._dbInfo.db=S;return S});o.storeName?_=y.then(function(S){if(S.objectStoreNames.contains(o.storeName)){var k=S.version+1;F(o);var I=N[o.name],P=I.forages;S.close();for(var D=0;D<P.length;D++){var U=P[D];U._dbInfo.db=null,U._dbInfo.version=k}var H=new g(function(W,ne){var Z=u.open(o.name,k);Z.onerror=function(ve){var Xe=Z.result;Xe.close(),ne(ve)},Z.onupgradeneeded=function(){var ve=Z.result;ve.deleteObjectStore(o.storeName)},Z.onsuccess=function(){var ve=Z.result;ve.close(),W(ve)}});return H.then(function(W){I.db=W;for(var ne=0;ne<P.length;ne++){var Z=P[ne];Z._dbInfo.db=W,X(Z._dbInfo)}}).catch(function(W){throw(re(o,W)||g.resolve()).catch(function(){}),W})}}):_=y.then(function(S){F(o);var k=N[o.name],I=k.forages;S.close();for(var P=0;P<I.length;P++){var D=I[P];D._dbInfo.db=null}var U=new g(function(H,W){var ne=u.deleteDatabase(o.name);ne.onerror=function(){var Z=ne.result;Z&&Z.close(),W(ne.error)},ne.onblocked=function(){console.warn('dropInstance blocked for database "'+o.name+'" until all open connections are closed')},ne.onsuccess=function(){var Z=ne.result;Z&&Z.close(),H(Z)}});return U.then(function(H){k.db=H;for(var W=0;W<I.length;W++){var ne=I[W];X(ne._dbInfo)}}).catch(function(H){throw(re(o,H)||g.resolve()).catch(function(){}),H})})}return m(_,h),_}var io={_driver:"asyncStorage",_initStorage:Ga,_support:v(),iterate:Qa,getItem:Ka,setItem:za,removeItem:Ya,clear:Xa,length:Za,key:eo,keys:to,dropInstance:no};function so(){return typeof openDatabase=="function"}var xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ao="~~local_forage_type~",Nn=/^~~local_forage_type~([^~]+)~/,ct="__lfsc__:",Pt=ct.length,xt="arbf",Ct="blob",Dn="si08",Ln="ui08",Tn="uic8",An="si16",Rn="si32",Bn="ur16",Mn="ui32",jn="fl32",qn="fl64",Un=Pt+xt.length,Jn=Object.prototype.toString;function Hn(o){var h=o.length*.75,c=o.length,f,_=0,d,y,S,k;o[o.length-1]==="="&&(h--,o[o.length-2]==="="&&h--);var I=new ArrayBuffer(h),P=new Uint8Array(I);for(f=0;f<c;f+=4)d=xe.indexOf(o[f]),y=xe.indexOf(o[f+1]),S=xe.indexOf(o[f+2]),k=xe.indexOf(o[f+3]),P[_++]=d<<2|y>>4,P[_++]=(y&15)<<4|S>>2,P[_++]=(S&3)<<6|k&63;return I}function Nt(o){var h=new Uint8Array(o),c="",f;for(f=0;f<h.length;f+=3)c+=xe[h[f]>>2],c+=xe[(h[f]&3)<<4|h[f+1]>>4],c+=xe[(h[f+1]&15)<<2|h[f+2]>>6],c+=xe[h[f+2]&63];return h.length%3===2?c=c.substring(0,c.length-1)+"=":h.length%3===1&&(c=c.substring(0,c.length-2)+"=="),c}function oo(o,h){var c="";if(o&&(c=Jn.call(o)),o&&(c==="[object ArrayBuffer]"||o.buffer&&Jn.call(o.buffer)==="[object ArrayBuffer]")){var f,_=ct;o instanceof ArrayBuffer?(f=o,_+=xt):(f=o.buffer,c==="[object Int8Array]"?_+=Dn:c==="[object Uint8Array]"?_+=Ln:c==="[object Uint8ClampedArray]"?_+=Tn:c==="[object Int16Array]"?_+=An:c==="[object Uint16Array]"?_+=Bn:c==="[object Int32Array]"?_+=Rn:c==="[object Uint32Array]"?_+=Mn:c==="[object Float32Array]"?_+=jn:c==="[object Float64Array]"?_+=qn:h(new Error("Failed to get type for BinaryArray"))),h(_+Nt(f))}else if(c==="[object Blob]"){var d=new FileReader;d.onload=function(){var y=ao+o.type+"~"+Nt(this.result);h(ct+Ct+y)},d.readAsArrayBuffer(o)}else try{h(JSON.stringify(o))}catch(y){console.error("Couldn't convert value into a JSON string: ",o),h(null,y)}}function ro(o){if(o.substring(0,Pt)!==ct)return JSON.parse(o);var h=o.substring(Un),c=o.substring(Pt,Un),f;if(c===Ct&&Nn.test(h)){var _=h.match(Nn);f=_[1],h=h.substring(_[0].length)}var d=Hn(h);switch(c){case xt:return d;case Ct:return p([d],{type:f});case Dn:return new Int8Array(d);case Ln:return new Uint8Array(d);case Tn:return new Uint8ClampedArray(d);case An:return new Int16Array(d);case Bn:return new Uint16Array(d);case Rn:return new Int32Array(d);case Mn:return new Uint32Array(d);case jn:return new Float32Array(d);case qn:return new Float64Array(d);default:throw new Error("Unkown type: "+c)}}var Dt={serialize:oo,deserialize:ro,stringToBuffer:Hn,bufferToString:Nt};function $n(o,h,c,f){o.executeSql("CREATE TABLE IF NOT EXISTS "+h.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],c,f)}function lo(o){var h=this,c={db:null};if(o)for(var f in o)c[f]=typeof o[f]!="string"?o[f].toString():o[f];var _=new g(function(d,y){try{c.db=openDatabase(c.name,String(c.version),c.description,c.size)}catch(S){return y(S)}c.db.transaction(function(S){$n(S,c,function(){h._dbInfo=c,d()},function(k,I){y(I)})},y)});return c.serializer=Dt,_}function Ce(o,h,c,f,_,d){o.executeSql(c,f,_,function(y,S){S.code===S.SYNTAX_ERR?y.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[h.storeName],function(k,I){I.rows.length?d(k,S):$n(k,h,function(){k.executeSql(c,f,_,d)},d)},d):d(y,S)},d)}function co(o,h){var c=this;o=w(o);var f=new g(function(_,d){c.ready().then(function(){var y=c._dbInfo;y.db.transaction(function(S){Ce(S,y,"SELECT * FROM "+y.storeName+" WHERE key = ? LIMIT 1",[o],function(k,I){var P=I.rows.length?I.rows.item(0).value:null;P&&(P=y.serializer.deserialize(P)),_(P)},function(k,I){d(I)})})}).catch(d)});return m(f,h),f}function uo(o,h){var c=this,f=new g(function(_,d){c.ready().then(function(){var y=c._dbInfo;y.db.transaction(function(S){Ce(S,y,"SELECT * FROM "+y.storeName,[],function(k,I){for(var P=I.rows,D=P.length,U=0;U<D;U++){var H=P.item(U),W=H.value;if(W&&(W=y.serializer.deserialize(W)),W=o(W,H.key,U+1),W!==void 0){_(W);return}}_()},function(k,I){d(I)})})}).catch(d)});return m(f,h),f}function Vn(o,h,c,f){var _=this;o=w(o);var d=new g(function(y,S){_.ready().then(function(){h===void 0&&(h=null);var k=h,I=_._dbInfo;I.serializer.serialize(h,function(P,D){D?S(D):I.db.transaction(function(U){Ce(U,I,"INSERT OR REPLACE INTO "+I.storeName+" (key, value) VALUES (?, ?)",[o,P],function(){y(k)},function(H,W){S(W)})},function(U){if(U.code===U.QUOTA_ERR){if(f>0){y(Vn.apply(_,[o,k,c,f-1]));return}S(U)}})})}).catch(S)});return m(d,c),d}function ho(o,h,c){return Vn.apply(this,[o,h,c,1])}function fo(o,h){var c=this;o=w(o);var f=new g(function(_,d){c.ready().then(function(){var y=c._dbInfo;y.db.transaction(function(S){Ce(S,y,"DELETE FROM "+y.storeName+" WHERE key = ?",[o],function(){_()},function(k,I){d(I)})})}).catch(d)});return m(f,h),f}function go(o){var h=this,c=new g(function(f,_){h.ready().then(function(){var d=h._dbInfo;d.db.transaction(function(y){Ce(y,d,"DELETE FROM "+d.storeName,[],function(){f()},function(S,k){_(k)})})}).catch(_)});return m(c,o),c}function _o(o){var h=this,c=new g(function(f,_){h.ready().then(function(){var d=h._dbInfo;d.db.transaction(function(y){Ce(y,d,"SELECT COUNT(key) as c FROM "+d.storeName,[],function(S,k){var I=k.rows.item(0).c;f(I)},function(S,k){_(k)})})}).catch(_)});return m(c,o),c}function vo(o,h){var c=this,f=new g(function(_,d){c.ready().then(function(){var y=c._dbInfo;y.db.transaction(function(S){Ce(S,y,"SELECT key FROM "+y.storeName+" WHERE id = ? LIMIT 1",[o+1],function(k,I){var P=I.rows.length?I.rows.item(0).key:null;_(P)},function(k,I){d(I)})})}).catch(d)});return m(f,h),f}function mo(o){var h=this,c=new g(function(f,_){h.ready().then(function(){var d=h._dbInfo;d.db.transaction(function(y){Ce(y,d,"SELECT key FROM "+d.storeName,[],function(S,k){for(var I=[],P=0;P<k.rows.length;P++)I.push(k.rows.item(P).key);f(I)},function(S,k){_(k)})})}).catch(_)});return m(c,o),c}function po(o){return new g(function(h,c){o.transaction(function(f){f.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(_,d){for(var y=[],S=0;S<d.rows.length;S++)y.push(d.rows.item(S).name);h({db:o,storeNames:y})},function(_,d){c(d)})},function(f){c(f)})})}function yo(o,h){h=x.apply(this,arguments);var c=this.config();o=typeof o!="function"&&o||{},o.name||(o.name=o.name||c.name,o.storeName=o.storeName||c.storeName);var f=this,_;return o.name?_=new g(function(d){var y;o.name===c.name?y=f._dbInfo.db:y=openDatabase(o.name,"","",0),o.storeName?d({db:y,storeNames:[o.storeName]}):d(po(y))}).then(function(d){return new g(function(y,S){d.db.transaction(function(k){function I(H){return new g(function(W,ne){k.executeSql("DROP TABLE IF EXISTS "+H,[],function(){W()},function(Z,ve){ne(ve)})})}for(var P=[],D=0,U=d.storeNames.length;D<U;D++)P.push(I(d.storeNames[D]));g.all(P).then(function(){y()}).catch(function(H){S(H)})},function(k){S(k)})})}):_=g.reject("Invalid arguments"),m(_,h),_}var bo={_driver:"webSQLStorage",_initStorage:lo,_support:so(),iterate:uo,getItem:co,setItem:ho,removeItem:fo,clear:go,length:_o,key:vo,keys:mo,dropInstance:yo};function wo(){try{return typeof localStorage!="undefined"&&"setItem"in localStorage&&!!localStorage.setItem}catch(o){return!1}}function Fn(o,h){var c=o.name+"/";return o.storeName!==h.storeName&&(c+=o.storeName+"/"),c}function So(){var o="_localforage_support_test";try{return localStorage.setItem(o,!0),localStorage.removeItem(o),!1}catch(h){return!0}}function Oo(){return!So()||localStorage.length>0}function Eo(o){var h=this,c={};if(o)for(var f in o)c[f]=o[f];return c.keyPrefix=Fn(o,h._defaultConfig),Oo()?(h._dbInfo=c,c.serializer=Dt,g.resolve()):g.reject()}function ko(o){var h=this,c=h.ready().then(function(){for(var f=h._dbInfo.keyPrefix,_=localStorage.length-1;_>=0;_--){var d=localStorage.key(_);d.indexOf(f)===0&&localStorage.removeItem(d)}});return m(c,o),c}function Io(o,h){var c=this;o=w(o);var f=c.ready().then(function(){var _=c._dbInfo,d=localStorage.getItem(_.keyPrefix+o);return d&&(d=_.serializer.deserialize(d)),d});return m(f,h),f}function Po(o,h){var c=this,f=c.ready().then(function(){for(var _=c._dbInfo,d=_.keyPrefix,y=d.length,S=localStorage.length,k=1,I=0;I<S;I++){var P=localStorage.key(I);if(P.indexOf(d)===0){var D=localStorage.getItem(P);if(D&&(D=_.serializer.deserialize(D)),D=o(D,P.substring(y),k++),D!==void 0)return D}}});return m(f,h),f}function xo(o,h){var c=this,f=c.ready().then(function(){var _=c._dbInfo,d;try{d=localStorage.key(o)}catch(y){d=null}return d&&(d=d.substring(_.keyPrefix.length)),d});return m(f,h),f}function Co(o){var h=this,c=h.ready().then(function(){for(var f=h._dbInfo,_=localStorage.length,d=[],y=0;y<_;y++){var S=localStorage.key(y);S.indexOf(f.keyPrefix)===0&&d.push(S.substring(f.keyPrefix.length))}return d});return m(c,o),c}function No(o){var h=this,c=h.keys().then(function(f){return f.length});return m(c,o),c}function Do(o,h){var c=this;o=w(o);var f=c.ready().then(function(){var _=c._dbInfo;localStorage.removeItem(_.keyPrefix+o)});return m(f,h),f}function Lo(o,h,c){var f=this;o=w(o);var _=f.ready().then(function(){h===void 0&&(h=null);var d=h;return new g(function(y,S){var k=f._dbInfo;k.serializer.serialize(h,function(I,P){if(P)S(P);else try{localStorage.setItem(k.keyPrefix+o,I),y(d)}catch(D){(D.name==="QuotaExceededError"||D.name==="NS_ERROR_DOM_QUOTA_REACHED")&&S(D),S(D)}})})});return m(_,c),_}function To(o,h){if(h=x.apply(this,arguments),o=typeof o!="function"&&o||{},!o.name){var c=this.config();o.name=o.name||c.name,o.storeName=o.storeName||c.storeName}var f=this,_;return o.name?_=new g(function(d){o.storeName?d(Fn(o,f._defaultConfig)):d(o.name+"/")}).then(function(d){for(var y=localStorage.length-1;y>=0;y--){var S=localStorage.key(y);S.indexOf(d)===0&&localStorage.removeItem(S)}}):_=g.reject("Invalid arguments"),m(_,h),_}var Ao={_driver:"localStorageWrapper",_initStorage:Eo,_support:wo(),iterate:Po,getItem:Io,setItem:Lo,removeItem:Do,clear:ko,length:No,key:xo,keys:Co,dropInstance:To},Ro=function(h,c){return h===c||typeof h=="number"&&typeof c=="number"&&isNaN(h)&&isNaN(c)},Bo=function(h,c){for(var f=h.length,_=0;_<f;){if(Ro(h[_],c))return!0;_++}return!1},Wn=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"},Ye={},Gn={},Ue={INDEXEDDB:io,WEBSQL:bo,LOCALSTORAGE:Ao},Mo=[Ue.INDEXEDDB._driver,Ue.WEBSQL._driver,Ue.LOCALSTORAGE._driver],ut=["dropInstance"],Lt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ut),jo={description:"",driver:Mo.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function qo(o,h){o[h]=function(){var c=arguments;return o.ready().then(function(){return o[h].apply(o,c)})}}function Tt(){for(var o=1;o<arguments.length;o++){var h=arguments[o];if(h)for(var c in h)h.hasOwnProperty(c)&&(Wn(h[c])?arguments[0][c]=h[c].slice():arguments[0][c]=h[c])}return arguments[0]}var Uo=function(){function o(h){r(this,o);for(var c in Ue)if(Ue.hasOwnProperty(c)){var f=Ue[c],_=f._driver;this[c]=_,Ye[_]||this.defineDriver(f)}this._defaultConfig=Tt({},jo),this._config=Tt({},this._defaultConfig,h),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return o.prototype.config=function(c){if((typeof c=="undefined"?"undefined":a(c))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var f in c){if(f==="storeName"&&(c[f]=c[f].replace(/\W/g,"_")),f==="version"&&typeof c[f]!="number")return new Error("Database version must be a number.");this._config[f]=c[f]}return"driver"in c&&c.driver?this.setDriver(this._config.driver):!0}else return typeof c=="string"?this._config[c]:this._config},o.prototype.defineDriver=function(c,f,_){var d=new g(function(y,S){try{var k=c._driver,I=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!c._driver){S(I);return}for(var P=Lt.concat("_initStorage"),D=0,U=P.length;D<U;D++){var H=P[D],W=!Bo(ut,H);if((W||c[H])&&typeof c[H]!="function"){S(I);return}}var ne=function(){for(var Xe=function($o){return function(){var Vo=new Error("Method "+$o+" is not implemented by the current driver"),Kn=g.reject(Vo);return m(Kn,arguments[arguments.length-1]),Kn}},At=0,Ho=ut.length;At<Ho;At++){var Rt=ut[At];c[Rt]||(c[Rt]=Xe(Rt))}};ne();var Z=function(Xe){Ye[k]&&console.info("Redefining LocalForage driver: "+k),Ye[k]=c,Gn[k]=Xe,y()};"_support"in c?c._support&&typeof c._support=="function"?c._support().then(Z,S):Z(!!c._support):Z(!0)}catch(ve){S(ve)}});return b(d,f,_),d},o.prototype.driver=function(){return this._driver||null},o.prototype.getDriver=function(c,f,_){var d=Ye[c]?g.resolve(Ye[c]):g.reject(new Error("Driver not found."));return b(d,f,_),d},o.prototype.getSerializer=function(c){var f=g.resolve(Dt);return b(f,c),f},o.prototype.ready=function(c){var f=this,_=f._driverSet.then(function(){return f._ready===null&&(f._ready=f._initDriver()),f._ready});return b(_,c,c),_},o.prototype.setDriver=function(c,f,_){var d=this;Wn(c)||(c=[c]);var y=this._getSupportedDrivers(c);function S(){d._config.driver=d.driver()}function k(D){return d._extend(D),S(),d._ready=d._initStorage(d._config),d._ready}function I(D){return function(){var U=0;function H(){for(;U<D.length;){var W=D[U];return U++,d._dbInfo=null,d._ready=null,d.getDriver(W).then(k).catch(H)}S();var ne=new Error("No available storage method found.");return d._driverSet=g.reject(ne),d._driverSet}return H()}}var P=this._driverSet!==null?this._driverSet.catch(function(){return g.resolve()}):g.resolve();return this._driverSet=P.then(function(){var D=y[0];return d._dbInfo=null,d._ready=null,d.getDriver(D).then(function(U){d._driver=U._driver,S(),d._wrapLibraryMethodsWithReady(),d._initDriver=I(y)})}).catch(function(){S();var D=new Error("No available storage method found.");return d._driverSet=g.reject(D),d._driverSet}),b(this._driverSet,f,_),this._driverSet},o.prototype.supports=function(c){return!!Gn[c]},o.prototype._extend=function(c){Tt(this,c)},o.prototype._getSupportedDrivers=function(c){for(var f=[],_=0,d=c.length;_<d;_++){var y=c[_];this.supports(y)&&f.push(y)}return f},o.prototype._wrapLibraryMethodsWithReady=function(){for(var c=0,f=Lt.length;c<f;c++)qo(this,Lt[c])},o.prototype.createInstance=function(c){return new o(c)},o}(),Jo=new Uo;i.exports=Jo},{3:3}]},{},[4])(4)})})(Pn);var xn=Pn.exports;const Va=Q({__proto__:null,default:$a(xn)},[xn])});
