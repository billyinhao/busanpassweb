"use strict";(self.webpackChunkklook_ssr_user_center=self.webpackChunkklook_ssr_user_center||[]).push([["8937"],{98248:function(t,e,o){o.d(e,{Z:()=>l});var i=o("28395"),s=o("79999");class n extends s.Vue{}let a=n=(0,i.gn)([s.Component],n),l=(0,o("77427").Z)(a,function(){var t=this.$createElement;return(this._self._c||t)("p",{staticClass:"skeleton-section skeleton-section--active"})},[],!1,null,null,null).exports},85649:function(t,e,o){o.r(e),o.d(e,{default:()=>U});var i=o("61292"),s=o("28395"),n=o("79999"),a=o("27546");class l extends n.Vue{}(0,s.gn)([(0,n.Prop)({type:Array,default:()=>[]})],l.prototype,"purchasedArray",void 0);let r=l=(0,s.gn)([(0,n.Component)({components:{RecentlyPurchaseCard:a.Z}})],l);var c=o("77427");let p=(0,c.Z)(r,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"recently-purchase"},[o("p",{staticClass:"recently-purchase-title"},[t._v(t._s(t.$t("recently_purchase_title_booking_list")))]),o("div",{staticClass:"recently-purchase-content"},t._l(t.purchasedArray,function(e,i){return o("span",{key:e.id,staticClass:"recently-purchase_card",class:{"recently-purchase_card--little":1===t.purchasedArray.length},attrs:{"data-spm-module":"RecentlyPurchased_LIST?oid=activity_"+e.id+"&idx="+i+"&len="+t.purchasedArray.length}},[o("recently-purchase-card",{attrs:{"purchased-data":e}})],1)}),0)])},[],!1,null,null,null).exports;var d=o("39919"),g=o("41185");o("18382");var _=o("17270"),u=o("17776");let m=(0,n.namespace)("auth"),k=(0,n.namespace)("traveller/booking-list");class h extends u.Z{refreshList(t){t&&this.setListType(t),this.$emit("fetch-order-list")}handleViewAppVoucher(){this.$message.confirm({content:this.$t("global.nav.appdownload.title2",[this.coupon.code||"",this.coupon.amount||""]),btnYes:this.$t("tw_bus_install"),btnNo:this.$t("global.tips.cancelTxt")},t=>{if(t){let t=`${this.$getOneLinkPrefix({linkId:4})}&pid=System_Email&c=Voucher_Email&af_dp=klook%3A%2F%2Fbookings&af_web_dp=https%3A%2F%2Fwww.klook.com%2F`;window.open(t)}})}async handleCardClick(t,e){if(t&&t.includes(".pdf")&&!this.klook.isOpenHarmony&&this.klook.isKlookApp&&!this.klook.isIOS&&this.isLimitedAccess)try{let{default:e}=await o.e("44093").then(o.bind(o,79720));return e.call("platform.openPdf",t)}catch{}this.handleJumpTo(t,e)}showTipInfoMethod(t){if(t){let{title:e="",content:o="",operation:i=""}=t;this.$message.alert({title:e,content:o,btnYes:i})}}}(0,s.gn)([m.State],h.prototype,"isLimitedAccess",void 0),(0,s.gn)([n.State],h.prototype,"klook",void 0),(0,s.gn)([k.State],h.prototype,"coupon",void 0);let v=h=(0,s.gn)([n.Component],h),y=(0,c.Z)(v,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{"data-spm-module":"BookingDetailCard?oid=booking_"+t.bookingItem.booking_reference_no+"&ext="+JSON.stringify({BookingType:t.listType,booking_status:t.bookingItem.status.track_status})}},[o("div",{directives:[{name:"galileo-click-tracker",rawName:"v-galileo-click-tracker.exposure",value:t.galileoBookingCard,expression:"galileoBookingCard",modifiers:{exposure:!0}}],staticClass:"booking-card",attrs:{"data-spm-item":"__default?typ=entry"},on:{click:function(e){return t.handleCardClick(t.bookingItem.booking_detail_deep_link,t.bookingItem.booking_detail_action)}}},[t.bookingItem.operation_status&&t.bookingItem.operation_status.is_stick?o("topping-sign"):t._e(),o("div",{staticClass:"booking-card-detail"},[o("section",{staticClass:"booking-card-detail_icon",class:{cancel:t.isCanceled}},[o("img",{attrs:{src:t.bookingItem.icon_img_url,alt:"业务图标"}})]),o("section",{staticClass:"booking-card-detail_wrapper"},[o("p",{staticClass:"booking-card-detail_title",class:{cancel:t.isCanceled}},[t._v(" "+t._s(t.bookingItem.activity_name)+" ")]),o("section",{staticClass:"booking-card-detail_content",class:{cancel:t.isCanceled}},[o("div",{staticClass:"booking-card-detail_desc"},[t.bookingItem.booking_summary&&t.bookingItem.booking_summary.length>0?t._l(t.bookingItem.booking_summary,function(e,i){return o("p",{key:i},[t._v(" "+t._s(e)+" ")])}):t._e(),t.bookingItem.price_info?o("p",{staticClass:"booking-card-detail_price",class:{cancel:t.isCanceled}},[t._v(" "+t._s(t.bookingItem.price_info.amount_desc)+" ")]):t._e()],2),t.bookingItem.activity_img_url?o("KlookImage",{staticClass:"booking-card-detail_image",attrs:{src:t.bookingItem.activity_img_url,"is-lazy":!0,mode:"divbg",scene:"product_medium",ratio:"1:1"}}):t._e()],1),t.bookingItem.status&&t.bookingItem.status.status_text?o("p",{staticClass:"booking-card-detail_status",class:{cancel:t.isCanceled},style:{color:t.bookingItem.status.status_text_color}},[t._v(" "+t._s(t.bookingItem.status.status_text)+" "),t.bookingItem.payment_deadline?o("count-down",{attrs:{type:2,"time-class":"count-down","end-time":new Date(t.bookingItem.payment_deadline).getTime()/1e3},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.countDownTime;return[t._v(" "+t._s([o.h,o.m,o.s].join(":"))+" ")]}}],null,!1,0x3cda178)}):t._e()],1):t._e(),t.bookingItem.status&&t.bookingItem.status.status_desc?o("booking-card-tips",{staticClass:"booking-card-detail_status-tips",attrs:{desc:t.bookingItem.status.status_desc,"is-icon":t.bookingItem.status.dialog},on:{showTip:function(e){return t.showTipInfoMethod(t.bookingItem.status.dialog)}}}):t._e(),t.filteredButtons.length>0||t.options.length>0?o("div",{staticClass:"booking-card-detail_button-group"},[t._l(t.filteredButtons.slice(0,2),function(e,i){return o("span",{directives:[{name:"galileo-click-tracker",rawName:"v-galileo-click-tracker.exposure",value:t.galileoTabClick(e),expression:"galileoTabClick(option)",modifiers:{exposure:!0}}],key:i,staticClass:"booking-card-detail_button-group--space",attrs:{"data-spm-item":"Tab?typ=entry&ext="+JSON.stringify({LinkUrl:encodeURIComponent(e.deep_link)})},on:{click:function(t){t.stopPropagation()}}},[e.deep_link.includes("view_app_voucher")?[o("klk-button",{attrs:{type:"outlined",size:"small"},on:{click:t.handleViewAppVoucher}},[t._v(" "+t._s(e.title)+" ")])]:e.deep_link.includes("combine_booking")?[o("klk-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){return t.handleShowMerge(e.deep_link)}}},[t._v(" "+t._s(e.title)+" ")])]:e.deep_link.includes("view_logistics")?[o("klk-button",{attrs:{type:"outlined",size:"small"},on:{click:function(o){return t.handleViewLogistics(e.deep_link)}}},[t._v(" "+t._s(e.title)+" ")])]:[o("klk-button",{attrs:{type:e.ui_type.includes("primary")?"primary":"outlined",size:"small"},on:{click:function(o){return t.buttonClick(e)}}},[t._v(" "+t._s(e.title)+" ")])]],2)}),t.options.length>0?o("more-option",t._l(t.options,function(e,i){return o("klk-dropdown-item",{key:i,attrs:{slot:"DropdownItem",name:e,"data-spm-item":t.getActionIht(e.button_type)},nativeOn:{click:function(o){return t.buttonClick(e)}},slot:"DropdownItem"},[t._v(" "+t._s(e.title)+" ")])}),1):t._e()],2):t._e()],1)])],1)])},[],!1,null,null,null).exports;var b=o("60946"),f=o("50593");let C=(0,n.namespace)("traveller/booking-list");class I extends n.Vue{hideMergeOption(){this.setOptionVisible(!1)}handleClick(){window.location.href=this.mergeOptionInfo.button.deep_link}}(0,s.gn)([C.State],I.prototype,"mergeOptionVisible",void 0),(0,s.gn)([C.State],I.prototype,"mergeOptionInfo",void 0),(0,s.gn)([C.Mutation("SET_MERGE_OPTION_VISIBLE")],I.prototype,"setOptionVisible",void 0);let S=I=(0,s.gn)([(0,n.Component)({filters:{currencySymbol:t=>b.Qb[t],formatPrice:t=>(0,f.JZ)(t)}})],I),w=(0,c.Z)(S,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("klk-bottom-sheet",{attrs:{"show-close":"",visible:t.mergeOptionVisible,title:t.mergeOptionInfo&&t.mergeOptionInfo.title||""},on:{close:t.hideMergeOption}},[t.mergeOptionInfo?[o("h4",{staticClass:"merge-option_title"},[t._v(t._s(t.mergeOptionInfo.desc))]),t._l(t.mergeOptionInfo.booking_items,function(e,i){return o("div",{key:i,staticClass:"merge-option_item"},[o("span",{staticClass:"merge-option_icon"},[o("img",{attrs:{src:e.icon_img_url,alt:"业务图标"}})]),o("div",{staticClass:"merge-option_content"},[o("h5",[t._v(t._s(e.activity_name))]),o("p",[t._v(t._s(t._f("currencySymbol")(e.pay_currency))+t._s(t._f("formatPrice")(e.actual_amount)))])])])}),o("div",{staticClass:"merge-option_footer",attrs:{slot:"footer"},slot:"footer"},["pay"===t.mergeOptionInfo.type?o("p",[t._v(" "+t._s(t.$t("pay.total_money"))),o("span",[t._v(" "+t._s(t._f("currencySymbol")(t.mergeOptionInfo.price_info.pay_currency))+" "+t._s(t._f("formatPrice")(t.mergeOptionInfo.price_info.total_price)))])]):t._e(),o("klk-button",{attrs:{block:""},on:{click:t.handleClick}},[t._v(t._s(t.mergeOptionInfo.button.title))])],1)]:t._e()],2)},[],!1,null,null,null).exports,L=(0,n.namespace)("traveller/booking-list");class x extends n.Vue{get title(){let t="";return this.logisticsInfo&&this.logisticsInfo.logistic_status&&(t=this.logisticsInfo.logistic_status),t}copyLogisticsNumber(t){(0,f.vQ)(t).then(t=>{t?this.$toast(this.$t("copy_success")):this.$toast("failed")})}hideLogisticsModal(){this.setLogistics(!1)}}(0,s.gn)([L.State],x.prototype,"logisticsVisible",void 0),(0,s.gn)([L.State],x.prototype,"logisticsInfo",void 0),(0,s.gn)([L.Mutation("SET_LOGISTICS_VISIBLE")],x.prototype,"setLogistics",void 0);let O=x=(0,s.gn)([n.Component],x),P=(0,c.Z)(O,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("klk-bottom-sheet",{attrs:{"show-close":"",visible:t.logisticsVisible,title:t.title},on:{close:t.hideLogisticsModal}},[t.logisticsInfo?o("div",{staticClass:"logistics_modal__main"},[o("div",{staticClass:"logistics_modal__logistics_desc",domProps:{innerHTML:t._s(t.logisticsInfo.content)}}),o("div",{staticClass:"logistics_modal__logistics_content"},t._l(t.logisticsInfo.logistics,function(e,i){return o("div",{key:i,staticClass:"logistics_modal__logistics_info"},[o("div",{staticClass:"logistics_modal__logistics_info--left"},[o("p",{staticClass:"logistics_modal__logistics_item_title"},[t._v(t._s(e.title))]),o("p",{staticClass:"logistics_modal__logistics_item_val"},[t._v(t._s(e.value))])]),1===e.action_type?o("span",{staticClass:"logistics_modal__logistics_item_opt",on:{click:function(o){return t.copyLogisticsNumber(e.value)}}},[t._v(t._s(t.$t("global.copy")))]):t._e()])}),0)]):t._e()])},[],!1,null,null,null).exports;o("4610");let E=(0,n.namespace)("traveller/booking-list"),T=(0,n.namespace)("auth");class B extends n.Vue{get hasPopularList(){return this.bookingPopularData&&this.bookingPopularData.items&&this.bookingPopularData.items.length>0}refresh(){window.location.reload()}handleLoadMore(){this.isLoading=!0,this.getOrderList().then(()=>{this.isLoading=!1})}handleSeeMore(){window.location.href=this.$href("/popular/all/")}fetchOrderList(){this.setOrderStatus("loading"),this.setPageIndex(1),this.setOrderList([]),this.getOrderList()}constructor(...t){super(...t),this.isLoading=!1}}(0,s.gn)([n.State],B.prototype,"klook",void 0),(0,s.gn)([E.State],B.prototype,"orderStatus",void 0),(0,s.gn)([E.State],B.prototype,"orderList",void 0),(0,s.gn)([E.State],B.prototype,"bookingPopularData",void 0),(0,s.gn)([E.Mutation("SET_PAGE_INDEX")],B.prototype,"setPageIndex",void 0),(0,s.gn)([E.Mutation("SET_ORDER_LIST")],B.prototype,"setOrderList",void 0),(0,s.gn)([E.Mutation("SET_LIST_TYPE")],B.prototype,"setListType",void 0),(0,s.gn)([E.Mutation("SET_ORDER_STATUS")],B.prototype,"setOrderStatus",void 0),(0,s.gn)([E.State],B.prototype,"mergeOptionVisible",void 0),(0,s.gn)([E.State],B.prototype,"listType",void 0),(0,s.gn)([E.Action],B.prototype,"getOrderList",void 0),(0,s.gn)([E.State],B.prototype,"recentlyPurchased",void 0),(0,s.gn)([E.State],B.prototype,"migrateHistoryBookingUrl",void 0),(0,s.gn)([E.State],B.prototype,"emptyExploreButton",void 0),(0,s.gn)([E.State],B.prototype,"totalPage",void 0),(0,s.gn)([E.State],B.prototype,"pageIndex",void 0),(0,s.gn)([T.State],B.prototype,"isLimitedAccess",void 0);let $=B=(0,s.gn)([(0,n.Component)({components:{BookingTypeFilter:_.Z,BookingItem:y,Logistics:P,MergeOption:w,KlkEmptyPanel:d.Z,klkCard:g.Km}})],B),V=(0,c.Z)($,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"booking-list-content"},[o("booking-type-filter",{on:{change:t.fetchOrderList}}),"error"===t.orderStatus?o("div",{staticClass:"booking-list-error",on:{click:t.refresh}},[o("svg-icon",{attrs:{name:"mobile-common#icon-empty",width:"54px",height:"60px",color:"rgba(0, 0, 0, 0.54)"}}),o("p",[t._v(t._s(t.$t("check_connection_and_refresh")))])],1):t.orderList.length<=0?o("div",{staticClass:"booking-list-noData"},[o("KlkEmptyPanel",{staticClass:"booking-list-noData-panel",attrs:{platform:"mobile","icon-src":"https://res.klook.com/image/upload/v1645521732/tuv7ipnsnwwp5sa8sbjg.gif",title:t.$t("17869"),content:t.$t("214970"),webp:t.klook.webp,"primary-btn-attrs":{"data-spm-module":"StartExploring","data-spm-virtual-item":"__virtual?typ=entry"},"primary-btn-link":t.emptyExploreButton&&t.emptyExploreButton.url,"primary-btn-text":t.emptyExploreButton&&t.emptyExploreButton.text}}),t.migrateHistoryBookingUrl?o("div",{staticClass:"booking-list-content_view-old"},[o("klk-link",{directives:[{name:"galileo-click-tracker",rawName:"v-galileo-click-tracker",value:{spm:"ViewHistoryBookings"},expression:"{ spm: 'ViewHistoryBookings' }"}],attrs:{"data-spm-module":"ViewHistoryBookings","data-spm-virtual-item":"__virtual?typ=entry",href:t.migrateHistoryBookingUrl}},[t._v(" "+t._s(t.$t("166471"))+" ")])],1):t._e(),t.hasPopularList&&!t.isLimitedAccess?o("div",{staticClass:"booking-list-popular"},[o("p",{staticClass:"booking-list-popular-title"},[t._v(t._s(t.bookingPopularData.title))]),t._l(t.bookingPopularData.items,function(e,i){return o("klk-card",{key:i,staticClass:"booking-list-popular-item",attrs:{size:"small","klook-img-ratio":"8:5","klook-img-scene":"product_medium","data-spm-virtual-item":"__virtual?typ=entry","data-spm-module":"PopularActivity_LIST?oid="+(e.track_info.object_id||"")+"&idx="+i+"&len="+t.bookingPopularData.items.length+"&ext="+encodeURIComponent(JSON.stringify(Object.assign({},e.track_info.extra))),"card-data":Object.assign({},e.data,{price_tag_list:null})}})}),t.bookingPopularData.more_deep_link?o("div",{staticClass:"view-more"},[o("a",{attrs:{href:t.bookingPopularData.more_deep_link,target:"_blank"}},[o("klk-button",{staticClass:"view-more-button",attrs:{type:"outlined",block:""},on:{click:t.handleSeeMore}},[t._v(" "+t._s(t.bookingPopularData.more_title)+" ")])],1)]):t._e()],2):t._e()],1):[t._l(t.orderList,function(e,i){return o("booking-item",{key:i,attrs:{"booking-item":e},on:{"fetch-order-list":t.fetchOrderList}})}),o("div",{staticClass:"booking-list-content_view-more"},[t.pageIndex<=t.totalPage?[o("klk-button",{attrs:{loading:t.isLoading,type:"outlined",block:""},on:{click:t.handleLoadMore}},[t._v(" "+t._s(t.$t("faq.viewMore"))+" ")])]:[o("p",{staticClass:"booking-list-content_no-more"},[t._v(t._s(t.$t("12347")))]),t.migrateHistoryBookingUrl?o("div",{staticClass:"booking-list-content_view-old"},[o("klk-link",{directives:[{name:"galileo-click-tracker",rawName:"v-galileo-click-tracker",value:{spm:"ViewHistoryBookings"},expression:"{ spm: 'ViewHistoryBookings' }"}],attrs:{"data-spm-module":"ViewHistoryBookings","data-spm-virtual-item":"__virtual?typ=entry",href:t.migrateHistoryBookingUrl}},[t._v(" "+t._s(t.$t("166473"))+" ")])],1):t._e()]],2)],o("logistics"),o("merge-option")],2)},[],!1,null,null,null).exports;var A=o("98248"),M=o("12135");let D=(0,n.namespace)("traveller/booking-list"),Z=(0,n.namespace)("auth");class N extends n.Vue{mounted(){Promise.all([this.getOrderList(),this.getRecentlyPurchased(),this.getBookingPopularList(),this.getCoupon()])}}(0,s.gn)([n.State],N.prototype,"klook",void 0),(0,s.gn)([Z.State],N.prototype,"isLimitedAccess",void 0),(0,s.gn)([D.Action],N.prototype,"getRecentlyPurchased",void 0),(0,s.gn)([D.Action],N.prototype,"getOrderList",void 0),(0,s.gn)([D.Action],N.prototype,"getBookingPopularList",void 0),(0,s.gn)([D.Action],N.prototype,"getCoupon",void 0),(0,s.gn)([D.State],N.prototype,"recentlyPurchased",void 0),(0,s.gn)([D.State],N.prototype,"orderList",void 0),(0,s.gn)([D.State],N.prototype,"orderStatus",void 0),(0,s.gn)([D.State],N.prototype,"totalPage",void 0),(0,s.gn)([D.State],N.prototype,"pageIndex",void 0);let H=N=(0,s.gn)([(0,n.Component)({components:{RecentlyPurchase:p,BookingListContent:V,SkeletonParagraph:A.Z,Skeleton:M.Z},middleware:["needLogin"]})],N),R=(0,c.Z)(H,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"booking-list"},[e("div",{class:["booking-list-title","page-sticky-header",{"booking-list-title--no-head":this.isLimitedAccess}]},[this._v(" "+this._s(this.$t("my_bookings_title"))+" ")]),this.recentlyPurchased.length>0&&!this.isLimitedAccess?e("recently-purchase",{attrs:{"purchased-array":this.recentlyPurchased}}):this._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:"loading"===this.orderStatus,expression:"orderStatus === 'loading'"}],staticClass:"skeleton"},[e("skeleton-paragraph"),this._l(5,function(t,o){return e("skeleton",{key:o,attrs:{"skeleton-short":175,"skeleton-long":230,reverse:""}})})],2),e("booking-list-content",{directives:[{name:"show",rawName:"v-show",value:"loading"!==this.orderStatus,expression:"orderStatus !== 'loading'"}]})],1)},[],!1,null,null,null).exports,U=(0,i.xh)(R,{spm:"Booking"})}}]);